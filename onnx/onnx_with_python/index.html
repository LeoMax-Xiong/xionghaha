
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="xionghaha">
      
      
      
        <link rel="prev" href="../introduction/">
      
      
        <link rel="next" href="../api_proto/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.24">
    
    
      
        <title>Python处理ONNX - Xionghaha</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#python-onnx" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Xionghaha" class="md-header__button md-logo" aria-label="Xionghaha" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Xionghaha
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Python处理ONNX
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_2">
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../en/onnx/onnx_with_python/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="zh" class="md-select__link">
              简体中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Honei/xionghaha" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
    
  
  首页

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../blog/" class="md-tabs__link">
          
  
    
  
  Getting started

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../datasets/tod/" class="md-tabs__link">
          
  
    
  
  数据集

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../hardware/%E5%9F%BA%E7%A1%80/" class="md-tabs__link">
          
  
    
  
  硬件

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tokenizer/tokenizer%E5%85%A5%E9%97%A8/" class="md-tabs__link">
          
  
    
  
  tokenizer

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../rewrite/introduction/" class="md-tabs__link">
          
  
    
  
  多轮改写

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../introduction/" class="md-tabs__link">
          
  
    
  
  onnx

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../inference/introduction/" class="md-tabs__link">
          
  
    
  
  模型推理

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../speech_and_language_processing/jsgf/jsgf/" class="md-tabs__link">
          
  
    
  
  语音与语言处理

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../rag/generation/question/" class="md-tabs__link">
          
  
    
  
  RAG

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../huggingface/datasets/DatasetDict%E7%B1%BB/" class="md-tabs__link">
          
  
    
  
  huggingface

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../speech/asr/%E5%BC%95%E8%A8%80/" class="md-tabs__link">
          
  
    
  
  语音

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../%E8%AE%BA%E6%96%87%E7%BF%BB%E8%AF%91/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%A2%84%E8%AE%AD%E7%BB%83%E6%95%B0%E6%8D%AE%E9%9B%86/redpajama/RedPajama_an_Open_Dataset_for_Training_Large_Language_Models/" class="md-tabs__link">
          
  
    
  
  论文翻译

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../todo/todo/" class="md-tabs__link">
          
  
    
  
  待办

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Xionghaha" class="md-nav__button md-logo" aria-label="Xionghaha" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Xionghaha
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Honei/xionghaha" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    首页
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            首页
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../home/about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../blog/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    tutorials
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    blogs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            blogs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blog/blogs/basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基础
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数据集
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            数据集
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/tod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    任务式对话
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SFT
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            SFT
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/sft/lima/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lima
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    硬件
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            硬件
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基础
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    tokenizer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            tokenizer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tokenizer/tokenizer%E5%85%A5%E9%97%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    引言
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tokenizer/utf8_unicode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    字符编码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tokenizer/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    介绍
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tokenizer/tokenizer%E5%AE%9E%E7%8E%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    实现
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tokenizer/bpe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BPE算法
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    多轮改写
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            多轮改写
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rewrite/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    介绍
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    onnx
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            onnx
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" checked>
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    介绍
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            介绍
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ONNX
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Python处理ONNX
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Python处理ONNX
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      背景
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      一个简单的例子：线性回归
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一个简单的例子：线性回归">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      线性回归模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#onnx" class="md-nav__link">
    <span class="md-ellipsis">
      onnx 代码实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      可视化显示
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-shape" class="md-nav__link">
    <span class="md-ellipsis">
      特殊节点-形状shape为空
    </span>
  </a>
  
    <nav class="md-nav" aria-label="特殊节点-形状shape为空">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      有空形状节点计算图构图代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      其他
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      序列化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="序列化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      模型序列化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      数据序列化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      初始化程序，默认值
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      属性
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opset" class="md-nav__link">
    <span class="md-ellipsis">
      Opset 和元数据
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      子图：测试和循环
    </span>
  </a>
  
    <nav class="md-nav" aria-label="子图：测试和循环">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if" class="md-nav__link">
    <span class="md-ellipsis">
      条件算子 IF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scan" class="md-nav__link">
    <span class="md-ellipsis">
      扫描算子scan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      没有属性的函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      具有属性的函数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      解析
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      检查器和形状推断
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      评估和运行时
    </span>
  </a>
  
    <nav class="md-nav" aria-label="评估和运行时">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      线性回归的评估
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      节点评估
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      逐步评估
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      评估自定义节点
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      实现细节
    </span>
  </a>
  
    <nav class="md-nav" aria-label="实现细节">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python-c" class="md-nav__link">
    <span class="md-ellipsis">
      Python 和 C++
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      属性和输入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      有形或无形
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API接口
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            API接口
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_proto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    proto定义
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    模型推理
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            模型推理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    介绍
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    vllm
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            vllm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_1" >
        
          
          <label class="md-nav__link" for="__nav_8_2_1" id="__nav_8_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    开始
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_1">
            <span class="md-nav__icon md-icon"></span>
            开始
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/vllm/getting_started/%E5%AE%89%E8%A3%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    安装
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    语音与语言处理
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            语音与语言处理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9_1" >
        
          
          <label class="md-nav__link" for="__nav_9_1" id="__nav_9_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    正则表达式文本规整与编辑距离
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1">
            <span class="md-nav__icon md-icon"></span>
            正则表达式文本规整与编辑距离
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../speech_and_language_processing/jsgf/jsgf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jsgf
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    RAG
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            RAG
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_1" >
        
          
          <label class="md-nav__link" for="__nav_10_1" id="__nav_10_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    回复生成
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_1">
            <span class="md-nav__icon md-icon"></span>
            回复生成
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/generation/question/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    问题
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_2" >
        
          
          <label class="md-nav__link" for="__nav_10_2" id="__nav_10_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    llama-index
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2">
            <span class="md-nav__icon md-icon"></span>
            llama-index
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_2_1" >
        
          
          <label class="md-nav__link" for="__nav_10_2_1" id="__nav_10_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    学习
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_1">
            <span class="md-nav__icon md-icon"></span>
            学习
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_2_1_1" >
        
          
          <label class="md-nav__link" for="__nav_10_2_1_1" id="__nav_10_2_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    加载和提取
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_10_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            加载和提取
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/learn/%E6%9E%84%E5%BB%BARAG%E7%9A%84%E6%B5%81%E7%A8%8B/%E5%8A%A0%E8%BD%BD%E5%92%8C%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    加载数据(提取)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/learn/%E6%9E%84%E5%BB%BARAG%E7%9A%84%E6%B5%81%E7%A8%8B/LlamaIndex%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LlamaHub注册中心
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_2_2" >
        
          
          <label class="md-nav__link" for="__nav_10_2_2" id="__nav_10_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    组件指南
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_2">
            <span class="md-nav__icon md-icon"></span>
            组件指南
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_2_2_1" >
        
          
          <label class="md-nav__link" for="__nav_10_2_2_1" id="__nav_10_2_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    文件加载
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_10_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            文件加载
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD/%E5%BC%95%E8%A8%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    引言
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_2_2_1_2" >
        
          
          <label class="md-nav__link" for="__nav_10_2_2_1_2" id="__nav_10_2_2_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    文档和节点
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_10_2_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            文档和节点
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD/%E6%96%87%E6%A1%A3%E5%92%8C%E8%8A%82%E7%82%B9/%E5%BC%95%E8%A8%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    引言
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD/%E6%96%87%E6%A1%A3%E5%92%8C%E8%8A%82%E7%82%B9/%E8%8A%82%E7%82%B9%E4%BD%BF%E7%94%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    节点使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD/%E6%96%87%E6%A1%A3%E5%92%8C%E8%8A%82%E7%82%B9/%E5%85%83%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    元数据提取
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_2_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_10_2_2_1_3" id="__nav_10_2_2_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    节点解析文本解析
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_10_2_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            节点解析文本解析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E8%8A%82%E7%82%B9%E8%A7%A3%E6%9E%90%E6%96%87%E6%A1%A3%E5%88%87%E5%88%86/%E8%8A%82%E7%82%B9%E8%A7%A3%E6%9E%90%E6%A8%A1%E5%9D%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    节点解析使用模式
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_10_2_2_2" id="__nav_10_2_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    索引
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_10_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            索引
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E7%B4%A2%E5%BC%95/%E5%BC%95%E8%A8%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    引言
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    索引入门指南
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E7%B4%A2%E5%BC%95/%E5%90%91%E9%87%8F%E7%B4%A2%E5%BC%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    向量索引
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E7%B4%A2%E5%BC%95/%E5%B1%9E%E6%80%A7%E5%9B%BE%E7%B4%A2%E5%BC%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    属性图索引
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E7%B4%A2%E5%BC%95/%E6%96%87%E6%A1%A3%E7%AE%A1%E7%90%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文档管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E7%B4%A2%E5%BC%95/%E5%85%83%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    元数据提取
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_2_2_3" >
        
          
          <label class="md-nav__link" for="__nav_10_2_2_3" id="__nav_10_2_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    查询
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_10_2_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_2_3">
            <span class="md-nav__icon md-icon"></span>
            查询
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E6%9F%A5%E8%AF%A2/%E5%BC%95%E8%A8%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    引言
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_2_2_3_2" >
        
          
          <label class="md-nav__link" for="__nav_10_2_2_3_2" id="__nav_10_2_2_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    结构化输出
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_10_2_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            结构化输出
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E6%9F%A5%E8%AF%A2/%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA/%E5%BC%95%E8%A8%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    引言
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E6%9F%A5%E8%AF%A2/%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA/%E5%93%8D%E5%BA%94%E5%90%88%E6%88%90/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    响应合成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/llama_index/components_guides/%E6%9F%A5%E8%AF%A2/%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA/%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA%E7%9A%84%E7%AE%80%E5%8D%95%E6%8C%87%E5%8D%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    结构化输出简单指南
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    huggingface
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            huggingface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11_1" >
        
          
          <label class="md-nav__link" for="__nav_11_1" id="__nav_11_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数据集
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_1">
            <span class="md-nav__icon md-icon"></span>
            数据集
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../huggingface/datasets/DatasetDict%E7%B1%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DatasetDict类
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    语音
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            语音
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_12_1" >
        
          
          <label class="md-nav__link" for="__nav_12_1" id="__nav_12_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    语音识别
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_1">
            <span class="md-nav__icon md-icon"></span>
            语音识别
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../speech/asr/%E5%BC%95%E8%A8%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    引言
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    论文翻译
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            论文翻译
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_13_1" >
        
          
          <label class="md-nav__link" for="__nav_13_1" id="__nav_13_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    大模型预训练数据集
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_1">
            <span class="md-nav__icon md-icon"></span>
            大模型预训练数据集
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%BA%E6%96%87%E7%BF%BB%E8%AF%91/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%A2%84%E8%AE%AD%E7%BB%83%E6%95%B0%E6%8D%AE%E9%9B%86/redpajama/RedPajama_an_Open_Dataset_for_Training_Large_Language_Models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RedPajama an Open Dataset for Training Large Language Models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_13_2" >
        
          
          <label class="md-nav__link" for="__nav_13_2" id="__nav_13_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    大模型
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_2">
            <span class="md-nav__icon md-icon"></span>
            大模型
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%BA%E6%96%87%E7%BF%BB%E8%AF%91/%E5%A4%A7%E6%A8%A1%E5%9E%8B/llama/LLaMA_Open_and_Efficient_Foundation_Language_Models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LLaMA Open and Efficient Foundation Language Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%BA%E6%96%87%E7%BF%BB%E8%AF%91/%E5%A4%A7%E6%A8%A1%E5%9E%8B/deepseekllm/DeepSeek_LLM_Scaling_Open_Source_Language_Models_with_Longtermism/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DeepSeek LLM Scaling Open-Source Language Models with Longtermism
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%BA%E6%96%87%E7%BF%BB%E8%AF%91/%E5%A4%A7%E6%A8%A1%E5%9E%8B/deepseek_r1/DeepSeek_R1_Incentivizing_Reasoning_Capability_in_LLMs_via_Reinforcement_Learning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DeepSeek-R1 Incentivizing Reasoning Capability in LLMs via Reinforcement Learning
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    待办
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            待办
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../todo/todo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    待办
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      背景
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      一个简单的例子：线性回归
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一个简单的例子：线性回归">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      线性回归模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#onnx" class="md-nav__link">
    <span class="md-ellipsis">
      onnx 代码实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      可视化显示
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-shape" class="md-nav__link">
    <span class="md-ellipsis">
      特殊节点-形状shape为空
    </span>
  </a>
  
    <nav class="md-nav" aria-label="特殊节点-形状shape为空">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      有空形状节点计算图构图代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      其他
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      序列化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="序列化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      模型序列化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      数据序列化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      初始化程序，默认值
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      属性
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opset" class="md-nav__link">
    <span class="md-ellipsis">
      Opset 和元数据
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      子图：测试和循环
    </span>
  </a>
  
    <nav class="md-nav" aria-label="子图：测试和循环">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if" class="md-nav__link">
    <span class="md-ellipsis">
      条件算子 IF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scan" class="md-nav__link">
    <span class="md-ellipsis">
      扫描算子scan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      没有属性的函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      具有属性的函数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      解析
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      检查器和形状推断
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      评估和运行时
    </span>
  </a>
  
    <nav class="md-nav" aria-label="评估和运行时">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      线性回归的评估
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      节点评估
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      逐步评估
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      评估自定义节点
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      实现细节
    </span>
  </a>
  
    <nav class="md-nav" aria-label="实现细节">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python-c" class="md-nav__link">
    <span class="md-ellipsis">
      Python 和 C++
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      属性和输入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      有形或无形
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/Honei/xionghaha/edit/master/docs/onnx/onnx_with_python.md" title="编辑此页" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/Honei/xionghaha/raw/master/docs/onnx/onnx_with_python.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="python-onnx">Python 处理 ONNX</h1>
<blockquote>
<p>作者：熊哈哈</p>
<p>邮箱: 915574300@qq.com</p>
</blockquote>
<h2 id="_1">背景</h2>
<p>接下来的部分，重点介绍了如何使用 <code>onnx</code> 包提供的Python API 来构建 ONNX 计算图所用到的主要函数。</p>
<h2 id="_2">一个简单的例子：线性回归</h2>
<h3 id="_3">线性回归模型</h3>
<p>线性回归是机器学习中最简单的模型，以下数学表达式描述了一个线性回归模型: <span class="arithmatex">\(Y = X * A + B\)</span>
我们可以把这个模型看作一个三变量的函数 <span class="arithmatex">\(Y = f(X, A, B)\)</span>，对应的 ONNX 表达式为 <code>y = Add(MatMul(X, A), B)</code>。这就是我们需要用 ONNX 算子表示的内容。第一件事是用 ONNX 算子实现一个函数。ONNX 是强类型的。必须为函数的 <strong>输入</strong> 和 <strong>输出</strong> 节点定义形状(shape)和类型(type)。也就是说，我们在 <code>make_function</code> 函数中需要用四个函数来构建计算图。</p>
<ul>
<li>
<p><code>make_tensor_value_info</code>：根据形状shape和类型type声明一个变量（输入或输出）</p>
</li>
<li>
<p><code>make_node</code>：创建一个由算子（算子类型）、其输入和输出定义的节点</p>
</li>
<li>
<p><code>make_graph</code>：使用前两个函数创建的对象创建 ONNX 计算图</p>
</li>
<li>
<p><code>make_model</code>：将计算图和附加元数据融合在一起</p>
</li>
</ul>
<p>在创建过程中，我们需要为计算图的每个节点的每个输入、输出命名。计算图的输入和输出由 onnx 对象定义，字符串用于引用中间结果。构建的过程如下所述。</p>
<h3 id="onnx">onnx 代码实现</h3>
<!-- https://facelessuser.github.io/pymdown-extensions/extensions/details/ -->
<!-- https://squidfunk.github.io/mkdocs-material/reference/admonitions/#collapsible-blocks -->

<details>
 <summary>onnx实现的线性回归模型</summary>

  <div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1"># imports</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">TensorProto</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">make_graph</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">make_tensor_value_info</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><a href="#__codelineno-0-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><a href="#__codelineno-0-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1"># 第一步：构建整个计算图所有的变量</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><a href="#__codelineno-0-10"><span class="linenos" data-linenos="10 "></span></a><span class="c1"># inputs</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><a href="#__codelineno-0-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><a href="#__codelineno-0-12"><span class="linenos" data-linenos="12 "></span></a><span class="c1"># &#39;X&#39; is the name, TensorProto.FLOAT the type, [None, None] the shape</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><a href="#__codelineno-0-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><a href="#__codelineno-0-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><a href="#__codelineno-0-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><a href="#__codelineno-0-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><a href="#__codelineno-0-17"><span class="linenos" data-linenos="17 "></span></a><span class="c1"># outputs, the shape is left undefined</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><a href="#__codelineno-0-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><a href="#__codelineno-0-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><a href="#__codelineno-0-20"><span class="linenos" data-linenos="20 "></span></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><a href="#__codelineno-0-21"><span class="linenos" data-linenos="21 "></span></a><span class="c1"># 第二步：根据变量构建所有的节点</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><a href="#__codelineno-0-22"><span class="linenos" data-linenos="22 "></span></a><span class="c1"># nodes</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><a href="#__codelineno-0-23"><span class="linenos" data-linenos="23 "></span></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><a href="#__codelineno-0-24"><span class="linenos" data-linenos="24 "></span></a><span class="c1"># It creates a node defined by the operator type MatMul,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><a href="#__codelineno-0-25"><span class="linenos" data-linenos="25 "></span></a><span class="c1"># &#39;X&#39;, &#39;A&#39; are the inputs of the node, &#39;XA&#39; the output.</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><a href="#__codelineno-0-26"><span class="linenos" data-linenos="26 "></span></a><span class="n">node1</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">])</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><a href="#__codelineno-0-27"><span class="linenos" data-linenos="27 "></span></a><span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><a href="#__codelineno-0-28"><span class="linenos" data-linenos="28 "></span></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><a href="#__codelineno-0-29"><span class="linenos" data-linenos="29 "></span></a><span class="c1"># 第三步：根据节点构建计算图</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><a href="#__codelineno-0-30"><span class="linenos" data-linenos="30 "></span></a><span class="c1"># from nodes to graph</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><a href="#__codelineno-0-31"><span class="linenos" data-linenos="31 "></span></a><span class="c1"># the graph is built from the list of nodes, the list of inputs,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><a href="#__codelineno-0-32"><span class="linenos" data-linenos="32 "></span></a><span class="c1"># the list of outputs and a name.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><a href="#__codelineno-0-33"><span class="linenos" data-linenos="33 "></span></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><a href="#__codelineno-0-34"><span class="linenos" data-linenos="34 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">([</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">],</span>  <span class="c1"># nodes</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><a href="#__codelineno-0-35"><span class="linenos" data-linenos="35 "></span></a>                    <span class="s1">&#39;lr&#39;</span><span class="p">,</span>  <span class="c1"># a name</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><a href="#__codelineno-0-36"><span class="linenos" data-linenos="36 "></span></a>                    <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">],</span>  <span class="c1"># inputs</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><a href="#__codelineno-0-37"><span class="linenos" data-linenos="37 "></span></a>                    <span class="p">[</span><span class="n">Y</span><span class="p">])</span>  <span class="c1"># outputs</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><a href="#__codelineno-0-38"><span class="linenos" data-linenos="38 "></span></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><a href="#__codelineno-0-39"><span class="linenos" data-linenos="39 "></span></a><span class="c1"># 第四步：根据计算图等其他信息，构建一个onnx模型</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><a href="#__codelineno-0-40"><span class="linenos" data-linenos="40 "></span></a><span class="c1"># onnx graph</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><a href="#__codelineno-0-41"><span class="linenos" data-linenos="41 "></span></a><span class="c1"># there is no metadata in this case.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><a href="#__codelineno-0-42"><span class="linenos" data-linenos="42 "></span></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><a href="#__codelineno-0-43"><span class="linenos" data-linenos="43 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><a href="#__codelineno-0-44"><span class="linenos" data-linenos="44 "></span></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><a href="#__codelineno-0-45"><span class="linenos" data-linenos="45 "></span></a><span class="c1"># 第五步：对模型进行校验</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><a href="#__codelineno-0-46"><span class="linenos" data-linenos="46 "></span></a><span class="c1"># Let&#39;s check the model is consistent,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><a href="#__codelineno-0-47"><span class="linenos" data-linenos="47 "></span></a><span class="c1"># this function is described in section</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><a href="#__codelineno-0-48"><span class="linenos" data-linenos="48 "></span></a><span class="c1"># Checker and Shape Inference.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><a href="#__codelineno-0-49"><span class="linenos" data-linenos="49 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><a href="#__codelineno-0-50"><span class="linenos" data-linenos="50 "></span></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><a href="#__codelineno-0-51"><span class="linenos" data-linenos="51 "></span></a><span class="c1"># the work is done, let&#39;s display it...</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><a href="#__codelineno-0-52"><span class="linenos" data-linenos="52 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
</code></pre></div>
</details>

<p><code>#################################################################################</code>
<code>#################################完美的分割线######################################</code>
<code>#################################################################################</code></p>
<details>
  <summary> onnx实现的线性回归模型网络结果：json格式 </summary>

<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos=" 1 "></span></a>ir_version: 11
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos=" 2 "></span></a>graph {
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos=" 3 "></span></a>  node {
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos=" 4 "></span></a>    input: &quot;X&quot;
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos=" 5 "></span></a>    input: &quot;A&quot;
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><a href="#__codelineno-1-6"><span class="linenos" data-linenos=" 6 "></span></a>    output: &quot;XA&quot;
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><a href="#__codelineno-1-7"><span class="linenos" data-linenos=" 7 "></span></a>    op_type: &quot;MatMul&quot;
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><a href="#__codelineno-1-8"><span class="linenos" data-linenos=" 8 "></span></a>  }
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><a href="#__codelineno-1-9"><span class="linenos" data-linenos=" 9 "></span></a>  node {
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><a href="#__codelineno-1-10"><span class="linenos" data-linenos="10 "></span></a>    input: &quot;XA&quot;
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><a href="#__codelineno-1-11"><span class="linenos" data-linenos="11 "></span></a>    input: &quot;B&quot;
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><a href="#__codelineno-1-12"><span class="linenos" data-linenos="12 "></span></a>    output: &quot;Y&quot;
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><a href="#__codelineno-1-13"><span class="linenos" data-linenos="13 "></span></a>    op_type: &quot;Add&quot;
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><a href="#__codelineno-1-14"><span class="linenos" data-linenos="14 "></span></a>  }
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><a href="#__codelineno-1-15"><span class="linenos" data-linenos="15 "></span></a>  name: &quot;lr&quot;
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><a href="#__codelineno-1-16"><span class="linenos" data-linenos="16 "></span></a>  input {
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><a href="#__codelineno-1-17"><span class="linenos" data-linenos="17 "></span></a>    name: &quot;X&quot;
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><a href="#__codelineno-1-18"><span class="linenos" data-linenos="18 "></span></a>    type {
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><a href="#__codelineno-1-19"><span class="linenos" data-linenos="19 "></span></a>      tensor_type {
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><a href="#__codelineno-1-20"><span class="linenos" data-linenos="20 "></span></a>        elem_type: 1
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><a href="#__codelineno-1-21"><span class="linenos" data-linenos="21 "></span></a>        shape {
<a id="__codelineno-1-22" name="__codelineno-1-22"></a><a href="#__codelineno-1-22"><span class="linenos" data-linenos="22 "></span></a>          dim {
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><a href="#__codelineno-1-23"><span class="linenos" data-linenos="23 "></span></a>          }
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><a href="#__codelineno-1-24"><span class="linenos" data-linenos="24 "></span></a>          dim {
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><a href="#__codelineno-1-25"><span class="linenos" data-linenos="25 "></span></a>          }
<a id="__codelineno-1-26" name="__codelineno-1-26"></a><a href="#__codelineno-1-26"><span class="linenos" data-linenos="26 "></span></a>        }
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><a href="#__codelineno-1-27"><span class="linenos" data-linenos="27 "></span></a>      }
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><a href="#__codelineno-1-28"><span class="linenos" data-linenos="28 "></span></a>    }
<a id="__codelineno-1-29" name="__codelineno-1-29"></a><a href="#__codelineno-1-29"><span class="linenos" data-linenos="29 "></span></a>  }
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><a href="#__codelineno-1-30"><span class="linenos" data-linenos="30 "></span></a>  input {
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><a href="#__codelineno-1-31"><span class="linenos" data-linenos="31 "></span></a>    name: &quot;A&quot;
<a id="__codelineno-1-32" name="__codelineno-1-32"></a><a href="#__codelineno-1-32"><span class="linenos" data-linenos="32 "></span></a>    type {
<a id="__codelineno-1-33" name="__codelineno-1-33"></a><a href="#__codelineno-1-33"><span class="linenos" data-linenos="33 "></span></a>      tensor_type {
<a id="__codelineno-1-34" name="__codelineno-1-34"></a><a href="#__codelineno-1-34"><span class="linenos" data-linenos="34 "></span></a>        elem_type: 1
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><a href="#__codelineno-1-35"><span class="linenos" data-linenos="35 "></span></a>        shape {
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><a href="#__codelineno-1-36"><span class="linenos" data-linenos="36 "></span></a>          dim {
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><a href="#__codelineno-1-37"><span class="linenos" data-linenos="37 "></span></a>          }
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><a href="#__codelineno-1-38"><span class="linenos" data-linenos="38 "></span></a>          dim {
<a id="__codelineno-1-39" name="__codelineno-1-39"></a><a href="#__codelineno-1-39"><span class="linenos" data-linenos="39 "></span></a>          }
<a id="__codelineno-1-40" name="__codelineno-1-40"></a><a href="#__codelineno-1-40"><span class="linenos" data-linenos="40 "></span></a>        }
<a id="__codelineno-1-41" name="__codelineno-1-41"></a><a href="#__codelineno-1-41"><span class="linenos" data-linenos="41 "></span></a>      }
<a id="__codelineno-1-42" name="__codelineno-1-42"></a><a href="#__codelineno-1-42"><span class="linenos" data-linenos="42 "></span></a>    }
<a id="__codelineno-1-43" name="__codelineno-1-43"></a><a href="#__codelineno-1-43"><span class="linenos" data-linenos="43 "></span></a>  }
<a id="__codelineno-1-44" name="__codelineno-1-44"></a><a href="#__codelineno-1-44"><span class="linenos" data-linenos="44 "></span></a>  input {
<a id="__codelineno-1-45" name="__codelineno-1-45"></a><a href="#__codelineno-1-45"><span class="linenos" data-linenos="45 "></span></a>    name: &quot;B&quot;
<a id="__codelineno-1-46" name="__codelineno-1-46"></a><a href="#__codelineno-1-46"><span class="linenos" data-linenos="46 "></span></a>    type {
<a id="__codelineno-1-47" name="__codelineno-1-47"></a><a href="#__codelineno-1-47"><span class="linenos" data-linenos="47 "></span></a>      tensor_type {
<a id="__codelineno-1-48" name="__codelineno-1-48"></a><a href="#__codelineno-1-48"><span class="linenos" data-linenos="48 "></span></a>        elem_type: 1
<a id="__codelineno-1-49" name="__codelineno-1-49"></a><a href="#__codelineno-1-49"><span class="linenos" data-linenos="49 "></span></a>        shape {
<a id="__codelineno-1-50" name="__codelineno-1-50"></a><a href="#__codelineno-1-50"><span class="linenos" data-linenos="50 "></span></a>          dim {
<a id="__codelineno-1-51" name="__codelineno-1-51"></a><a href="#__codelineno-1-51"><span class="linenos" data-linenos="51 "></span></a>          }
<a id="__codelineno-1-52" name="__codelineno-1-52"></a><a href="#__codelineno-1-52"><span class="linenos" data-linenos="52 "></span></a>          dim {
<a id="__codelineno-1-53" name="__codelineno-1-53"></a><a href="#__codelineno-1-53"><span class="linenos" data-linenos="53 "></span></a>          }
<a id="__codelineno-1-54" name="__codelineno-1-54"></a><a href="#__codelineno-1-54"><span class="linenos" data-linenos="54 "></span></a>        }
<a id="__codelineno-1-55" name="__codelineno-1-55"></a><a href="#__codelineno-1-55"><span class="linenos" data-linenos="55 "></span></a>      }
<a id="__codelineno-1-56" name="__codelineno-1-56"></a><a href="#__codelineno-1-56"><span class="linenos" data-linenos="56 "></span></a>    }
<a id="__codelineno-1-57" name="__codelineno-1-57"></a><a href="#__codelineno-1-57"><span class="linenos" data-linenos="57 "></span></a>  }
<a id="__codelineno-1-58" name="__codelineno-1-58"></a><a href="#__codelineno-1-58"><span class="linenos" data-linenos="58 "></span></a>  output {
<a id="__codelineno-1-59" name="__codelineno-1-59"></a><a href="#__codelineno-1-59"><span class="linenos" data-linenos="59 "></span></a>    name: &quot;Y&quot;
<a id="__codelineno-1-60" name="__codelineno-1-60"></a><a href="#__codelineno-1-60"><span class="linenos" data-linenos="60 "></span></a>    type {
<a id="__codelineno-1-61" name="__codelineno-1-61"></a><a href="#__codelineno-1-61"><span class="linenos" data-linenos="61 "></span></a>      tensor_type {
<a id="__codelineno-1-62" name="__codelineno-1-62"></a><a href="#__codelineno-1-62"><span class="linenos" data-linenos="62 "></span></a>        elem_type: 1
<a id="__codelineno-1-63" name="__codelineno-1-63"></a><a href="#__codelineno-1-63"><span class="linenos" data-linenos="63 "></span></a>        shape {
<a id="__codelineno-1-64" name="__codelineno-1-64"></a><a href="#__codelineno-1-64"><span class="linenos" data-linenos="64 "></span></a>          dim {
<a id="__codelineno-1-65" name="__codelineno-1-65"></a><a href="#__codelineno-1-65"><span class="linenos" data-linenos="65 "></span></a>          }
<a id="__codelineno-1-66" name="__codelineno-1-66"></a><a href="#__codelineno-1-66"><span class="linenos" data-linenos="66 "></span></a>        }
<a id="__codelineno-1-67" name="__codelineno-1-67"></a><a href="#__codelineno-1-67"><span class="linenos" data-linenos="67 "></span></a>      }
<a id="__codelineno-1-68" name="__codelineno-1-68"></a><a href="#__codelineno-1-68"><span class="linenos" data-linenos="68 "></span></a>    }
<a id="__codelineno-1-69" name="__codelineno-1-69"></a><a href="#__codelineno-1-69"><span class="linenos" data-linenos="69 "></span></a>  }
<a id="__codelineno-1-70" name="__codelineno-1-70"></a><a href="#__codelineno-1-70"><span class="linenos" data-linenos="70 "></span></a>}
<a id="__codelineno-1-71" name="__codelineno-1-71"></a><a href="#__codelineno-1-71"><span class="linenos" data-linenos="71 "></span></a>opset_import {
<a id="__codelineno-1-72" name="__codelineno-1-72"></a><a href="#__codelineno-1-72"><span class="linenos" data-linenos="72 "></span></a>  version: 23
<a id="__codelineno-1-73" name="__codelineno-1-73"></a><a href="#__codelineno-1-73"><span class="linenos" data-linenos="73 "></span></a>}
</code></pre></div>
</details>

<h3 id="_4">可视化显示</h3>
<p>上述的计算图可视化的表示如下所示：</p>
<p><img alt="线性回归模型onnx计算图" src="../img/dot_linreg.png" /></p>
<h3 id="-shape">特殊节点-形状shape为空</h3>
<p>空形状 (shape为None) 表示任意形状，定义为 <code>[None, None]</code> 的形状，表示此对象是二维张量，无需进一步的精度限制。还可以通过查看图中每个对象的字段来检查 ONNX 图。</p>
<h4 id="_5">有空形状节点计算图构图代码</h4>
<details>
  <summary> 空形状计算图 </summary>

<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">TensorProto</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">make_graph</span><span class="p">,</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_tensor_value_info</span><span class="p">)</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><a href="#__codelineno-2-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><a href="#__codelineno-2-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">shape2tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><a href="#__codelineno-2-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s1">&#39;dim_value&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><a href="#__codelineno-2-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><a href="#__codelineno-2-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><a href="#__codelineno-2-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><a href="#__codelineno-2-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><a href="#__codelineno-2-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><a href="#__codelineno-2-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">node1</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">])</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><a href="#__codelineno-2-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><a href="#__codelineno-2-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">([</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">],</span> <span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><a href="#__codelineno-2-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><a href="#__codelineno-2-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><a href="#__codelineno-2-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><a href="#__codelineno-2-20"><span class="linenos" data-linenos="20 "></span></a><span class="c1"># the list of inputs</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><a href="#__codelineno-2-21"><span class="linenos" data-linenos="21 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** inputs **&#39;</span><span class="p">)</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><a href="#__codelineno-2-22"><span class="linenos" data-linenos="22 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><a href="#__codelineno-2-23"><span class="linenos" data-linenos="23 "></span></a>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><a href="#__codelineno-2-24"><span class="linenos" data-linenos="24 "></span></a><span class="c1"># in a more nicely format</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><a href="#__codelineno-2-25"><span class="linenos" data-linenos="25 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** inputs **&#39;</span><span class="p">)</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a><a href="#__codelineno-2-26"><span class="linenos" data-linenos="26 "></span></a><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">input</span><span class="p">:</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a><a href="#__codelineno-2-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;name=</span><span class="si">%r</span><span class="s2"> dtype=</span><span class="si">%r</span><span class="s2"> shape=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><a href="#__codelineno-2-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">tensor_type</span><span class="o">.</span><span class="n">elem_type</span><span class="p">,</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><a href="#__codelineno-2-29"><span class="linenos" data-linenos="29 "></span></a>        <span class="n">shape2tuple</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">tensor_type</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a><a href="#__codelineno-2-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a><a href="#__codelineno-2-31"><span class="linenos" data-linenos="31 "></span></a><span class="c1"># the list of outputs</span>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a><a href="#__codelineno-2-32"><span class="linenos" data-linenos="32 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** outputs **&#39;</span><span class="p">)</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a><a href="#__codelineno-2-33"><span class="linenos" data-linenos="33 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a><a href="#__codelineno-2-34"><span class="linenos" data-linenos="34 "></span></a>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a><a href="#__codelineno-2-35"><span class="linenos" data-linenos="35 "></span></a><span class="c1"># in a more nicely format</span>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a><a href="#__codelineno-2-36"><span class="linenos" data-linenos="36 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** outputs **&#39;</span><span class="p">)</span>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a><a href="#__codelineno-2-37"><span class="linenos" data-linenos="37 "></span></a><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a><a href="#__codelineno-2-38"><span class="linenos" data-linenos="38 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;name=</span><span class="si">%r</span><span class="s2"> dtype=</span><span class="si">%r</span><span class="s2"> shape=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a><a href="#__codelineno-2-39"><span class="linenos" data-linenos="39 "></span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">tensor_type</span><span class="o">.</span><span class="n">elem_type</span><span class="p">,</span>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a><a href="#__codelineno-2-40"><span class="linenos" data-linenos="40 "></span></a>        <span class="n">shape2tuple</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">tensor_type</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a><a href="#__codelineno-2-41"><span class="linenos" data-linenos="41 "></span></a>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a><a href="#__codelineno-2-42"><span class="linenos" data-linenos="42 "></span></a><span class="c1"># the list of nodes</span>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a><a href="#__codelineno-2-43"><span class="linenos" data-linenos="43 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** nodes **&#39;</span><span class="p">)</span>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a><a href="#__codelineno-2-44"><span class="linenos" data-linenos="44 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a><a href="#__codelineno-2-45"><span class="linenos" data-linenos="45 "></span></a>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a><a href="#__codelineno-2-46"><span class="linenos" data-linenos="46 "></span></a><span class="c1"># in a more nicely format</span>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a><a href="#__codelineno-2-47"><span class="linenos" data-linenos="47 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** nodes **&#39;</span><span class="p">)</span>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a><a href="#__codelineno-2-48"><span class="linenos" data-linenos="48 "></span></a><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a><a href="#__codelineno-2-49"><span class="linenos" data-linenos="49 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;name=</span><span class="si">%r</span><span class="s2"> type=</span><span class="si">%r</span><span class="s2"> input=</span><span class="si">%r</span><span class="s2"> output=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a><a href="#__codelineno-2-50"><span class="linenos" data-linenos="50 "></span></a>        <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">op_type</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">output</span><span class="p">))</span>
</code></pre></div>
</details>

<details>
  <summary> 打印json格式的onnx计算图</summary>

<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos=" 1 "></span></a>**<span class="w"> </span>inputs<span class="w"> </span>**
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="o">[</span>name:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">  </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><a href="#__codelineno-3-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">      </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><a href="#__codelineno-3-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><a href="#__codelineno-3-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">      </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><a href="#__codelineno-3-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><a href="#__codelineno-3-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><a href="#__codelineno-3-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><a href="#__codelineno-3-13"><span class="linenos" data-linenos="13 "></span></a><span class="o">}</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><a href="#__codelineno-3-14"><span class="linenos" data-linenos="14 "></span></a>,<span class="w"> </span>name:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><a href="#__codelineno-3-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><a href="#__codelineno-3-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">  </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><a href="#__codelineno-3-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><a href="#__codelineno-3-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><a href="#__codelineno-3-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">      </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><a href="#__codelineno-3-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><a href="#__codelineno-3-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">      </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><a href="#__codelineno-3-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><a href="#__codelineno-3-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><a href="#__codelineno-3-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a><a href="#__codelineno-3-25"><span class="linenos" data-linenos="25 "></span></a><span class="o">}</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a><a href="#__codelineno-3-26"><span class="linenos" data-linenos="26 "></span></a>,<span class="w"> </span>name:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a><a href="#__codelineno-3-27"><span class="linenos" data-linenos="27 "></span></a><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a><a href="#__codelineno-3-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">  </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a><a href="#__codelineno-3-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">    </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-3-30" name="__codelineno-3-30"></a><a href="#__codelineno-3-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">    </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-31" name="__codelineno-3-31"></a><a href="#__codelineno-3-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">      </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-32" name="__codelineno-3-32"></a><a href="#__codelineno-3-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-3-33" name="__codelineno-3-33"></a><a href="#__codelineno-3-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">      </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-34" name="__codelineno-3-34"></a><a href="#__codelineno-3-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-3-35" name="__codelineno-3-35"></a><a href="#__codelineno-3-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-3-36" name="__codelineno-3-36"></a><a href="#__codelineno-3-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-3-37" name="__codelineno-3-37"></a><a href="#__codelineno-3-37"><span class="linenos" data-linenos="37 "></span></a><span class="o">}</span>
<a id="__codelineno-3-38" name="__codelineno-3-38"></a><a href="#__codelineno-3-38"><span class="linenos" data-linenos="38 "></span></a><span class="o">]</span>
<a id="__codelineno-3-39" name="__codelineno-3-39"></a><a href="#__codelineno-3-39"><span class="linenos" data-linenos="39 "></span></a>**<span class="w"> </span>inputs<span class="w"> </span>**
<a id="__codelineno-3-40" name="__codelineno-3-40"></a><a href="#__codelineno-3-40"><span class="linenos" data-linenos="40 "></span></a><span class="nv">name</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="w"> </span><span class="nv">dtype</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">shape</span><span class="o">=(</span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span>
<a id="__codelineno-3-41" name="__codelineno-3-41"></a><a href="#__codelineno-3-41"><span class="linenos" data-linenos="41 "></span></a><span class="nv">name</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="w"> </span><span class="nv">dtype</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">shape</span><span class="o">=(</span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span>
<a id="__codelineno-3-42" name="__codelineno-3-42"></a><a href="#__codelineno-3-42"><span class="linenos" data-linenos="42 "></span></a><span class="nv">name</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="w"> </span><span class="nv">dtype</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">shape</span><span class="o">=(</span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span>
<a id="__codelineno-3-43" name="__codelineno-3-43"></a><a href="#__codelineno-3-43"><span class="linenos" data-linenos="43 "></span></a>**<span class="w"> </span>outputs<span class="w"> </span>**
<a id="__codelineno-3-44" name="__codelineno-3-44"></a><a href="#__codelineno-3-44"><span class="linenos" data-linenos="44 "></span></a><span class="o">[</span>name:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-3-45" name="__codelineno-3-45"></a><a href="#__codelineno-3-45"><span class="linenos" data-linenos="45 "></span></a><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-46" name="__codelineno-3-46"></a><a href="#__codelineno-3-46"><span class="linenos" data-linenos="46 "></span></a><span class="w">  </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-47" name="__codelineno-3-47"></a><a href="#__codelineno-3-47"><span class="linenos" data-linenos="47 "></span></a><span class="w">    </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-3-48" name="__codelineno-3-48"></a><a href="#__codelineno-3-48"><span class="linenos" data-linenos="48 "></span></a><span class="w">    </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-49" name="__codelineno-3-49"></a><a href="#__codelineno-3-49"><span class="linenos" data-linenos="49 "></span></a><span class="w">      </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-50" name="__codelineno-3-50"></a><a href="#__codelineno-3-50"><span class="linenos" data-linenos="50 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-3-51" name="__codelineno-3-51"></a><a href="#__codelineno-3-51"><span class="linenos" data-linenos="51 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-3-52" name="__codelineno-3-52"></a><a href="#__codelineno-3-52"><span class="linenos" data-linenos="52 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-3-53" name="__codelineno-3-53"></a><a href="#__codelineno-3-53"><span class="linenos" data-linenos="53 "></span></a><span class="o">}</span>
<a id="__codelineno-3-54" name="__codelineno-3-54"></a><a href="#__codelineno-3-54"><span class="linenos" data-linenos="54 "></span></a><span class="o">]</span>
<a id="__codelineno-3-55" name="__codelineno-3-55"></a><a href="#__codelineno-3-55"><span class="linenos" data-linenos="55 "></span></a>**<span class="w"> </span>outputs<span class="w"> </span>**
<a id="__codelineno-3-56" name="__codelineno-3-56"></a><a href="#__codelineno-3-56"><span class="linenos" data-linenos="56 "></span></a><span class="nv">name</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="w"> </span><span class="nv">dtype</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">shape</span><span class="o">=(</span><span class="m">0</span>,<span class="o">)</span>
<a id="__codelineno-3-57" name="__codelineno-3-57"></a><a href="#__codelineno-3-57"><span class="linenos" data-linenos="57 "></span></a>**<span class="w"> </span>nodes<span class="w"> </span>**
<a id="__codelineno-3-58" name="__codelineno-3-58"></a><a href="#__codelineno-3-58"><span class="linenos" data-linenos="58 "></span></a><span class="o">[</span>input:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-3-59" name="__codelineno-3-59"></a><a href="#__codelineno-3-59"><span class="linenos" data-linenos="59 "></span></a>input:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-3-60" name="__codelineno-3-60"></a><a href="#__codelineno-3-60"><span class="linenos" data-linenos="60 "></span></a>output:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-3-61" name="__codelineno-3-61"></a><a href="#__codelineno-3-61"><span class="linenos" data-linenos="61 "></span></a>op_type:<span class="w"> </span><span class="s2">&quot;MatMul&quot;</span>
<a id="__codelineno-3-62" name="__codelineno-3-62"></a><a href="#__codelineno-3-62"><span class="linenos" data-linenos="62 "></span></a>,<span class="w"> </span>input:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-3-63" name="__codelineno-3-63"></a><a href="#__codelineno-3-63"><span class="linenos" data-linenos="63 "></span></a>input:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-3-64" name="__codelineno-3-64"></a><a href="#__codelineno-3-64"><span class="linenos" data-linenos="64 "></span></a>output:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-3-65" name="__codelineno-3-65"></a><a href="#__codelineno-3-65"><span class="linenos" data-linenos="65 "></span></a>op_type:<span class="w"> </span><span class="s2">&quot;Add&quot;</span>
<a id="__codelineno-3-66" name="__codelineno-3-66"></a><a href="#__codelineno-3-66"><span class="linenos" data-linenos="66 "></span></a><span class="o">]</span>
<a id="__codelineno-3-67" name="__codelineno-3-67"></a><a href="#__codelineno-3-67"><span class="linenos" data-linenos="67 "></span></a>**<span class="w"> </span>nodes<span class="w"> </span>**
<a id="__codelineno-3-68" name="__codelineno-3-68"></a><a href="#__codelineno-3-68"><span class="linenos" data-linenos="68 "></span></a><span class="nv">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s1">&#39;MatMul&#39;</span><span class="w"> </span><span class="nv">input</span><span class="o">=[</span><span class="s1">&#39;X&#39;</span>,<span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="o">]</span><span class="w"> </span><span class="nv">output</span><span class="o">=[</span><span class="s1">&#39;XA&#39;</span><span class="o">]</span>
<a id="__codelineno-3-69" name="__codelineno-3-69"></a><a href="#__codelineno-3-69"><span class="linenos" data-linenos="69 "></span></a><span class="nv">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s1">&#39;Add&#39;</span><span class="w"> </span><span class="nv">input</span><span class="o">=[</span><span class="s1">&#39;XA&#39;</span>,<span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="o">]</span><span class="w"> </span><span class="nv">output</span><span class="o">=[</span><span class="s1">&#39;Y&#39;</span><span class="o">]</span>
</code></pre></div>
</details>

<h4 id="_6">其他</h4>
<p>张量 <strong>类型</strong> 是整数（=1）。辅助函数 <code>onnx.helper.tensor_dtype_to_np_dtype()</code> 给出了 <code>numpy</code> 对应类型的映射关系。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">TensorProto</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><a href="#__codelineno-4-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor_dtype_to_np_dtype</span><span class="p">,</span> <span class="n">tensor_dtype_to_string</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><a href="#__codelineno-4-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><a href="#__codelineno-4-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">np_dtype</span> <span class="o">=</span> <span class="n">tensor_dtype_to_np_dtype</span><span class="p">(</span><span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">)</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><a href="#__codelineno-4-5"><span class="linenos" data-linenos="5 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The converted numpy dtype for </span><span class="si">{</span><span class="n">tensor_dtype_to_string</span><span class="p">(</span><span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">)</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">np_dtype</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos="1 "></span></a>The<span class="w"> </span>converted<span class="w"> </span>numpy<span class="w"> </span>dtype<span class="w"> </span><span class="k">for</span><span class="w"> </span>TensorProto.FLOAT<span class="w"> </span>is<span class="w"> </span>float32.
</code></pre></div>
<h2 id="_7">序列化</h2>
<p>ONNX 建立在 protobuf 之上。ONNX 添加了描述机器学习模型所需的定义。大多数情况下，ONNX 用于序列化或反序列化一个模型模型。第一部分解决了这一需求（如何描述机器学习模型）。第二部分介绍了张量、稀疏张量等数据的序列化和反序列化。</p>
<h3 id="_8">模型序列化</h3>
<p>需要保存模型才能部署。ONNX 基于 protobuf。它最大限度地减少了在磁盘上保存图形所需的空间。onnx 中的每个对象（参见Protos）都可以使用方法 <code>SerializeToString</code> 序列化。整个模型也可以操作。</p>
<details>
  <summary> 模型序列化 </summary>

<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">TensorProto</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><a href="#__codelineno-6-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><a href="#__codelineno-6-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">make_graph</span><span class="p">,</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><a href="#__codelineno-6-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_tensor_value_info</span><span class="p">)</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><a href="#__codelineno-6-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><a href="#__codelineno-6-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><a href="#__codelineno-6-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">shape2tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><a href="#__codelineno-6-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s1">&#39;dim_value&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><a href="#__codelineno-6-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><a href="#__codelineno-6-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><a href="#__codelineno-6-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><a href="#__codelineno-6-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><a href="#__codelineno-6-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><a href="#__codelineno-6-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">node1</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">])</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><a href="#__codelineno-6-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><a href="#__codelineno-6-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">([</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">],</span> <span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><a href="#__codelineno-6-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><a href="#__codelineno-6-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><a href="#__codelineno-6-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><a href="#__codelineno-6-20"><span class="linenos" data-linenos="20 "></span></a><span class="c1"># The serialization</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><a href="#__codelineno-6-21"><span class="linenos" data-linenos="21 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;linear_regression.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><a href="#__codelineno-6-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><a href="#__codelineno-6-23"><span class="linenos" data-linenos="23 "></span></a>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><a href="#__codelineno-6-24"><span class="linenos" data-linenos="24 "></span></a><span class="c1"># display</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><a href="#__codelineno-6-25"><span class="linenos" data-linenos="25 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
</code></pre></div>
</details>

<details>
  <summary> 模型序列化之后输出的内容：json格式</summary>

<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos=" 1 "></span></a>ir_version:<span class="w"> </span><span class="m">11</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><a href="#__codelineno-7-2"><span class="linenos" data-linenos=" 2 "></span></a>graph<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><a href="#__codelineno-7-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><a href="#__codelineno-7-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><a href="#__codelineno-7-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><a href="#__codelineno-7-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><a href="#__codelineno-7-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;MatMul&quot;</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><a href="#__codelineno-7-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><a href="#__codelineno-7-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><a href="#__codelineno-7-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><a href="#__codelineno-7-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><a href="#__codelineno-7-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a><a href="#__codelineno-7-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;Add&quot;</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a><a href="#__codelineno-7-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><a href="#__codelineno-7-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">  </span>name:<span class="w"> </span><span class="s2">&quot;lr&quot;</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a><a href="#__codelineno-7-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a><a href="#__codelineno-7-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a><a href="#__codelineno-7-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a><a href="#__codelineno-7-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a><a href="#__codelineno-7-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a><a href="#__codelineno-7-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a><a href="#__codelineno-7-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a><a href="#__codelineno-7-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a><a href="#__codelineno-7-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a><a href="#__codelineno-7-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a><a href="#__codelineno-7-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a><a href="#__codelineno-7-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a><a href="#__codelineno-7-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a><a href="#__codelineno-7-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-7-30" name="__codelineno-7-30"></a><a href="#__codelineno-7-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-31" name="__codelineno-7-31"></a><a href="#__codelineno-7-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-7-32" name="__codelineno-7-32"></a><a href="#__codelineno-7-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-33" name="__codelineno-7-33"></a><a href="#__codelineno-7-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-34" name="__codelineno-7-34"></a><a href="#__codelineno-7-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-7-35" name="__codelineno-7-35"></a><a href="#__codelineno-7-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-36" name="__codelineno-7-36"></a><a href="#__codelineno-7-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-37" name="__codelineno-7-37"></a><a href="#__codelineno-7-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-7-38" name="__codelineno-7-38"></a><a href="#__codelineno-7-38"><span class="linenos" data-linenos="38 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-39" name="__codelineno-7-39"></a><a href="#__codelineno-7-39"><span class="linenos" data-linenos="39 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-7-40" name="__codelineno-7-40"></a><a href="#__codelineno-7-40"><span class="linenos" data-linenos="40 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-7-41" name="__codelineno-7-41"></a><a href="#__codelineno-7-41"><span class="linenos" data-linenos="41 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-7-42" name="__codelineno-7-42"></a><a href="#__codelineno-7-42"><span class="linenos" data-linenos="42 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-7-43" name="__codelineno-7-43"></a><a href="#__codelineno-7-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-7-44" name="__codelineno-7-44"></a><a href="#__codelineno-7-44"><span class="linenos" data-linenos="44 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-45" name="__codelineno-7-45"></a><a href="#__codelineno-7-45"><span class="linenos" data-linenos="45 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-7-46" name="__codelineno-7-46"></a><a href="#__codelineno-7-46"><span class="linenos" data-linenos="46 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-47" name="__codelineno-7-47"></a><a href="#__codelineno-7-47"><span class="linenos" data-linenos="47 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-48" name="__codelineno-7-48"></a><a href="#__codelineno-7-48"><span class="linenos" data-linenos="48 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-7-49" name="__codelineno-7-49"></a><a href="#__codelineno-7-49"><span class="linenos" data-linenos="49 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-50" name="__codelineno-7-50"></a><a href="#__codelineno-7-50"><span class="linenos" data-linenos="50 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-51" name="__codelineno-7-51"></a><a href="#__codelineno-7-51"><span class="linenos" data-linenos="51 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-7-52" name="__codelineno-7-52"></a><a href="#__codelineno-7-52"><span class="linenos" data-linenos="52 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-53" name="__codelineno-7-53"></a><a href="#__codelineno-7-53"><span class="linenos" data-linenos="53 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-7-54" name="__codelineno-7-54"></a><a href="#__codelineno-7-54"><span class="linenos" data-linenos="54 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-7-55" name="__codelineno-7-55"></a><a href="#__codelineno-7-55"><span class="linenos" data-linenos="55 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-7-56" name="__codelineno-7-56"></a><a href="#__codelineno-7-56"><span class="linenos" data-linenos="56 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-7-57" name="__codelineno-7-57"></a><a href="#__codelineno-7-57"><span class="linenos" data-linenos="57 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-7-58" name="__codelineno-7-58"></a><a href="#__codelineno-7-58"><span class="linenos" data-linenos="58 "></span></a><span class="w">  </span>output<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-59" name="__codelineno-7-59"></a><a href="#__codelineno-7-59"><span class="linenos" data-linenos="59 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-7-60" name="__codelineno-7-60"></a><a href="#__codelineno-7-60"><span class="linenos" data-linenos="60 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-61" name="__codelineno-7-61"></a><a href="#__codelineno-7-61"><span class="linenos" data-linenos="61 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-62" name="__codelineno-7-62"></a><a href="#__codelineno-7-62"><span class="linenos" data-linenos="62 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-7-63" name="__codelineno-7-63"></a><a href="#__codelineno-7-63"><span class="linenos" data-linenos="63 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-64" name="__codelineno-7-64"></a><a href="#__codelineno-7-64"><span class="linenos" data-linenos="64 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-65" name="__codelineno-7-65"></a><a href="#__codelineno-7-65"><span class="linenos" data-linenos="65 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-7-66" name="__codelineno-7-66"></a><a href="#__codelineno-7-66"><span class="linenos" data-linenos="66 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-7-67" name="__codelineno-7-67"></a><a href="#__codelineno-7-67"><span class="linenos" data-linenos="67 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-7-68" name="__codelineno-7-68"></a><a href="#__codelineno-7-68"><span class="linenos" data-linenos="68 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-7-69" name="__codelineno-7-69"></a><a href="#__codelineno-7-69"><span class="linenos" data-linenos="69 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-7-70" name="__codelineno-7-70"></a><a href="#__codelineno-7-70"><span class="linenos" data-linenos="70 "></span></a><span class="o">}</span>
<a id="__codelineno-7-71" name="__codelineno-7-71"></a><a href="#__codelineno-7-71"><span class="linenos" data-linenos="71 "></span></a>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-7-72" name="__codelineno-7-72"></a><a href="#__codelineno-7-72"><span class="linenos" data-linenos="72 "></span></a><span class="w">  </span>version:<span class="w"> </span><span class="m">23</span>
<a id="__codelineno-7-73" name="__codelineno-7-73"></a><a href="#__codelineno-7-73"><span class="linenos" data-linenos="73 "></span></a><span class="o">}</span>
</code></pre></div>
</details>

<p>可以使用以下 <code>load</code> 函数恢复计算：
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">load</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><a href="#__codelineno-8-2"><span class="linenos" data-linenos="2 "></span></a>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><a href="#__codelineno-8-3"><span class="linenos" data-linenos="3 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;linear_regression.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><a href="#__codelineno-8-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">onnx_model</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><a href="#__codelineno-8-5"><span class="linenos" data-linenos="5 "></span></a>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><a href="#__codelineno-8-6"><span class="linenos" data-linenos="6 "></span></a><span class="c1"># display</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><a href="#__codelineno-8-7"><span class="linenos" data-linenos="7 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
</code></pre></div></p>
<details>
  <summary> 反序列化之后的onnx模型: json格式 </summary>

<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos=" 1 "></span></a>ir_version: 11
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><a href="#__codelineno-9-2"><span class="linenos" data-linenos=" 2 "></span></a>graph {
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><a href="#__codelineno-9-3"><span class="linenos" data-linenos=" 3 "></span></a>  node {
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><a href="#__codelineno-9-4"><span class="linenos" data-linenos=" 4 "></span></a>    input: &quot;X&quot;
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><a href="#__codelineno-9-5"><span class="linenos" data-linenos=" 5 "></span></a>    input: &quot;A&quot;
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><a href="#__codelineno-9-6"><span class="linenos" data-linenos=" 6 "></span></a>    output: &quot;XA&quot;
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><a href="#__codelineno-9-7"><span class="linenos" data-linenos=" 7 "></span></a>    op_type: &quot;MatMul&quot;
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><a href="#__codelineno-9-8"><span class="linenos" data-linenos=" 8 "></span></a>  }
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><a href="#__codelineno-9-9"><span class="linenos" data-linenos=" 9 "></span></a>  node {
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><a href="#__codelineno-9-10"><span class="linenos" data-linenos="10 "></span></a>    input: &quot;XA&quot;
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><a href="#__codelineno-9-11"><span class="linenos" data-linenos="11 "></span></a>    input: &quot;B&quot;
<a id="__codelineno-9-12" name="__codelineno-9-12"></a><a href="#__codelineno-9-12"><span class="linenos" data-linenos="12 "></span></a>    output: &quot;Y&quot;
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><a href="#__codelineno-9-13"><span class="linenos" data-linenos="13 "></span></a>    op_type: &quot;Add&quot;
<a id="__codelineno-9-14" name="__codelineno-9-14"></a><a href="#__codelineno-9-14"><span class="linenos" data-linenos="14 "></span></a>  }
<a id="__codelineno-9-15" name="__codelineno-9-15"></a><a href="#__codelineno-9-15"><span class="linenos" data-linenos="15 "></span></a>  name: &quot;lr&quot;
<a id="__codelineno-9-16" name="__codelineno-9-16"></a><a href="#__codelineno-9-16"><span class="linenos" data-linenos="16 "></span></a>  input {
<a id="__codelineno-9-17" name="__codelineno-9-17"></a><a href="#__codelineno-9-17"><span class="linenos" data-linenos="17 "></span></a>    name: &quot;X&quot;
<a id="__codelineno-9-18" name="__codelineno-9-18"></a><a href="#__codelineno-9-18"><span class="linenos" data-linenos="18 "></span></a>    type {
<a id="__codelineno-9-19" name="__codelineno-9-19"></a><a href="#__codelineno-9-19"><span class="linenos" data-linenos="19 "></span></a>      tensor_type {
<a id="__codelineno-9-20" name="__codelineno-9-20"></a><a href="#__codelineno-9-20"><span class="linenos" data-linenos="20 "></span></a>        elem_type: 1
<a id="__codelineno-9-21" name="__codelineno-9-21"></a><a href="#__codelineno-9-21"><span class="linenos" data-linenos="21 "></span></a>        shape {
<a id="__codelineno-9-22" name="__codelineno-9-22"></a><a href="#__codelineno-9-22"><span class="linenos" data-linenos="22 "></span></a>          dim {
<a id="__codelineno-9-23" name="__codelineno-9-23"></a><a href="#__codelineno-9-23"><span class="linenos" data-linenos="23 "></span></a>          }
<a id="__codelineno-9-24" name="__codelineno-9-24"></a><a href="#__codelineno-9-24"><span class="linenos" data-linenos="24 "></span></a>          dim {
<a id="__codelineno-9-25" name="__codelineno-9-25"></a><a href="#__codelineno-9-25"><span class="linenos" data-linenos="25 "></span></a>          }
<a id="__codelineno-9-26" name="__codelineno-9-26"></a><a href="#__codelineno-9-26"><span class="linenos" data-linenos="26 "></span></a>        }
<a id="__codelineno-9-27" name="__codelineno-9-27"></a><a href="#__codelineno-9-27"><span class="linenos" data-linenos="27 "></span></a>      }
<a id="__codelineno-9-28" name="__codelineno-9-28"></a><a href="#__codelineno-9-28"><span class="linenos" data-linenos="28 "></span></a>    }
<a id="__codelineno-9-29" name="__codelineno-9-29"></a><a href="#__codelineno-9-29"><span class="linenos" data-linenos="29 "></span></a>  }
<a id="__codelineno-9-30" name="__codelineno-9-30"></a><a href="#__codelineno-9-30"><span class="linenos" data-linenos="30 "></span></a>  input {
<a id="__codelineno-9-31" name="__codelineno-9-31"></a><a href="#__codelineno-9-31"><span class="linenos" data-linenos="31 "></span></a>    name: &quot;A&quot;
<a id="__codelineno-9-32" name="__codelineno-9-32"></a><a href="#__codelineno-9-32"><span class="linenos" data-linenos="32 "></span></a>    type {
<a id="__codelineno-9-33" name="__codelineno-9-33"></a><a href="#__codelineno-9-33"><span class="linenos" data-linenos="33 "></span></a>      tensor_type {
<a id="__codelineno-9-34" name="__codelineno-9-34"></a><a href="#__codelineno-9-34"><span class="linenos" data-linenos="34 "></span></a>        elem_type: 1
<a id="__codelineno-9-35" name="__codelineno-9-35"></a><a href="#__codelineno-9-35"><span class="linenos" data-linenos="35 "></span></a>        shape {
<a id="__codelineno-9-36" name="__codelineno-9-36"></a><a href="#__codelineno-9-36"><span class="linenos" data-linenos="36 "></span></a>          dim {
<a id="__codelineno-9-37" name="__codelineno-9-37"></a><a href="#__codelineno-9-37"><span class="linenos" data-linenos="37 "></span></a>          }
<a id="__codelineno-9-38" name="__codelineno-9-38"></a><a href="#__codelineno-9-38"><span class="linenos" data-linenos="38 "></span></a>          dim {
<a id="__codelineno-9-39" name="__codelineno-9-39"></a><a href="#__codelineno-9-39"><span class="linenos" data-linenos="39 "></span></a>          }
<a id="__codelineno-9-40" name="__codelineno-9-40"></a><a href="#__codelineno-9-40"><span class="linenos" data-linenos="40 "></span></a>        }
<a id="__codelineno-9-41" name="__codelineno-9-41"></a><a href="#__codelineno-9-41"><span class="linenos" data-linenos="41 "></span></a>      }
<a id="__codelineno-9-42" name="__codelineno-9-42"></a><a href="#__codelineno-9-42"><span class="linenos" data-linenos="42 "></span></a>    }
<a id="__codelineno-9-43" name="__codelineno-9-43"></a><a href="#__codelineno-9-43"><span class="linenos" data-linenos="43 "></span></a>  }
<a id="__codelineno-9-44" name="__codelineno-9-44"></a><a href="#__codelineno-9-44"><span class="linenos" data-linenos="44 "></span></a>  input {
<a id="__codelineno-9-45" name="__codelineno-9-45"></a><a href="#__codelineno-9-45"><span class="linenos" data-linenos="45 "></span></a>    name: &quot;B&quot;
<a id="__codelineno-9-46" name="__codelineno-9-46"></a><a href="#__codelineno-9-46"><span class="linenos" data-linenos="46 "></span></a>    type {
<a id="__codelineno-9-47" name="__codelineno-9-47"></a><a href="#__codelineno-9-47"><span class="linenos" data-linenos="47 "></span></a>      tensor_type {
<a id="__codelineno-9-48" name="__codelineno-9-48"></a><a href="#__codelineno-9-48"><span class="linenos" data-linenos="48 "></span></a>        elem_type: 1
<a id="__codelineno-9-49" name="__codelineno-9-49"></a><a href="#__codelineno-9-49"><span class="linenos" data-linenos="49 "></span></a>        shape {
<a id="__codelineno-9-50" name="__codelineno-9-50"></a><a href="#__codelineno-9-50"><span class="linenos" data-linenos="50 "></span></a>          dim {
<a id="__codelineno-9-51" name="__codelineno-9-51"></a><a href="#__codelineno-9-51"><span class="linenos" data-linenos="51 "></span></a>          }
<a id="__codelineno-9-52" name="__codelineno-9-52"></a><a href="#__codelineno-9-52"><span class="linenos" data-linenos="52 "></span></a>          dim {
<a id="__codelineno-9-53" name="__codelineno-9-53"></a><a href="#__codelineno-9-53"><span class="linenos" data-linenos="53 "></span></a>          }
<a id="__codelineno-9-54" name="__codelineno-9-54"></a><a href="#__codelineno-9-54"><span class="linenos" data-linenos="54 "></span></a>        }
<a id="__codelineno-9-55" name="__codelineno-9-55"></a><a href="#__codelineno-9-55"><span class="linenos" data-linenos="55 "></span></a>      }
<a id="__codelineno-9-56" name="__codelineno-9-56"></a><a href="#__codelineno-9-56"><span class="linenos" data-linenos="56 "></span></a>    }
<a id="__codelineno-9-57" name="__codelineno-9-57"></a><a href="#__codelineno-9-57"><span class="linenos" data-linenos="57 "></span></a>  }
<a id="__codelineno-9-58" name="__codelineno-9-58"></a><a href="#__codelineno-9-58"><span class="linenos" data-linenos="58 "></span></a>  output {
<a id="__codelineno-9-59" name="__codelineno-9-59"></a><a href="#__codelineno-9-59"><span class="linenos" data-linenos="59 "></span></a>    name: &quot;Y&quot;
<a id="__codelineno-9-60" name="__codelineno-9-60"></a><a href="#__codelineno-9-60"><span class="linenos" data-linenos="60 "></span></a>    type {
<a id="__codelineno-9-61" name="__codelineno-9-61"></a><a href="#__codelineno-9-61"><span class="linenos" data-linenos="61 "></span></a>      tensor_type {
<a id="__codelineno-9-62" name="__codelineno-9-62"></a><a href="#__codelineno-9-62"><span class="linenos" data-linenos="62 "></span></a>        elem_type: 1
<a id="__codelineno-9-63" name="__codelineno-9-63"></a><a href="#__codelineno-9-63"><span class="linenos" data-linenos="63 "></span></a>        shape {
<a id="__codelineno-9-64" name="__codelineno-9-64"></a><a href="#__codelineno-9-64"><span class="linenos" data-linenos="64 "></span></a>          dim {
<a id="__codelineno-9-65" name="__codelineno-9-65"></a><a href="#__codelineno-9-65"><span class="linenos" data-linenos="65 "></span></a>          }
<a id="__codelineno-9-66" name="__codelineno-9-66"></a><a href="#__codelineno-9-66"><span class="linenos" data-linenos="66 "></span></a>        }
<a id="__codelineno-9-67" name="__codelineno-9-67"></a><a href="#__codelineno-9-67"><span class="linenos" data-linenos="67 "></span></a>      }
<a id="__codelineno-9-68" name="__codelineno-9-68"></a><a href="#__codelineno-9-68"><span class="linenos" data-linenos="68 "></span></a>    }
<a id="__codelineno-9-69" name="__codelineno-9-69"></a><a href="#__codelineno-9-69"><span class="linenos" data-linenos="69 "></span></a>  }
<a id="__codelineno-9-70" name="__codelineno-9-70"></a><a href="#__codelineno-9-70"><span class="linenos" data-linenos="70 "></span></a>}
<a id="__codelineno-9-71" name="__codelineno-9-71"></a><a href="#__codelineno-9-71"><span class="linenos" data-linenos="71 "></span></a>opset_import {
<a id="__codelineno-9-72" name="__codelineno-9-72"></a><a href="#__codelineno-9-72"><span class="linenos" data-linenos="72 "></span></a>  version: 23
<a id="__codelineno-9-73" name="__codelineno-9-73"></a><a href="#__codelineno-9-73"><span class="linenos" data-linenos="73 "></span></a>}
</code></pre></div>

</details>

<p>看起来完全一样。任何模型都可以通过这种方式序列化，<strong> 除非它们大于 2 Gb</strong> 。protobuf 的大小限制小于此阈值。下一节将展示如何克服该限制。</p>
<p><code>#################################################################################</code>
<code>###############################onnx坑爹的地方，模型空间 2G 限制######################</code>
<code>###############################onnx坑爹的地方，模型空间 2G 限制######################</code>
<code>###############################onnx坑爹的地方，模型空间 2G 限制######################</code>
<code>#################################################################################</code></p>
<h3 id="_9">数据序列化</h3>
<p>张量的序列化通常如下进行：</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><a href="#__codelineno-10-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><a href="#__codelineno-10-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.numpy_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">from_array</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><a href="#__codelineno-10-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><a href="#__codelineno-10-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">numpy_tensor</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><a href="#__codelineno-10-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">numpy_tensor</span><span class="p">))</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><a href="#__codelineno-10-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><a href="#__codelineno-10-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">onnx_tensor</span> <span class="o">=</span> <span class="n">from_array</span><span class="p">(</span><span class="n">numpy_tensor</span><span class="p">)</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><a href="#__codelineno-10-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">onnx_tensor</span><span class="p">))</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><a href="#__codelineno-10-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><a href="#__codelineno-10-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">serialized_tensor</span> <span class="o">=</span> <span class="n">onnx_tensor</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><a href="#__codelineno-10-11"><span class="linenos" data-linenos="11 "></span></a><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">serialized_tensor</span><span class="p">))</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><a href="#__codelineno-10-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><a href="#__codelineno-10-13"><span class="linenos" data-linenos="13 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;saved_tensor.pb&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><a href="#__codelineno-10-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">serialized_tensor</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><a href="#__codelineno-11-1"><span class="linenos" data-linenos="1 "></span></a>&lt;class<span class="w"> </span><span class="s1">&#39;numpy.ndarray&#39;</span>&gt;
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><a href="#__codelineno-11-2"><span class="linenos" data-linenos="2 "></span></a>&lt;class<span class="w"> </span><span class="s1">&#39;onnx.onnx_ml_pb2.TensorProto&#39;</span>&gt;
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><a href="#__codelineno-11-3"><span class="linenos" data-linenos="3 "></span></a>&lt;class<span class="w"> </span><span class="s1">&#39;bytes&#39;</span>&gt;
</code></pre></div>
<p>反序列化如下：</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><a href="#__codelineno-12-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">TensorProto</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><a href="#__codelineno-12-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.numpy_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">to_array</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><a href="#__codelineno-12-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><a href="#__codelineno-12-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;saved_tensor.pb&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><a href="#__codelineno-12-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">serialized_tensor</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><a href="#__codelineno-12-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">serialized_tensor</span><span class="p">))</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><a href="#__codelineno-12-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><a href="#__codelineno-12-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">onnx_tensor</span> <span class="o">=</span> <span class="n">TensorProto</span><span class="p">()</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><a href="#__codelineno-12-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">onnx_tensor</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="n">serialized_tensor</span><span class="p">)</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><a href="#__codelineno-12-10"><span class="linenos" data-linenos="10 "></span></a><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">onnx_tensor</span><span class="p">))</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a><a href="#__codelineno-12-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><a href="#__codelineno-12-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">numpy_tensor</span> <span class="o">=</span> <span class="n">to_array</span><span class="p">(</span><span class="n">onnx_tensor</span><span class="p">)</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a><a href="#__codelineno-12-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">numpy_tensor</span><span class="p">)</span>
</code></pre></div>
<p><div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><a href="#__codelineno-13-1"><span class="linenos" data-linenos="1 "></span></a>&lt;class<span class="w"> </span><span class="s1">&#39;bytes&#39;</span>&gt;
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><a href="#__codelineno-13-2"><span class="linenos" data-linenos="2 "></span></a>&lt;class<span class="w"> </span><span class="s1">&#39;onnx.onnx_ml_pb2.TensorProto&#39;</span>&gt;
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><a href="#__codelineno-13-3"><span class="linenos" data-linenos="3 "></span></a><span class="o">[</span><span class="m">0</span>.<span class="w"> </span><span class="m">1</span>.<span class="w"> </span><span class="m">4</span>.<span class="w"> </span><span class="m">5</span>.<span class="w"> </span><span class="m">3</span>.<span class="o">]</span>
</code></pre></div>
相同的模式可用于TensorProto （但不限于） ：
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><a href="#__codelineno-14-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><a href="#__codelineno-14-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pprint</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><a href="#__codelineno-14-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">onnx</span><span class="p">)</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><a href="#__codelineno-14-4"><span class="linenos" data-linenos="4 "></span></a>               <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;Proto&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span><span class="p">])</span>
</code></pre></div></p>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><a href="#__codelineno-15-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">[</span><span class="s1">&#39;AttributeProto&#39;</span>,
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><a href="#__codelineno-15-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w"> </span><span class="s1">&#39;FunctionProto&#39;</span>,
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><a href="#__codelineno-15-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w"> </span><span class="s1">&#39;GraphProto&#39;</span>,
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><a href="#__codelineno-15-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w"> </span><span class="s1">&#39;MapProto&#39;</span>,
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><a href="#__codelineno-15-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w"> </span><span class="s1">&#39;ModelProto&#39;</span>,
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><a href="#__codelineno-15-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w"> </span><span class="s1">&#39;NodeProto&#39;</span>,
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><a href="#__codelineno-15-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w"> </span><span class="s1">&#39;OperatorProto&#39;</span>,
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><a href="#__codelineno-15-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w"> </span><span class="s1">&#39;OperatorSetIdProto&#39;</span>,
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><a href="#__codelineno-15-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w"> </span><span class="s1">&#39;OperatorSetProto&#39;</span>,
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><a href="#__codelineno-15-10"><span class="linenos" data-linenos="10 "></span></a><span class="w"> </span><span class="s1">&#39;OptionalProto&#39;</span>,
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><a href="#__codelineno-15-11"><span class="linenos" data-linenos="11 "></span></a><span class="w"> </span><span class="s1">&#39;SequenceProto&#39;</span>,
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><a href="#__codelineno-15-12"><span class="linenos" data-linenos="12 "></span></a><span class="w"> </span><span class="s1">&#39;SparseTensorProto&#39;</span>,
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><a href="#__codelineno-15-13"><span class="linenos" data-linenos="13 "></span></a><span class="w"> </span><span class="s1">&#39;StringStringEntryProto&#39;</span>,
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><a href="#__codelineno-15-14"><span class="linenos" data-linenos="14 "></span></a><span class="w"> </span><span class="s1">&#39;TensorProto&#39;</span>,
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><a href="#__codelineno-15-15"><span class="linenos" data-linenos="15 "></span></a><span class="w"> </span><span class="s1">&#39;TensorShapeProto&#39;</span>,
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><a href="#__codelineno-15-16"><span class="linenos" data-linenos="16 "></span></a><span class="w"> </span><span class="s1">&#39;TrainingInfoProto&#39;</span>,
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><a href="#__codelineno-15-17"><span class="linenos" data-linenos="17 "></span></a><span class="w"> </span><span class="s1">&#39;TypeProto&#39;</span>,
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><a href="#__codelineno-15-18"><span class="linenos" data-linenos="18 "></span></a><span class="w"> </span><span class="s1">&#39;ValueInfoProto&#39;</span><span class="o">]</span>
</code></pre></div>
<p>该代码可以通过函数 <code>load_tensor_from_string</code> 简化 （参见加载 Proto）。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><a href="#__codelineno-16-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_tensor_from_string</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><a href="#__codelineno-16-2"><span class="linenos" data-linenos="2 "></span></a>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><a href="#__codelineno-16-3"><span class="linenos" data-linenos="3 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;saved_tensor.pb&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><a href="#__codelineno-16-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">serialized</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><a href="#__codelineno-16-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">proto</span> <span class="o">=</span> <span class="n">load_tensor_from_string</span><span class="p">(</span><span class="n">serialized</span><span class="p">)</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><a href="#__codelineno-16-6"><span class="linenos" data-linenos="6 "></span></a><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">proto</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><a href="#__codelineno-17-1"><span class="linenos" data-linenos="1 "></span></a>&lt;class<span class="w"> </span><span class="s1">&#39;onnx.onnx_ml_pb2.TensorProto&#39;</span>&gt;
</code></pre></div>
<h2 id="_10">初始化程序，默认值</h2>
<p>前一个模型假设线性回归的系数也是模型的输入。这不太方便。它们应该是模型本身的一部分，作为常量或初始化器，以遵循 onnx 语义。下一个示例模型修改了前一个示例，将输入 A 和 B 更改为初始化器。<code>onnx</code> 包实现了两个函数，用于从 <code>numpy</code> 与 <code>onnx</code> 之间相互转换（参见数组）。</p>
<ul>
<li>
<p><code>onnx.numpy_helper.to_array</code>：从 onnx 转换为 numpy</p>
</li>
<li>
<p><code>onnx.numpy_helper.from_array</code>：从 numpy 转换为 onnx</p>
</li>
</ul>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><a href="#__codelineno-18-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><a href="#__codelineno-18-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">numpy_helper</span><span class="p">,</span> <span class="n">TensorProto</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><a href="#__codelineno-18-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><a href="#__codelineno-18-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">make_graph</span><span class="p">,</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><a href="#__codelineno-18-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">make_tensor_value_info</span><span class="p">)</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><a href="#__codelineno-18-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><a href="#__codelineno-18-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><a href="#__codelineno-18-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="c1"># initializers</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><a href="#__codelineno-18-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><a href="#__codelineno-18-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">A</span> <span class="o">=</span> <span class="n">numpy_helper</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><a href="#__codelineno-18-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><a href="#__codelineno-18-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><a href="#__codelineno-18-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">C</span> <span class="o">=</span> <span class="n">numpy_helper</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a><a href="#__codelineno-18-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a><a href="#__codelineno-18-15"><span class="linenos" data-linenos="15 "></span></a><span class="c1"># the part which does not change</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a><a href="#__codelineno-18-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><a href="#__codelineno-18-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a><a href="#__codelineno-18-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">node1</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;AX&#39;</span><span class="p">])</span>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a><a href="#__codelineno-18-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;AX&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a><a href="#__codelineno-18-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">([</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">],</span> <span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">],</span> <span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">])</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a><a href="#__codelineno-18-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a><a href="#__codelineno-18-22"><span class="linenos" data-linenos="22 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a><a href="#__codelineno-18-23"><span class="linenos" data-linenos="23 "></span></a>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a><a href="#__codelineno-18-24"><span class="linenos" data-linenos="24 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
</code></pre></div>
<details> 
  <summary> 线性模型的计算图: json格式 </summary>

<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><a href="#__codelineno-19-1"><span class="linenos" data-linenos=" 1 "></span></a>ir_version:<span class="w"> </span><span class="m">11</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><a href="#__codelineno-19-2"><span class="linenos" data-linenos=" 2 "></span></a>graph<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><a href="#__codelineno-19-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><a href="#__codelineno-19-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><a href="#__codelineno-19-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><a href="#__codelineno-19-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;AX&quot;</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><a href="#__codelineno-19-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;MatMul&quot;</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><a href="#__codelineno-19-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><a href="#__codelineno-19-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><a href="#__codelineno-19-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;AX&quot;</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><a href="#__codelineno-19-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;C&quot;</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><a href="#__codelineno-19-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><a href="#__codelineno-19-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;Add&quot;</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><a href="#__codelineno-19-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><a href="#__codelineno-19-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">  </span>name:<span class="w"> </span><span class="s2">&quot;lr&quot;</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a><a href="#__codelineno-19-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">  </span>initializer<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a><a href="#__codelineno-19-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span>dims:<span class="w"> </span><span class="m">2</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a><a href="#__codelineno-19-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span>data_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a><a href="#__codelineno-19-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a><a href="#__codelineno-19-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span>raw_data:<span class="w"> </span><span class="s2">&quot;\000\000\000?\232\231\031\277&quot;</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a><a href="#__codelineno-19-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a><a href="#__codelineno-19-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">  </span>initializer<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a><a href="#__codelineno-19-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">    </span>dims:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a><a href="#__codelineno-19-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span>data_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a><a href="#__codelineno-19-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;C&quot;</span>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a><a href="#__codelineno-19-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">    </span>raw_data:<span class="w"> </span><span class="s2">&quot;\315\314\314&gt;&quot;</span>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a><a href="#__codelineno-19-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-19-28" name="__codelineno-19-28"></a><a href="#__codelineno-19-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-29" name="__codelineno-19-29"></a><a href="#__codelineno-19-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-19-30" name="__codelineno-19-30"></a><a href="#__codelineno-19-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-31" name="__codelineno-19-31"></a><a href="#__codelineno-19-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-32" name="__codelineno-19-32"></a><a href="#__codelineno-19-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-19-33" name="__codelineno-19-33"></a><a href="#__codelineno-19-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-34" name="__codelineno-19-34"></a><a href="#__codelineno-19-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-35" name="__codelineno-19-35"></a><a href="#__codelineno-19-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-19-36" name="__codelineno-19-36"></a><a href="#__codelineno-19-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-37" name="__codelineno-19-37"></a><a href="#__codelineno-19-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-19-38" name="__codelineno-19-38"></a><a href="#__codelineno-19-38"><span class="linenos" data-linenos="38 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-19-39" name="__codelineno-19-39"></a><a href="#__codelineno-19-39"><span class="linenos" data-linenos="39 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-19-40" name="__codelineno-19-40"></a><a href="#__codelineno-19-40"><span class="linenos" data-linenos="40 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-19-41" name="__codelineno-19-41"></a><a href="#__codelineno-19-41"><span class="linenos" data-linenos="41 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-19-42" name="__codelineno-19-42"></a><a href="#__codelineno-19-42"><span class="linenos" data-linenos="42 "></span></a><span class="w">  </span>output<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-43" name="__codelineno-19-43"></a><a href="#__codelineno-19-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-19-44" name="__codelineno-19-44"></a><a href="#__codelineno-19-44"><span class="linenos" data-linenos="44 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-45" name="__codelineno-19-45"></a><a href="#__codelineno-19-45"><span class="linenos" data-linenos="45 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-46" name="__codelineno-19-46"></a><a href="#__codelineno-19-46"><span class="linenos" data-linenos="46 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-19-47" name="__codelineno-19-47"></a><a href="#__codelineno-19-47"><span class="linenos" data-linenos="47 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-48" name="__codelineno-19-48"></a><a href="#__codelineno-19-48"><span class="linenos" data-linenos="48 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-49" name="__codelineno-19-49"></a><a href="#__codelineno-19-49"><span class="linenos" data-linenos="49 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-19-50" name="__codelineno-19-50"></a><a href="#__codelineno-19-50"><span class="linenos" data-linenos="50 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-19-51" name="__codelineno-19-51"></a><a href="#__codelineno-19-51"><span class="linenos" data-linenos="51 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-19-52" name="__codelineno-19-52"></a><a href="#__codelineno-19-52"><span class="linenos" data-linenos="52 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-19-53" name="__codelineno-19-53"></a><a href="#__codelineno-19-53"><span class="linenos" data-linenos="53 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-19-54" name="__codelineno-19-54"></a><a href="#__codelineno-19-54"><span class="linenos" data-linenos="54 "></span></a><span class="o">}</span>
<a id="__codelineno-19-55" name="__codelineno-19-55"></a><a href="#__codelineno-19-55"><span class="linenos" data-linenos="55 "></span></a>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-19-56" name="__codelineno-19-56"></a><a href="#__codelineno-19-56"><span class="linenos" data-linenos="56 "></span></a><span class="w">  </span>version:<span class="w"> </span><span class="m">23</span>
<a id="__codelineno-19-57" name="__codelineno-19-57"></a><a href="#__codelineno-19-57"><span class="linenos" data-linenos="57 "></span></a><span class="o">}</span>
</code></pre></div>
</details>

<p><img alt="常量固定在模型" src="../img/dot_linreg2.png" /></p>
<p>再次，可以通过 onnx 结构来检查初始化程序的样子。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><a href="#__codelineno-20-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><a href="#__codelineno-20-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">numpy_helper</span><span class="p">,</span> <span class="n">TensorProto</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><a href="#__codelineno-20-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><a href="#__codelineno-20-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">make_graph</span><span class="p">,</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><a href="#__codelineno-20-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">make_tensor_value_info</span><span class="p">)</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><a href="#__codelineno-20-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><a href="#__codelineno-20-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><a href="#__codelineno-20-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="c1"># initializers</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><a href="#__codelineno-20-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><a href="#__codelineno-20-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">A</span> <span class="o">=</span> <span class="n">numpy_helper</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><a href="#__codelineno-20-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><a href="#__codelineno-20-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><a href="#__codelineno-20-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">C</span> <span class="o">=</span> <span class="n">numpy_helper</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><a href="#__codelineno-20-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><a href="#__codelineno-20-15"><span class="linenos" data-linenos="15 "></span></a><span class="c1"># the part which does not change</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><a href="#__codelineno-20-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><a href="#__codelineno-20-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a><a href="#__codelineno-20-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">node1</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;AX&#39;</span><span class="p">])</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><a href="#__codelineno-20-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;AX&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><a href="#__codelineno-20-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">([</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">],</span> <span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">],</span> <span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">])</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a><a href="#__codelineno-20-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a><a href="#__codelineno-20-22"><span class="linenos" data-linenos="22 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a><a href="#__codelineno-20-23"><span class="linenos" data-linenos="23 "></span></a>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a><a href="#__codelineno-20-24"><span class="linenos" data-linenos="24 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** initializer **&#39;</span><span class="p">)</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a><a href="#__codelineno-20-25"><span class="linenos" data-linenos="25 "></span></a><span class="k">for</span> <span class="n">init</span> <span class="ow">in</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">initializer</span><span class="p">:</span>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a><a href="#__codelineno-20-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><a href="#__codelineno-21-1"><span class="linenos" data-linenos=" 1 "></span></a>**<span class="w"> </span>initializer<span class="w"> </span>**
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><a href="#__codelineno-21-2"><span class="linenos" data-linenos=" 2 "></span></a>dims:<span class="w"> </span><span class="m">2</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><a href="#__codelineno-21-3"><span class="linenos" data-linenos=" 3 "></span></a>data_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><a href="#__codelineno-21-4"><span class="linenos" data-linenos=" 4 "></span></a>name:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><a href="#__codelineno-21-5"><span class="linenos" data-linenos=" 5 "></span></a>raw_data:<span class="w"> </span><span class="s2">&quot;\000\000\000?\232\231\031\277&quot;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><a href="#__codelineno-21-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><a href="#__codelineno-21-7"><span class="linenos" data-linenos=" 7 "></span></a>dims:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><a href="#__codelineno-21-8"><span class="linenos" data-linenos=" 8 "></span></a>data_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><a href="#__codelineno-21-9"><span class="linenos" data-linenos=" 9 "></span></a>name:<span class="w"> </span><span class="s2">&quot;C&quot;</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><a href="#__codelineno-21-10"><span class="linenos" data-linenos="10 "></span></a>raw_data:<span class="w"> </span><span class="s2">&quot;\315\314\314&gt;&quot;</span>
</code></pre></div>
<p>类型也定义为整数，含义相同。在第二个示例中，只剩下一个输入。输入A和B被删除。当然它们也可以保留。在保留情况下，它们是可选的：<strong>每个与输入共享相同名称的初始化器都被视为默认值</strong>。如果没有给出这个，它将替换输入。</p>
<h2 id="_11">属性</h2>
<p>有些算子需要属性，例如 <code>Transpose</code> 算子。这让我们可以构建基于表达式的计算图，例如 <span class="arithmatex">\(y = XA^{\prime} + B\)</span> 或者 <code>y = Add(MatMul(X, Transpose(Z)) + B)</code>。<code>Transpose</code> 需要一个定义轴排列的属性：<code>perm=[1, 0]</code>。它作为命名属性添加到函数 <code>make_node</code> 中</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><a href="#__codelineno-22-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">TensorProto</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><a href="#__codelineno-22-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><a href="#__codelineno-22-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">make_graph</span><span class="p">,</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><a href="#__codelineno-22-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_tensor_value_info</span><span class="p">)</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><a href="#__codelineno-22-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><a href="#__codelineno-22-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><a href="#__codelineno-22-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="c1"># unchanged</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><a href="#__codelineno-22-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><a href="#__codelineno-22-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><a href="#__codelineno-22-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><a href="#__codelineno-22-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><a href="#__codelineno-22-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><a href="#__codelineno-22-13"><span class="linenos" data-linenos="13 "></span></a><span class="c1"># added</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><a href="#__codelineno-22-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">node_transpose</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Transpose&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;tA&#39;</span><span class="p">],</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><a href="#__codelineno-22-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><a href="#__codelineno-22-16"><span class="linenos" data-linenos="16 "></span></a><span class="c1"># unchanged except A is replaced by tA</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a><a href="#__codelineno-22-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">node1</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;tA&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">])</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><a href="#__codelineno-22-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a><a href="#__codelineno-22-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a><a href="#__codelineno-22-20"><span class="linenos" data-linenos="20 "></span></a><span class="c1"># node_transpose is added to the list</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a><a href="#__codelineno-22-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">([</span><span class="n">node_transpose</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">],</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a><a href="#__codelineno-22-22"><span class="linenos" data-linenos="22 "></span></a>                   <span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<a id="__codelineno-22-23" name="__codelineno-22-23"></a><a href="#__codelineno-22-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a id="__codelineno-22-24" name="__codelineno-22-24"></a><a href="#__codelineno-22-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-22-25" name="__codelineno-22-25"></a><a href="#__codelineno-22-25"><span class="linenos" data-linenos="25 "></span></a>
<a id="__codelineno-22-26" name="__codelineno-22-26"></a><a href="#__codelineno-22-26"><span class="linenos" data-linenos="26 "></span></a><span class="c1"># the work is done, let&#39;s display it...</span>
<a id="__codelineno-22-27" name="__codelineno-22-27"></a><a href="#__codelineno-22-27"><span class="linenos" data-linenos="27 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
</code></pre></div>
<details>
  <summary> 线性模型的计算图: json格式 </summary>

<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><a href="#__codelineno-23-1"><span class="linenos" data-linenos=" 1 "></span></a>ir_version:<span class="w"> </span><span class="m">11</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><a href="#__codelineno-23-2"><span class="linenos" data-linenos=" 2 "></span></a>graph<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><a href="#__codelineno-23-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><a href="#__codelineno-23-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><a href="#__codelineno-23-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;tA&quot;</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><a href="#__codelineno-23-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;Transpose&quot;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><a href="#__codelineno-23-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span>attribute<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><a href="#__codelineno-23-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">      </span>name:<span class="w"> </span><span class="s2">&quot;perm&quot;</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><a href="#__codelineno-23-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">      </span>ints:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><a href="#__codelineno-23-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">      </span>ints:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><a href="#__codelineno-23-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">      </span>type:<span class="w"> </span>INTS
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><a href="#__codelineno-23-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><a href="#__codelineno-23-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><a href="#__codelineno-23-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><a href="#__codelineno-23-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><a href="#__codelineno-23-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;tA&quot;</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><a href="#__codelineno-23-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a><a href="#__codelineno-23-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;MatMul&quot;</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><a href="#__codelineno-23-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a><a href="#__codelineno-23-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a><a href="#__codelineno-23-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a><a href="#__codelineno-23-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a><a href="#__codelineno-23-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a><a href="#__codelineno-23-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;Add&quot;</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a><a href="#__codelineno-23-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a><a href="#__codelineno-23-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">  </span>name:<span class="w"> </span><span class="s2">&quot;lr&quot;</span>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a><a href="#__codelineno-23-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a><a href="#__codelineno-23-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a><a href="#__codelineno-23-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a><a href="#__codelineno-23-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a><a href="#__codelineno-23-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a><a href="#__codelineno-23-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-33" name="__codelineno-23-33"></a><a href="#__codelineno-23-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a><a href="#__codelineno-23-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-23-35" name="__codelineno-23-35"></a><a href="#__codelineno-23-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-36" name="__codelineno-23-36"></a><a href="#__codelineno-23-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-23-37" name="__codelineno-23-37"></a><a href="#__codelineno-23-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-23-38" name="__codelineno-23-38"></a><a href="#__codelineno-23-38"><span class="linenos" data-linenos="38 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-23-39" name="__codelineno-23-39"></a><a href="#__codelineno-23-39"><span class="linenos" data-linenos="39 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-23-40" name="__codelineno-23-40"></a><a href="#__codelineno-23-40"><span class="linenos" data-linenos="40 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-23-41" name="__codelineno-23-41"></a><a href="#__codelineno-23-41"><span class="linenos" data-linenos="41 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-42" name="__codelineno-23-42"></a><a href="#__codelineno-23-42"><span class="linenos" data-linenos="42 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-23-43" name="__codelineno-23-43"></a><a href="#__codelineno-23-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-44" name="__codelineno-23-44"></a><a href="#__codelineno-23-44"><span class="linenos" data-linenos="44 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-45" name="__codelineno-23-45"></a><a href="#__codelineno-23-45"><span class="linenos" data-linenos="45 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-23-46" name="__codelineno-23-46"></a><a href="#__codelineno-23-46"><span class="linenos" data-linenos="46 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-47" name="__codelineno-23-47"></a><a href="#__codelineno-23-47"><span class="linenos" data-linenos="47 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-48" name="__codelineno-23-48"></a><a href="#__codelineno-23-48"><span class="linenos" data-linenos="48 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-23-49" name="__codelineno-23-49"></a><a href="#__codelineno-23-49"><span class="linenos" data-linenos="49 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-50" name="__codelineno-23-50"></a><a href="#__codelineno-23-50"><span class="linenos" data-linenos="50 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-23-51" name="__codelineno-23-51"></a><a href="#__codelineno-23-51"><span class="linenos" data-linenos="51 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-23-52" name="__codelineno-23-52"></a><a href="#__codelineno-23-52"><span class="linenos" data-linenos="52 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-23-53" name="__codelineno-23-53"></a><a href="#__codelineno-23-53"><span class="linenos" data-linenos="53 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-23-54" name="__codelineno-23-54"></a><a href="#__codelineno-23-54"><span class="linenos" data-linenos="54 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-23-55" name="__codelineno-23-55"></a><a href="#__codelineno-23-55"><span class="linenos" data-linenos="55 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-56" name="__codelineno-23-56"></a><a href="#__codelineno-23-56"><span class="linenos" data-linenos="56 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-23-57" name="__codelineno-23-57"></a><a href="#__codelineno-23-57"><span class="linenos" data-linenos="57 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-58" name="__codelineno-23-58"></a><a href="#__codelineno-23-58"><span class="linenos" data-linenos="58 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-59" name="__codelineno-23-59"></a><a href="#__codelineno-23-59"><span class="linenos" data-linenos="59 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-23-60" name="__codelineno-23-60"></a><a href="#__codelineno-23-60"><span class="linenos" data-linenos="60 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-61" name="__codelineno-23-61"></a><a href="#__codelineno-23-61"><span class="linenos" data-linenos="61 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-62" name="__codelineno-23-62"></a><a href="#__codelineno-23-62"><span class="linenos" data-linenos="62 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-23-63" name="__codelineno-23-63"></a><a href="#__codelineno-23-63"><span class="linenos" data-linenos="63 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-64" name="__codelineno-23-64"></a><a href="#__codelineno-23-64"><span class="linenos" data-linenos="64 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-23-65" name="__codelineno-23-65"></a><a href="#__codelineno-23-65"><span class="linenos" data-linenos="65 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-23-66" name="__codelineno-23-66"></a><a href="#__codelineno-23-66"><span class="linenos" data-linenos="66 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-23-67" name="__codelineno-23-67"></a><a href="#__codelineno-23-67"><span class="linenos" data-linenos="67 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-23-68" name="__codelineno-23-68"></a><a href="#__codelineno-23-68"><span class="linenos" data-linenos="68 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-23-69" name="__codelineno-23-69"></a><a href="#__codelineno-23-69"><span class="linenos" data-linenos="69 "></span></a><span class="w">  </span>output<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-70" name="__codelineno-23-70"></a><a href="#__codelineno-23-70"><span class="linenos" data-linenos="70 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-23-71" name="__codelineno-23-71"></a><a href="#__codelineno-23-71"><span class="linenos" data-linenos="71 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-72" name="__codelineno-23-72"></a><a href="#__codelineno-23-72"><span class="linenos" data-linenos="72 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-73" name="__codelineno-23-73"></a><a href="#__codelineno-23-73"><span class="linenos" data-linenos="73 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-23-74" name="__codelineno-23-74"></a><a href="#__codelineno-23-74"><span class="linenos" data-linenos="74 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-75" name="__codelineno-23-75"></a><a href="#__codelineno-23-75"><span class="linenos" data-linenos="75 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-76" name="__codelineno-23-76"></a><a href="#__codelineno-23-76"><span class="linenos" data-linenos="76 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-23-77" name="__codelineno-23-77"></a><a href="#__codelineno-23-77"><span class="linenos" data-linenos="77 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-23-78" name="__codelineno-23-78"></a><a href="#__codelineno-23-78"><span class="linenos" data-linenos="78 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-23-79" name="__codelineno-23-79"></a><a href="#__codelineno-23-79"><span class="linenos" data-linenos="79 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-23-80" name="__codelineno-23-80"></a><a href="#__codelineno-23-80"><span class="linenos" data-linenos="80 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-23-81" name="__codelineno-23-81"></a><a href="#__codelineno-23-81"><span class="linenos" data-linenos="81 "></span></a><span class="o">}</span>
<a id="__codelineno-23-82" name="__codelineno-23-82"></a><a href="#__codelineno-23-82"><span class="linenos" data-linenos="82 "></span></a>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-23-83" name="__codelineno-23-83"></a><a href="#__codelineno-23-83"><span class="linenos" data-linenos="83 "></span></a><span class="w">  </span>version:<span class="w"> </span><span class="m">23</span>
<a id="__codelineno-23-84" name="__codelineno-23-84"></a><a href="#__codelineno-23-84"><span class="linenos" data-linenos="84 "></span></a><span class="o">}</span>
</code></pre></div>
</details>

<p><img alt="onnx中属性" src="../img/dot_att.png" /></p>
<p>以下是make函数的完整列表。其中许多函数在make 函数一节中进行了描述。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><a href="#__codelineno-24-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><a href="#__codelineno-24-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pprint</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><a href="#__codelineno-24-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">onnx</span><span class="o">.</span><span class="n">helper</span><span class="p">)</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><a href="#__codelineno-24-4"><span class="linenos" data-linenos="4 "></span></a>               <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;make&#39;</span><span class="p">)])</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><a href="#__codelineno-25-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">[</span><span class="s1">&#39;make_attribute&#39;</span>,
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><a href="#__codelineno-25-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w"> </span><span class="s1">&#39;make_attribute_ref&#39;</span>,
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><a href="#__codelineno-25-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w"> </span><span class="s1">&#39;make_empty_tensor_value_info&#39;</span>,
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><a href="#__codelineno-25-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w"> </span><span class="s1">&#39;make_function&#39;</span>,
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><a href="#__codelineno-25-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w"> </span><span class="s1">&#39;make_graph&#39;</span>,
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><a href="#__codelineno-25-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w"> </span><span class="s1">&#39;make_map&#39;</span>,
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><a href="#__codelineno-25-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w"> </span><span class="s1">&#39;make_map_type_proto&#39;</span>,
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><a href="#__codelineno-25-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w"> </span><span class="s1">&#39;make_model&#39;</span>,
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><a href="#__codelineno-25-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w"> </span><span class="s1">&#39;make_model_gen_version&#39;</span>,
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><a href="#__codelineno-25-10"><span class="linenos" data-linenos="10 "></span></a><span class="w"> </span><span class="s1">&#39;make_node&#39;</span>,
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><a href="#__codelineno-25-11"><span class="linenos" data-linenos="11 "></span></a><span class="w"> </span><span class="s1">&#39;make_operatorsetid&#39;</span>,
<a id="__codelineno-25-12" name="__codelineno-25-12"></a><a href="#__codelineno-25-12"><span class="linenos" data-linenos="12 "></span></a><span class="w"> </span><span class="s1">&#39;make_opsetid&#39;</span>,
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><a href="#__codelineno-25-13"><span class="linenos" data-linenos="13 "></span></a><span class="w"> </span><span class="s1">&#39;make_optional&#39;</span>,
<a id="__codelineno-25-14" name="__codelineno-25-14"></a><a href="#__codelineno-25-14"><span class="linenos" data-linenos="14 "></span></a><span class="w"> </span><span class="s1">&#39;make_optional_type_proto&#39;</span>,
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><a href="#__codelineno-25-15"><span class="linenos" data-linenos="15 "></span></a><span class="w"> </span><span class="s1">&#39;make_sequence&#39;</span>,
<a id="__codelineno-25-16" name="__codelineno-25-16"></a><a href="#__codelineno-25-16"><span class="linenos" data-linenos="16 "></span></a><span class="w"> </span><span class="s1">&#39;make_sequence_type_proto&#39;</span>,
<a id="__codelineno-25-17" name="__codelineno-25-17"></a><a href="#__codelineno-25-17"><span class="linenos" data-linenos="17 "></span></a><span class="w"> </span><span class="s1">&#39;make_sparse_tensor&#39;</span>,
<a id="__codelineno-25-18" name="__codelineno-25-18"></a><a href="#__codelineno-25-18"><span class="linenos" data-linenos="18 "></span></a><span class="w"> </span><span class="s1">&#39;make_sparse_tensor_type_proto&#39;</span>,
<a id="__codelineno-25-19" name="__codelineno-25-19"></a><a href="#__codelineno-25-19"><span class="linenos" data-linenos="19 "></span></a><span class="w"> </span><span class="s1">&#39;make_sparse_tensor_value_info&#39;</span>,
<a id="__codelineno-25-20" name="__codelineno-25-20"></a><a href="#__codelineno-25-20"><span class="linenos" data-linenos="20 "></span></a><span class="w"> </span><span class="s1">&#39;make_tensor&#39;</span>,
<a id="__codelineno-25-21" name="__codelineno-25-21"></a><a href="#__codelineno-25-21"><span class="linenos" data-linenos="21 "></span></a><span class="w"> </span><span class="s1">&#39;make_tensor_sequence_value_info&#39;</span>,
<a id="__codelineno-25-22" name="__codelineno-25-22"></a><a href="#__codelineno-25-22"><span class="linenos" data-linenos="22 "></span></a><span class="w"> </span><span class="s1">&#39;make_tensor_type_proto&#39;</span>,
<a id="__codelineno-25-23" name="__codelineno-25-23"></a><a href="#__codelineno-25-23"><span class="linenos" data-linenos="23 "></span></a><span class="w"> </span><span class="s1">&#39;make_tensor_value_info&#39;</span>,
<a id="__codelineno-25-24" name="__codelineno-25-24"></a><a href="#__codelineno-25-24"><span class="linenos" data-linenos="24 "></span></a><span class="w"> </span><span class="s1">&#39;make_training_info&#39;</span>,
<a id="__codelineno-25-25" name="__codelineno-25-25"></a><a href="#__codelineno-25-25"><span class="linenos" data-linenos="25 "></span></a><span class="w"> </span><span class="s1">&#39;make_value_info&#39;</span><span class="o">]</span>
</code></pre></div>
<h2 id="opset">Opset 和元数据</h2>
<p>让我们加载之前创建的 ONNX 文件并检查它具有什么样的元数据。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><a href="#__codelineno-26-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">load</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><a href="#__codelineno-26-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><a href="#__codelineno-26-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;linear_regression.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><a href="#__codelineno-26-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">onnx_model</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><a href="#__codelineno-26-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><a href="#__codelineno-26-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;doc_string&#39;</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="s1">&#39;functions&#39;</span><span class="p">,</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><a href="#__codelineno-26-7"><span class="linenos" data-linenos=" 7 "></span></a>              <span class="s1">&#39;ir_version&#39;</span><span class="p">,</span> <span class="s1">&#39;metadata_props&#39;</span><span class="p">,</span> <span class="s1">&#39;model_version&#39;</span><span class="p">,</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><a href="#__codelineno-26-8"><span class="linenos" data-linenos=" 8 "></span></a>              <span class="s1">&#39;opset_import&#39;</span><span class="p">,</span> <span class="s1">&#39;producer_name&#39;</span><span class="p">,</span> <span class="s1">&#39;producer_version&#39;</span><span class="p">,</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a><a href="#__codelineno-26-9"><span class="linenos" data-linenos=" 9 "></span></a>              <span class="s1">&#39;training_info&#39;</span><span class="p">]:</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><a href="#__codelineno-26-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">,</span> <span class="n">field</span><span class="p">))</span>
</code></pre></div>
<p><div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><a href="#__codelineno-27-1"><span class="linenos" data-linenos=" 1 "></span></a>doc_string 
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><a href="#__codelineno-27-2"><span class="linenos" data-linenos=" 2 "></span></a>domain 
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><a href="#__codelineno-27-3"><span class="linenos" data-linenos=" 3 "></span></a>functions []
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><a href="#__codelineno-27-4"><span class="linenos" data-linenos=" 4 "></span></a>ir_version 11
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><a href="#__codelineno-27-5"><span class="linenos" data-linenos=" 5 "></span></a>metadata_props []
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><a href="#__codelineno-27-6"><span class="linenos" data-linenos=" 6 "></span></a>model_version 0
<a id="__codelineno-27-7" name="__codelineno-27-7"></a><a href="#__codelineno-27-7"><span class="linenos" data-linenos=" 7 "></span></a>opset_import [version: 23
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><a href="#__codelineno-27-8"><span class="linenos" data-linenos=" 8 "></span></a>]
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><a href="#__codelineno-27-9"><span class="linenos" data-linenos=" 9 "></span></a>producer_name 
<a id="__codelineno-27-10" name="__codelineno-27-10"></a><a href="#__codelineno-27-10"><span class="linenos" data-linenos="10 "></span></a>producer_version 
<a id="__codelineno-27-11" name="__codelineno-27-11"></a><a href="#__codelineno-27-11"><span class="linenos" data-linenos="11 "></span></a>training_info []
</code></pre></div>
其中大部分都是空的，因为在创建 ONNX 图时没有填充。其中两个有值：</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><a href="#__codelineno-28-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">load</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><a href="#__codelineno-28-2"><span class="linenos" data-linenos="2 "></span></a>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><a href="#__codelineno-28-3"><span class="linenos" data-linenos="3 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;linear_regression.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><a href="#__codelineno-28-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">onnx_model</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><a href="#__codelineno-28-5"><span class="linenos" data-linenos="5 "></span></a>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><a href="#__codelineno-28-6"><span class="linenos" data-linenos="6 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ir_version:&quot;</span><span class="p">,</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">ir_version</span><span class="p">)</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><a href="#__codelineno-28-7"><span class="linenos" data-linenos="7 "></span></a><span class="k">for</span> <span class="n">opset</span> <span class="ow">in</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">opset_import</span><span class="p">:</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><a href="#__codelineno-28-8"><span class="linenos" data-linenos="8 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;opset domain=</span><span class="si">%r</span><span class="s2"> version=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">opset</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">opset</span><span class="o">.</span><span class="n">version</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><a href="#__codelineno-29-1"><span class="linenos" data-linenos="1 "></span></a>ir_version:<span class="w"> </span><span class="m">11</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><a href="#__codelineno-29-2"><span class="linenos" data-linenos="2 "></span></a>opset<span class="w"> </span><span class="nv">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="m">23</span>
</code></pre></div>
<p>IR定义 ONNX 语言的版本。Opset 定义正在使用的运算符的版本。没有任何精度，ONNX 使用已安装包中提供的最新版本。可以使用另一个。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><a href="#__codelineno-30-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">load</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><a href="#__codelineno-30-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><a href="#__codelineno-30-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;linear_regression.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><a href="#__codelineno-30-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">onnx_model</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><a href="#__codelineno-30-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><a href="#__codelineno-30-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">del</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">opset_import</span><span class="p">[:]</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><a href="#__codelineno-30-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">opset</span> <span class="o">=</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">opset_import</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a><a href="#__codelineno-30-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">opset</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a><a href="#__codelineno-30-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">opset</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="mi">14</span>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a><a href="#__codelineno-30-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-30-11" name="__codelineno-30-11"></a><a href="#__codelineno-30-11"><span class="linenos" data-linenos="11 "></span></a><span class="k">for</span> <span class="n">opset</span> <span class="ow">in</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">opset_import</span><span class="p">:</span>
<a id="__codelineno-30-12" name="__codelineno-30-12"></a><a href="#__codelineno-30-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;opset domain=</span><span class="si">%r</span><span class="s2"> version=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">opset</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">opset</span><span class="o">.</span><span class="n">version</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><a href="#__codelineno-31-1"><span class="linenos" data-linenos="1 "></span></a>opset<span class="w"> </span><span class="nv">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="m">14</span>
</code></pre></div>
<p>只要所有运算符都按照 ONNX 指定的方式定义，就可以使用任何操作集。操作符Reshape的第 5 版 将形状定义为输入，而不是像第 1 版中那样定义为属性。操作集说明在描述图形时遵循哪些规范。</p>
<p>其他元数据可用于存储任何信息，存储有关模型生成方式的信息，以及使用版本号区分一个模型与另一个模型的方式。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><a href="#__codelineno-32-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">load</span><span class="p">,</span> <span class="n">helper</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><a href="#__codelineno-32-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><a href="#__codelineno-32-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;linear_regression.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><a href="#__codelineno-32-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">onnx_model</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><a href="#__codelineno-32-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><a href="#__codelineno-32-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">onnx_model</span><span class="o">.</span><span class="n">model_version</span> <span class="o">=</span> <span class="mi">15</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><a href="#__codelineno-32-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">onnx_model</span><span class="o">.</span><span class="n">producer_name</span> <span class="o">=</span> <span class="s2">&quot;something&quot;</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><a href="#__codelineno-32-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">onnx_model</span><span class="o">.</span><span class="n">producer_version</span> <span class="o">=</span> <span class="s2">&quot;some other thing&quot;</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><a href="#__codelineno-32-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">onnx_model</span><span class="o">.</span><span class="n">doc_string</span> <span class="o">=</span> <span class="s2">&quot;documentation about this model&quot;</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><a href="#__codelineno-32-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">prop</span> <span class="o">=</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">metadata_props</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><a href="#__codelineno-32-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><a href="#__codelineno-32-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">key1</span><span class="o">=</span><span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="s2">&quot;value2&quot;</span><span class="p">)</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><a href="#__codelineno-32-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">helper</span><span class="o">.</span><span class="n">set_model_props</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a><a href="#__codelineno-32-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a><a href="#__codelineno-32-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
</code></pre></div>
<details>
  <summary> 线性模型的计算图: json 格式</summary>

<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><a href="#__codelineno-33-1"><span class="linenos" data-linenos=" 1 "></span></a>ir_version: 11
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><a href="#__codelineno-33-2"><span class="linenos" data-linenos=" 2 "></span></a>producer_name: &quot;something&quot;
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><a href="#__codelineno-33-3"><span class="linenos" data-linenos=" 3 "></span></a>producer_version: &quot;some other thing&quot;
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><a href="#__codelineno-33-4"><span class="linenos" data-linenos=" 4 "></span></a>model_version: 15
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><a href="#__codelineno-33-5"><span class="linenos" data-linenos=" 5 "></span></a>doc_string: &quot;documentation about this model&quot;
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><a href="#__codelineno-33-6"><span class="linenos" data-linenos=" 6 "></span></a>graph {
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><a href="#__codelineno-33-7"><span class="linenos" data-linenos=" 7 "></span></a>  node {
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><a href="#__codelineno-33-8"><span class="linenos" data-linenos=" 8 "></span></a>    input: &quot;X&quot;
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><a href="#__codelineno-33-9"><span class="linenos" data-linenos=" 9 "></span></a>    input: &quot;A&quot;
<a id="__codelineno-33-10" name="__codelineno-33-10"></a><a href="#__codelineno-33-10"><span class="linenos" data-linenos="10 "></span></a>    output: &quot;XA&quot;
<a id="__codelineno-33-11" name="__codelineno-33-11"></a><a href="#__codelineno-33-11"><span class="linenos" data-linenos="11 "></span></a>    op_type: &quot;MatMul&quot;
<a id="__codelineno-33-12" name="__codelineno-33-12"></a><a href="#__codelineno-33-12"><span class="linenos" data-linenos="12 "></span></a>  }
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><a href="#__codelineno-33-13"><span class="linenos" data-linenos="13 "></span></a>  node {
<a id="__codelineno-33-14" name="__codelineno-33-14"></a><a href="#__codelineno-33-14"><span class="linenos" data-linenos="14 "></span></a>    input: &quot;XA&quot;
<a id="__codelineno-33-15" name="__codelineno-33-15"></a><a href="#__codelineno-33-15"><span class="linenos" data-linenos="15 "></span></a>    input: &quot;B&quot;
<a id="__codelineno-33-16" name="__codelineno-33-16"></a><a href="#__codelineno-33-16"><span class="linenos" data-linenos="16 "></span></a>    output: &quot;Y&quot;
<a id="__codelineno-33-17" name="__codelineno-33-17"></a><a href="#__codelineno-33-17"><span class="linenos" data-linenos="17 "></span></a>    op_type: &quot;Add&quot;
<a id="__codelineno-33-18" name="__codelineno-33-18"></a><a href="#__codelineno-33-18"><span class="linenos" data-linenos="18 "></span></a>  }
<a id="__codelineno-33-19" name="__codelineno-33-19"></a><a href="#__codelineno-33-19"><span class="linenos" data-linenos="19 "></span></a>  name: &quot;lr&quot;
<a id="__codelineno-33-20" name="__codelineno-33-20"></a><a href="#__codelineno-33-20"><span class="linenos" data-linenos="20 "></span></a>  input {
<a id="__codelineno-33-21" name="__codelineno-33-21"></a><a href="#__codelineno-33-21"><span class="linenos" data-linenos="21 "></span></a>    name: &quot;X&quot;
<a id="__codelineno-33-22" name="__codelineno-33-22"></a><a href="#__codelineno-33-22"><span class="linenos" data-linenos="22 "></span></a>    type {
<a id="__codelineno-33-23" name="__codelineno-33-23"></a><a href="#__codelineno-33-23"><span class="linenos" data-linenos="23 "></span></a>      tensor_type {
<a id="__codelineno-33-24" name="__codelineno-33-24"></a><a href="#__codelineno-33-24"><span class="linenos" data-linenos="24 "></span></a>        elem_type: 1
<a id="__codelineno-33-25" name="__codelineno-33-25"></a><a href="#__codelineno-33-25"><span class="linenos" data-linenos="25 "></span></a>        shape {
<a id="__codelineno-33-26" name="__codelineno-33-26"></a><a href="#__codelineno-33-26"><span class="linenos" data-linenos="26 "></span></a>          dim {
<a id="__codelineno-33-27" name="__codelineno-33-27"></a><a href="#__codelineno-33-27"><span class="linenos" data-linenos="27 "></span></a>          }
<a id="__codelineno-33-28" name="__codelineno-33-28"></a><a href="#__codelineno-33-28"><span class="linenos" data-linenos="28 "></span></a>          dim {
<a id="__codelineno-33-29" name="__codelineno-33-29"></a><a href="#__codelineno-33-29"><span class="linenos" data-linenos="29 "></span></a>          }
<a id="__codelineno-33-30" name="__codelineno-33-30"></a><a href="#__codelineno-33-30"><span class="linenos" data-linenos="30 "></span></a>        }
<a id="__codelineno-33-31" name="__codelineno-33-31"></a><a href="#__codelineno-33-31"><span class="linenos" data-linenos="31 "></span></a>      }
<a id="__codelineno-33-32" name="__codelineno-33-32"></a><a href="#__codelineno-33-32"><span class="linenos" data-linenos="32 "></span></a>    }
<a id="__codelineno-33-33" name="__codelineno-33-33"></a><a href="#__codelineno-33-33"><span class="linenos" data-linenos="33 "></span></a>  }
<a id="__codelineno-33-34" name="__codelineno-33-34"></a><a href="#__codelineno-33-34"><span class="linenos" data-linenos="34 "></span></a>  input {
<a id="__codelineno-33-35" name="__codelineno-33-35"></a><a href="#__codelineno-33-35"><span class="linenos" data-linenos="35 "></span></a>    name: &quot;A&quot;
<a id="__codelineno-33-36" name="__codelineno-33-36"></a><a href="#__codelineno-33-36"><span class="linenos" data-linenos="36 "></span></a>    type {
<a id="__codelineno-33-37" name="__codelineno-33-37"></a><a href="#__codelineno-33-37"><span class="linenos" data-linenos="37 "></span></a>      tensor_type {
<a id="__codelineno-33-38" name="__codelineno-33-38"></a><a href="#__codelineno-33-38"><span class="linenos" data-linenos="38 "></span></a>        elem_type: 1
<a id="__codelineno-33-39" name="__codelineno-33-39"></a><a href="#__codelineno-33-39"><span class="linenos" data-linenos="39 "></span></a>        shape {
<a id="__codelineno-33-40" name="__codelineno-33-40"></a><a href="#__codelineno-33-40"><span class="linenos" data-linenos="40 "></span></a>          dim {
<a id="__codelineno-33-41" name="__codelineno-33-41"></a><a href="#__codelineno-33-41"><span class="linenos" data-linenos="41 "></span></a>          }
<a id="__codelineno-33-42" name="__codelineno-33-42"></a><a href="#__codelineno-33-42"><span class="linenos" data-linenos="42 "></span></a>          dim {
<a id="__codelineno-33-43" name="__codelineno-33-43"></a><a href="#__codelineno-33-43"><span class="linenos" data-linenos="43 "></span></a>          }
<a id="__codelineno-33-44" name="__codelineno-33-44"></a><a href="#__codelineno-33-44"><span class="linenos" data-linenos="44 "></span></a>        }
<a id="__codelineno-33-45" name="__codelineno-33-45"></a><a href="#__codelineno-33-45"><span class="linenos" data-linenos="45 "></span></a>      }
<a id="__codelineno-33-46" name="__codelineno-33-46"></a><a href="#__codelineno-33-46"><span class="linenos" data-linenos="46 "></span></a>    }
<a id="__codelineno-33-47" name="__codelineno-33-47"></a><a href="#__codelineno-33-47"><span class="linenos" data-linenos="47 "></span></a>  }
<a id="__codelineno-33-48" name="__codelineno-33-48"></a><a href="#__codelineno-33-48"><span class="linenos" data-linenos="48 "></span></a>  input {
<a id="__codelineno-33-49" name="__codelineno-33-49"></a><a href="#__codelineno-33-49"><span class="linenos" data-linenos="49 "></span></a>    name: &quot;B&quot;
<a id="__codelineno-33-50" name="__codelineno-33-50"></a><a href="#__codelineno-33-50"><span class="linenos" data-linenos="50 "></span></a>    type {
<a id="__codelineno-33-51" name="__codelineno-33-51"></a><a href="#__codelineno-33-51"><span class="linenos" data-linenos="51 "></span></a>      tensor_type {
<a id="__codelineno-33-52" name="__codelineno-33-52"></a><a href="#__codelineno-33-52"><span class="linenos" data-linenos="52 "></span></a>        elem_type: 1
<a id="__codelineno-33-53" name="__codelineno-33-53"></a><a href="#__codelineno-33-53"><span class="linenos" data-linenos="53 "></span></a>        shape {
<a id="__codelineno-33-54" name="__codelineno-33-54"></a><a href="#__codelineno-33-54"><span class="linenos" data-linenos="54 "></span></a>          dim {
<a id="__codelineno-33-55" name="__codelineno-33-55"></a><a href="#__codelineno-33-55"><span class="linenos" data-linenos="55 "></span></a>          }
<a id="__codelineno-33-56" name="__codelineno-33-56"></a><a href="#__codelineno-33-56"><span class="linenos" data-linenos="56 "></span></a>          dim {
<a id="__codelineno-33-57" name="__codelineno-33-57"></a><a href="#__codelineno-33-57"><span class="linenos" data-linenos="57 "></span></a>          }
<a id="__codelineno-33-58" name="__codelineno-33-58"></a><a href="#__codelineno-33-58"><span class="linenos" data-linenos="58 "></span></a>        }
<a id="__codelineno-33-59" name="__codelineno-33-59"></a><a href="#__codelineno-33-59"><span class="linenos" data-linenos="59 "></span></a>      }
<a id="__codelineno-33-60" name="__codelineno-33-60"></a><a href="#__codelineno-33-60"><span class="linenos" data-linenos="60 "></span></a>    }
<a id="__codelineno-33-61" name="__codelineno-33-61"></a><a href="#__codelineno-33-61"><span class="linenos" data-linenos="61 "></span></a>  }
<a id="__codelineno-33-62" name="__codelineno-33-62"></a><a href="#__codelineno-33-62"><span class="linenos" data-linenos="62 "></span></a>  output {
<a id="__codelineno-33-63" name="__codelineno-33-63"></a><a href="#__codelineno-33-63"><span class="linenos" data-linenos="63 "></span></a>    name: &quot;Y&quot;
<a id="__codelineno-33-64" name="__codelineno-33-64"></a><a href="#__codelineno-33-64"><span class="linenos" data-linenos="64 "></span></a>    type {
<a id="__codelineno-33-65" name="__codelineno-33-65"></a><a href="#__codelineno-33-65"><span class="linenos" data-linenos="65 "></span></a>      tensor_type {
<a id="__codelineno-33-66" name="__codelineno-33-66"></a><a href="#__codelineno-33-66"><span class="linenos" data-linenos="66 "></span></a>        elem_type: 1
<a id="__codelineno-33-67" name="__codelineno-33-67"></a><a href="#__codelineno-33-67"><span class="linenos" data-linenos="67 "></span></a>        shape {
<a id="__codelineno-33-68" name="__codelineno-33-68"></a><a href="#__codelineno-33-68"><span class="linenos" data-linenos="68 "></span></a>          dim {
<a id="__codelineno-33-69" name="__codelineno-33-69"></a><a href="#__codelineno-33-69"><span class="linenos" data-linenos="69 "></span></a>          }
<a id="__codelineno-33-70" name="__codelineno-33-70"></a><a href="#__codelineno-33-70"><span class="linenos" data-linenos="70 "></span></a>        }
<a id="__codelineno-33-71" name="__codelineno-33-71"></a><a href="#__codelineno-33-71"><span class="linenos" data-linenos="71 "></span></a>      }
<a id="__codelineno-33-72" name="__codelineno-33-72"></a><a href="#__codelineno-33-72"><span class="linenos" data-linenos="72 "></span></a>    }
<a id="__codelineno-33-73" name="__codelineno-33-73"></a><a href="#__codelineno-33-73"><span class="linenos" data-linenos="73 "></span></a>  }
<a id="__codelineno-33-74" name="__codelineno-33-74"></a><a href="#__codelineno-33-74"><span class="linenos" data-linenos="74 "></span></a>}
<a id="__codelineno-33-75" name="__codelineno-33-75"></a><a href="#__codelineno-33-75"><span class="linenos" data-linenos="75 "></span></a>opset_import {
<a id="__codelineno-33-76" name="__codelineno-33-76"></a><a href="#__codelineno-33-76"><span class="linenos" data-linenos="76 "></span></a>  version: 23
<a id="__codelineno-33-77" name="__codelineno-33-77"></a><a href="#__codelineno-33-77"><span class="linenos" data-linenos="77 "></span></a>}
<a id="__codelineno-33-78" name="__codelineno-33-78"></a><a href="#__codelineno-33-78"><span class="linenos" data-linenos="78 "></span></a>metadata_props {
<a id="__codelineno-33-79" name="__codelineno-33-79"></a><a href="#__codelineno-33-79"><span class="linenos" data-linenos="79 "></span></a>  key: &quot;key1&quot;
<a id="__codelineno-33-80" name="__codelineno-33-80"></a><a href="#__codelineno-33-80"><span class="linenos" data-linenos="80 "></span></a>  value: &quot;value1&quot;
<a id="__codelineno-33-81" name="__codelineno-33-81"></a><a href="#__codelineno-33-81"><span class="linenos" data-linenos="81 "></span></a>}
<a id="__codelineno-33-82" name="__codelineno-33-82"></a><a href="#__codelineno-33-82"><span class="linenos" data-linenos="82 "></span></a>metadata_props {
<a id="__codelineno-33-83" name="__codelineno-33-83"></a><a href="#__codelineno-33-83"><span class="linenos" data-linenos="83 "></span></a>  key: &quot;key2&quot;
<a id="__codelineno-33-84" name="__codelineno-33-84"></a><a href="#__codelineno-33-84"><span class="linenos" data-linenos="84 "></span></a>  value: &quot;value2&quot;
<a id="__codelineno-33-85" name="__codelineno-33-85"></a><a href="#__codelineno-33-85"><span class="linenos" data-linenos="85 "></span></a>}
</code></pre></div>
</details>

<p>字段training_info可用于存储附加图表。请参阅training_tool_test.py 了解其工作原理。</p>
<h2 id="_12">子图：测试和循环</h2>
<p>它们通常被归类为控制流。通常最好避免使用它们，因为它们的效率不如矩阵操作快得多且经过了优化。</p>
<h3 id="if">条件算子 IF</h3>
<p>可以使用运算符If来实现测试。它根据一个布尔值执行一个子图或另一个子图。这不常用，因为函数通常需要一批中多次比较的结果。以下示例根据符号计算矩阵中所有浮点数的总和，返回 1 或 -1。</p>
<details>
  <summary> 条件算子 </summary>

<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><a href="#__codelineno-34-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><a href="#__codelineno-34-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><a href="#__codelineno-34-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><a href="#__codelineno-34-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_node</span><span class="p">,</span> <span class="n">make_graph</span><span class="p">,</span> <span class="n">make_model</span><span class="p">,</span> <span class="n">make_tensor_value_info</span><span class="p">)</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><a href="#__codelineno-34-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.numpy_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">from_array</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><a href="#__codelineno-34-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><a href="#__codelineno-34-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnxruntime</span><span class="w"> </span><span class="kn">import</span> <span class="n">InferenceSession</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><a href="#__codelineno-34-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><a href="#__codelineno-34-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1"># initializers</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><a href="#__codelineno-34-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a><a href="#__codelineno-34-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">zero</span> <span class="o">=</span> <span class="n">from_array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;zero&#39;</span><span class="p">)</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a><a href="#__codelineno-34-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a><a href="#__codelineno-34-13"><span class="linenos" data-linenos="13 "></span></a><span class="c1"># Same as before, X is the input, Y is the output.</span>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a><a href="#__codelineno-34-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">onnx</span><span class="o">.</span><span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-34-15" name="__codelineno-34-15"></a><a href="#__codelineno-34-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">onnx</span><span class="o">.</span><span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-34-16" name="__codelineno-34-16"></a><a href="#__codelineno-34-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-34-17" name="__codelineno-34-17"></a><a href="#__codelineno-34-17"><span class="linenos" data-linenos="17 "></span></a><span class="c1"># The node building the condition. The first one</span>
<a id="__codelineno-34-18" name="__codelineno-34-18"></a><a href="#__codelineno-34-18"><span class="linenos" data-linenos="18 "></span></a><span class="c1"># sum over all axes.</span>
<a id="__codelineno-34-19" name="__codelineno-34-19"></a><a href="#__codelineno-34-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">rsum</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;ReduceSum&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;rsum&#39;</span><span class="p">])</span>
<a id="__codelineno-34-20" name="__codelineno-34-20"></a><a href="#__codelineno-34-20"><span class="linenos" data-linenos="20 "></span></a><span class="c1"># The second compares the result to 0.</span>
<a id="__codelineno-34-21" name="__codelineno-34-21"></a><a href="#__codelineno-34-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">cond</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Greater&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;rsum&#39;</span><span class="p">,</span> <span class="s1">&#39;zero&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;cond&#39;</span><span class="p">])</span>
<a id="__codelineno-34-22" name="__codelineno-34-22"></a><a href="#__codelineno-34-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-34-23" name="__codelineno-34-23"></a><a href="#__codelineno-34-23"><span class="linenos" data-linenos="23 "></span></a><span class="c1"># Builds the graph is the condition is True.</span>
<a id="__codelineno-34-24" name="__codelineno-34-24"></a><a href="#__codelineno-34-24"><span class="linenos" data-linenos="24 "></span></a><span class="c1"># Input for then</span>
<a id="__codelineno-34-25" name="__codelineno-34-25"></a><a href="#__codelineno-34-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">then_out</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span>
<a id="__codelineno-34-26" name="__codelineno-34-26"></a><a href="#__codelineno-34-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="s1">&#39;then_out&#39;</span><span class="p">,</span> <span class="n">onnx</span><span class="o">.</span><span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-34-27" name="__codelineno-34-27"></a><a href="#__codelineno-34-27"><span class="linenos" data-linenos="27 "></span></a><span class="c1"># The constant to return.</span>
<a id="__codelineno-34-28" name="__codelineno-34-28"></a><a href="#__codelineno-34-28"><span class="linenos" data-linenos="28 "></span></a><span class="n">then_cst</span> <span class="o">=</span> <span class="n">from_array</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<a id="__codelineno-34-29" name="__codelineno-34-29"></a><a href="#__codelineno-34-29"><span class="linenos" data-linenos="29 "></span></a>
<a id="__codelineno-34-30" name="__codelineno-34-30"></a><a href="#__codelineno-34-30"><span class="linenos" data-linenos="30 "></span></a><span class="c1"># The only node.</span>
<a id="__codelineno-34-31" name="__codelineno-34-31"></a><a href="#__codelineno-34-31"><span class="linenos" data-linenos="31 "></span></a><span class="n">then_const_node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-34-32" name="__codelineno-34-32"></a><a href="#__codelineno-34-32"><span class="linenos" data-linenos="32 "></span></a>    <span class="s1">&#39;Constant&#39;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-34-33" name="__codelineno-34-33"></a><a href="#__codelineno-34-33"><span class="linenos" data-linenos="33 "></span></a>    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;then_out&#39;</span><span class="p">],</span>
<a id="__codelineno-34-34" name="__codelineno-34-34"></a><a href="#__codelineno-34-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="n">value</span><span class="o">=</span><span class="n">then_cst</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cst1&#39;</span><span class="p">)</span>
<a id="__codelineno-34-35" name="__codelineno-34-35"></a><a href="#__codelineno-34-35"><span class="linenos" data-linenos="35 "></span></a>
<a id="__codelineno-34-36" name="__codelineno-34-36"></a><a href="#__codelineno-34-36"><span class="linenos" data-linenos="36 "></span></a><span class="c1"># And the graph wrapping these elements.</span>
<a id="__codelineno-34-37" name="__codelineno-34-37"></a><a href="#__codelineno-34-37"><span class="linenos" data-linenos="37 "></span></a><span class="n">then_body</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">(</span>
<a id="__codelineno-34-38" name="__codelineno-34-38"></a><a href="#__codelineno-34-38"><span class="linenos" data-linenos="38 "></span></a>    <span class="p">[</span><span class="n">then_const_node</span><span class="p">],</span> <span class="s1">&#39;then_body&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="n">then_out</span><span class="p">])</span>
<a id="__codelineno-34-39" name="__codelineno-34-39"></a><a href="#__codelineno-34-39"><span class="linenos" data-linenos="39 "></span></a>
<a id="__codelineno-34-40" name="__codelineno-34-40"></a><a href="#__codelineno-34-40"><span class="linenos" data-linenos="40 "></span></a><span class="c1"># Same process for the else branch.</span>
<a id="__codelineno-34-41" name="__codelineno-34-41"></a><a href="#__codelineno-34-41"><span class="linenos" data-linenos="41 "></span></a><span class="n">else_out</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span>
<a id="__codelineno-34-42" name="__codelineno-34-42"></a><a href="#__codelineno-34-42"><span class="linenos" data-linenos="42 "></span></a>    <span class="s1">&#39;else_out&#39;</span><span class="p">,</span> <span class="n">onnx</span><span class="o">.</span><span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<a id="__codelineno-34-43" name="__codelineno-34-43"></a><a href="#__codelineno-34-43"><span class="linenos" data-linenos="43 "></span></a><span class="n">else_cst</span> <span class="o">=</span> <span class="n">from_array</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<a id="__codelineno-34-44" name="__codelineno-34-44"></a><a href="#__codelineno-34-44"><span class="linenos" data-linenos="44 "></span></a>
<a id="__codelineno-34-45" name="__codelineno-34-45"></a><a href="#__codelineno-34-45"><span class="linenos" data-linenos="45 "></span></a><span class="n">else_const_node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-34-46" name="__codelineno-34-46"></a><a href="#__codelineno-34-46"><span class="linenos" data-linenos="46 "></span></a>    <span class="s1">&#39;Constant&#39;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-34-47" name="__codelineno-34-47"></a><a href="#__codelineno-34-47"><span class="linenos" data-linenos="47 "></span></a>    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;else_out&#39;</span><span class="p">],</span>
<a id="__codelineno-34-48" name="__codelineno-34-48"></a><a href="#__codelineno-34-48"><span class="linenos" data-linenos="48 "></span></a>    <span class="n">value</span><span class="o">=</span><span class="n">else_cst</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cst2&#39;</span><span class="p">)</span>
<a id="__codelineno-34-49" name="__codelineno-34-49"></a><a href="#__codelineno-34-49"><span class="linenos" data-linenos="49 "></span></a>
<a id="__codelineno-34-50" name="__codelineno-34-50"></a><a href="#__codelineno-34-50"><span class="linenos" data-linenos="50 "></span></a><span class="n">else_body</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">(</span>
<a id="__codelineno-34-51" name="__codelineno-34-51"></a><a href="#__codelineno-34-51"><span class="linenos" data-linenos="51 "></span></a>    <span class="p">[</span><span class="n">else_const_node</span><span class="p">],</span> <span class="s1">&#39;else_body&#39;</span><span class="p">,</span>
<a id="__codelineno-34-52" name="__codelineno-34-52"></a><a href="#__codelineno-34-52"><span class="linenos" data-linenos="52 "></span></a>    <span class="p">[],</span> <span class="p">[</span><span class="n">else_out</span><span class="p">])</span>
<a id="__codelineno-34-53" name="__codelineno-34-53"></a><a href="#__codelineno-34-53"><span class="linenos" data-linenos="53 "></span></a>
<a id="__codelineno-34-54" name="__codelineno-34-54"></a><a href="#__codelineno-34-54"><span class="linenos" data-linenos="54 "></span></a><span class="c1"># Finally the node If taking both graphs as attributes.</span>
<a id="__codelineno-34-55" name="__codelineno-34-55"></a><a href="#__codelineno-34-55"><span class="linenos" data-linenos="55 "></span></a><span class="n">if_node</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-34-56" name="__codelineno-34-56"></a><a href="#__codelineno-34-56"><span class="linenos" data-linenos="56 "></span></a>    <span class="s1">&#39;If&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cond&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span>
<a id="__codelineno-34-57" name="__codelineno-34-57"></a><a href="#__codelineno-34-57"><span class="linenos" data-linenos="57 "></span></a>    <span class="n">then_branch</span><span class="o">=</span><span class="n">then_body</span><span class="p">,</span>
<a id="__codelineno-34-58" name="__codelineno-34-58"></a><a href="#__codelineno-34-58"><span class="linenos" data-linenos="58 "></span></a>    <span class="n">else_branch</span><span class="o">=</span><span class="n">else_body</span><span class="p">)</span>
<a id="__codelineno-34-59" name="__codelineno-34-59"></a><a href="#__codelineno-34-59"><span class="linenos" data-linenos="59 "></span></a>
<a id="__codelineno-34-60" name="__codelineno-34-60"></a><a href="#__codelineno-34-60"><span class="linenos" data-linenos="60 "></span></a><span class="c1"># The final graph.</span>
<a id="__codelineno-34-61" name="__codelineno-34-61"></a><a href="#__codelineno-34-61"><span class="linenos" data-linenos="61 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">([</span><span class="n">rsum</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="n">if_node</span><span class="p">],</span> <span class="s1">&#39;if&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">],</span> <span class="p">[</span><span class="n">zero</span><span class="p">])</span>
<a id="__codelineno-34-62" name="__codelineno-34-62"></a><a href="#__codelineno-34-62"><span class="linenos" data-linenos="62 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a id="__codelineno-34-63" name="__codelineno-34-63"></a><a href="#__codelineno-34-63"><span class="linenos" data-linenos="63 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-34-64" name="__codelineno-34-64"></a><a href="#__codelineno-34-64"><span class="linenos" data-linenos="64 "></span></a>
<a id="__codelineno-34-65" name="__codelineno-34-65"></a><a href="#__codelineno-34-65"><span class="linenos" data-linenos="65 "></span></a><span class="c1"># Let&#39;s freeze the opset.</span>
<a id="__codelineno-34-66" name="__codelineno-34-66"></a><a href="#__codelineno-34-66"><span class="linenos" data-linenos="66 "></span></a><span class="k">del</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">opset_import</span><span class="p">[:]</span>
<a id="__codelineno-34-67" name="__codelineno-34-67"></a><a href="#__codelineno-34-67"><span class="linenos" data-linenos="67 "></span></a><span class="n">opset</span> <span class="o">=</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">opset_import</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
<a id="__codelineno-34-68" name="__codelineno-34-68"></a><a href="#__codelineno-34-68"><span class="linenos" data-linenos="68 "></span></a><span class="n">opset</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a id="__codelineno-34-69" name="__codelineno-34-69"></a><a href="#__codelineno-34-69"><span class="linenos" data-linenos="69 "></span></a><span class="n">opset</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="mi">15</span>
<a id="__codelineno-34-70" name="__codelineno-34-70"></a><a href="#__codelineno-34-70"><span class="linenos" data-linenos="70 "></span></a><span class="n">onnx_model</span><span class="o">.</span><span class="n">ir_version</span> <span class="o">=</span> <span class="mi">8</span>
<a id="__codelineno-34-71" name="__codelineno-34-71"></a><a href="#__codelineno-34-71"><span class="linenos" data-linenos="71 "></span></a>
<a id="__codelineno-34-72" name="__codelineno-34-72"></a><a href="#__codelineno-34-72"><span class="linenos" data-linenos="72 "></span></a><span class="c1"># Save.</span>
<a id="__codelineno-34-73" name="__codelineno-34-73"></a><a href="#__codelineno-34-73"><span class="linenos" data-linenos="73 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;onnx_if_sign.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-34-74" name="__codelineno-34-74"></a><a href="#__codelineno-34-74"><span class="linenos" data-linenos="74 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<a id="__codelineno-34-75" name="__codelineno-34-75"></a><a href="#__codelineno-34-75"><span class="linenos" data-linenos="75 "></span></a>
<a id="__codelineno-34-76" name="__codelineno-34-76"></a><a href="#__codelineno-34-76"><span class="linenos" data-linenos="76 "></span></a><span class="c1"># Let&#39;s see the output.</span>
<a id="__codelineno-34-77" name="__codelineno-34-77"></a><a href="#__codelineno-34-77"><span class="linenos" data-linenos="77 "></span></a><span class="n">sess</span> <span class="o">=</span> <span class="n">InferenceSession</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">(),</span>
<a id="__codelineno-34-78" name="__codelineno-34-78"></a><a href="#__codelineno-34-78"><span class="linenos" data-linenos="78 "></span></a>                        <span class="n">providers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CPUExecutionProvider&quot;</span><span class="p">])</span>
<a id="__codelineno-34-79" name="__codelineno-34-79"></a><a href="#__codelineno-34-79"><span class="linenos" data-linenos="79 "></span></a>
<a id="__codelineno-34-80" name="__codelineno-34-80"></a><a href="#__codelineno-34-80"><span class="linenos" data-linenos="80 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-34-81" name="__codelineno-34-81"></a><a href="#__codelineno-34-81"><span class="linenos" data-linenos="81 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">})</span>
<a id="__codelineno-34-82" name="__codelineno-34-82"></a><a href="#__codelineno-34-82"><span class="linenos" data-linenos="82 "></span></a>
<a id="__codelineno-34-83" name="__codelineno-34-83"></a><a href="#__codelineno-34-83"><span class="linenos" data-linenos="83 "></span></a><span class="c1"># It works.</span>
<a id="__codelineno-34-84" name="__codelineno-34-84"></a><a href="#__codelineno-34-84"><span class="linenos" data-linenos="84 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
<a id="__codelineno-34-85" name="__codelineno-34-85"></a><a href="#__codelineno-34-85"><span class="linenos" data-linenos="85 "></span></a><span class="nb">print</span><span class="p">()</span>
<a id="__codelineno-34-86" name="__codelineno-34-86"></a><a href="#__codelineno-34-86"><span class="linenos" data-linenos="86 "></span></a>
<a id="__codelineno-34-87" name="__codelineno-34-87"></a><a href="#__codelineno-34-87"><span class="linenos" data-linenos="87 "></span></a><span class="c1"># Some display.</span>
<a id="__codelineno-34-88" name="__codelineno-34-88"></a><a href="#__codelineno-34-88"><span class="linenos" data-linenos="88 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
</code></pre></div>
</details>

<details>
  <summary> 有条件算子的计算图: json 格式</summary>


<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><a href="#__codelineno-35-1"><span class="linenos" data-linenos="  1 "></span></a>result [array([1.], dtype=float32)]
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><a href="#__codelineno-35-2"><span class="linenos" data-linenos="  2 "></span></a>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><a href="#__codelineno-35-3"><span class="linenos" data-linenos="  3 "></span></a>ir_version: 8
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><a href="#__codelineno-35-4"><span class="linenos" data-linenos="  4 "></span></a>graph {
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><a href="#__codelineno-35-5"><span class="linenos" data-linenos="  5 "></span></a>  node {
<a id="__codelineno-35-6" name="__codelineno-35-6"></a><a href="#__codelineno-35-6"><span class="linenos" data-linenos="  6 "></span></a>    input: &quot;X&quot;
<a id="__codelineno-35-7" name="__codelineno-35-7"></a><a href="#__codelineno-35-7"><span class="linenos" data-linenos="  7 "></span></a>    output: &quot;rsum&quot;
<a id="__codelineno-35-8" name="__codelineno-35-8"></a><a href="#__codelineno-35-8"><span class="linenos" data-linenos="  8 "></span></a>    op_type: &quot;ReduceSum&quot;
<a id="__codelineno-35-9" name="__codelineno-35-9"></a><a href="#__codelineno-35-9"><span class="linenos" data-linenos="  9 "></span></a>  }
<a id="__codelineno-35-10" name="__codelineno-35-10"></a><a href="#__codelineno-35-10"><span class="linenos" data-linenos=" 10 "></span></a>  node {
<a id="__codelineno-35-11" name="__codelineno-35-11"></a><a href="#__codelineno-35-11"><span class="linenos" data-linenos=" 11 "></span></a>    input: &quot;rsum&quot;
<a id="__codelineno-35-12" name="__codelineno-35-12"></a><a href="#__codelineno-35-12"><span class="linenos" data-linenos=" 12 "></span></a>    input: &quot;zero&quot;
<a id="__codelineno-35-13" name="__codelineno-35-13"></a><a href="#__codelineno-35-13"><span class="linenos" data-linenos=" 13 "></span></a>    output: &quot;cond&quot;
<a id="__codelineno-35-14" name="__codelineno-35-14"></a><a href="#__codelineno-35-14"><span class="linenos" data-linenos=" 14 "></span></a>    op_type: &quot;Greater&quot;
<a id="__codelineno-35-15" name="__codelineno-35-15"></a><a href="#__codelineno-35-15"><span class="linenos" data-linenos=" 15 "></span></a>  }
<a id="__codelineno-35-16" name="__codelineno-35-16"></a><a href="#__codelineno-35-16"><span class="linenos" data-linenos=" 16 "></span></a>  node {
<a id="__codelineno-35-17" name="__codelineno-35-17"></a><a href="#__codelineno-35-17"><span class="linenos" data-linenos=" 17 "></span></a>    input: &quot;cond&quot;
<a id="__codelineno-35-18" name="__codelineno-35-18"></a><a href="#__codelineno-35-18"><span class="linenos" data-linenos=" 18 "></span></a>    output: &quot;Y&quot;
<a id="__codelineno-35-19" name="__codelineno-35-19"></a><a href="#__codelineno-35-19"><span class="linenos" data-linenos=" 19 "></span></a>    op_type: &quot;If&quot;
<a id="__codelineno-35-20" name="__codelineno-35-20"></a><a href="#__codelineno-35-20"><span class="linenos" data-linenos=" 20 "></span></a>    attribute {
<a id="__codelineno-35-21" name="__codelineno-35-21"></a><a href="#__codelineno-35-21"><span class="linenos" data-linenos=" 21 "></span></a>      name: &quot;else_branch&quot;
<a id="__codelineno-35-22" name="__codelineno-35-22"></a><a href="#__codelineno-35-22"><span class="linenos" data-linenos=" 22 "></span></a>      g {
<a id="__codelineno-35-23" name="__codelineno-35-23"></a><a href="#__codelineno-35-23"><span class="linenos" data-linenos=" 23 "></span></a>        node {
<a id="__codelineno-35-24" name="__codelineno-35-24"></a><a href="#__codelineno-35-24"><span class="linenos" data-linenos=" 24 "></span></a>          output: &quot;else_out&quot;
<a id="__codelineno-35-25" name="__codelineno-35-25"></a><a href="#__codelineno-35-25"><span class="linenos" data-linenos=" 25 "></span></a>          name: &quot;cst2&quot;
<a id="__codelineno-35-26" name="__codelineno-35-26"></a><a href="#__codelineno-35-26"><span class="linenos" data-linenos=" 26 "></span></a>          op_type: &quot;Constant&quot;
<a id="__codelineno-35-27" name="__codelineno-35-27"></a><a href="#__codelineno-35-27"><span class="linenos" data-linenos=" 27 "></span></a>          attribute {
<a id="__codelineno-35-28" name="__codelineno-35-28"></a><a href="#__codelineno-35-28"><span class="linenos" data-linenos=" 28 "></span></a>            name: &quot;value&quot;
<a id="__codelineno-35-29" name="__codelineno-35-29"></a><a href="#__codelineno-35-29"><span class="linenos" data-linenos=" 29 "></span></a>            t {
<a id="__codelineno-35-30" name="__codelineno-35-30"></a><a href="#__codelineno-35-30"><span class="linenos" data-linenos=" 30 "></span></a>              dims: 1
<a id="__codelineno-35-31" name="__codelineno-35-31"></a><a href="#__codelineno-35-31"><span class="linenos" data-linenos=" 31 "></span></a>              data_type: 1
<a id="__codelineno-35-32" name="__codelineno-35-32"></a><a href="#__codelineno-35-32"><span class="linenos" data-linenos=" 32 "></span></a>              raw_data: &quot;\000\000\200\277&quot;
<a id="__codelineno-35-33" name="__codelineno-35-33"></a><a href="#__codelineno-35-33"><span class="linenos" data-linenos=" 33 "></span></a>            }
<a id="__codelineno-35-34" name="__codelineno-35-34"></a><a href="#__codelineno-35-34"><span class="linenos" data-linenos=" 34 "></span></a>            type: TENSOR
<a id="__codelineno-35-35" name="__codelineno-35-35"></a><a href="#__codelineno-35-35"><span class="linenos" data-linenos=" 35 "></span></a>          }
<a id="__codelineno-35-36" name="__codelineno-35-36"></a><a href="#__codelineno-35-36"><span class="linenos" data-linenos=" 36 "></span></a>        }
<a id="__codelineno-35-37" name="__codelineno-35-37"></a><a href="#__codelineno-35-37"><span class="linenos" data-linenos=" 37 "></span></a>        name: &quot;else_body&quot;
<a id="__codelineno-35-38" name="__codelineno-35-38"></a><a href="#__codelineno-35-38"><span class="linenos" data-linenos=" 38 "></span></a>        output {
<a id="__codelineno-35-39" name="__codelineno-35-39"></a><a href="#__codelineno-35-39"><span class="linenos" data-linenos=" 39 "></span></a>          name: &quot;else_out&quot;
<a id="__codelineno-35-40" name="__codelineno-35-40"></a><a href="#__codelineno-35-40"><span class="linenos" data-linenos=" 40 "></span></a>          type {
<a id="__codelineno-35-41" name="__codelineno-35-41"></a><a href="#__codelineno-35-41"><span class="linenos" data-linenos=" 41 "></span></a>            tensor_type {
<a id="__codelineno-35-42" name="__codelineno-35-42"></a><a href="#__codelineno-35-42"><span class="linenos" data-linenos=" 42 "></span></a>              elem_type: 1
<a id="__codelineno-35-43" name="__codelineno-35-43"></a><a href="#__codelineno-35-43"><span class="linenos" data-linenos=" 43 "></span></a>              shape {
<a id="__codelineno-35-44" name="__codelineno-35-44"></a><a href="#__codelineno-35-44"><span class="linenos" data-linenos=" 44 "></span></a>                dim {
<a id="__codelineno-35-45" name="__codelineno-35-45"></a><a href="#__codelineno-35-45"><span class="linenos" data-linenos=" 45 "></span></a>                  dim_value: 5
<a id="__codelineno-35-46" name="__codelineno-35-46"></a><a href="#__codelineno-35-46"><span class="linenos" data-linenos=" 46 "></span></a>                }
<a id="__codelineno-35-47" name="__codelineno-35-47"></a><a href="#__codelineno-35-47"><span class="linenos" data-linenos=" 47 "></span></a>              }
<a id="__codelineno-35-48" name="__codelineno-35-48"></a><a href="#__codelineno-35-48"><span class="linenos" data-linenos=" 48 "></span></a>            }
<a id="__codelineno-35-49" name="__codelineno-35-49"></a><a href="#__codelineno-35-49"><span class="linenos" data-linenos=" 49 "></span></a>          }
<a id="__codelineno-35-50" name="__codelineno-35-50"></a><a href="#__codelineno-35-50"><span class="linenos" data-linenos=" 50 "></span></a>        }
<a id="__codelineno-35-51" name="__codelineno-35-51"></a><a href="#__codelineno-35-51"><span class="linenos" data-linenos=" 51 "></span></a>      }
<a id="__codelineno-35-52" name="__codelineno-35-52"></a><a href="#__codelineno-35-52"><span class="linenos" data-linenos=" 52 "></span></a>      type: GRAPH
<a id="__codelineno-35-53" name="__codelineno-35-53"></a><a href="#__codelineno-35-53"><span class="linenos" data-linenos=" 53 "></span></a>    }
<a id="__codelineno-35-54" name="__codelineno-35-54"></a><a href="#__codelineno-35-54"><span class="linenos" data-linenos=" 54 "></span></a>    attribute {
<a id="__codelineno-35-55" name="__codelineno-35-55"></a><a href="#__codelineno-35-55"><span class="linenos" data-linenos=" 55 "></span></a>      name: &quot;then_branch&quot;
<a id="__codelineno-35-56" name="__codelineno-35-56"></a><a href="#__codelineno-35-56"><span class="linenos" data-linenos=" 56 "></span></a>      g {
<a id="__codelineno-35-57" name="__codelineno-35-57"></a><a href="#__codelineno-35-57"><span class="linenos" data-linenos=" 57 "></span></a>        node {
<a id="__codelineno-35-58" name="__codelineno-35-58"></a><a href="#__codelineno-35-58"><span class="linenos" data-linenos=" 58 "></span></a>          output: &quot;then_out&quot;
<a id="__codelineno-35-59" name="__codelineno-35-59"></a><a href="#__codelineno-35-59"><span class="linenos" data-linenos=" 59 "></span></a>          name: &quot;cst1&quot;
<a id="__codelineno-35-60" name="__codelineno-35-60"></a><a href="#__codelineno-35-60"><span class="linenos" data-linenos=" 60 "></span></a>          op_type: &quot;Constant&quot;
<a id="__codelineno-35-61" name="__codelineno-35-61"></a><a href="#__codelineno-35-61"><span class="linenos" data-linenos=" 61 "></span></a>          attribute {
<a id="__codelineno-35-62" name="__codelineno-35-62"></a><a href="#__codelineno-35-62"><span class="linenos" data-linenos=" 62 "></span></a>            name: &quot;value&quot;
<a id="__codelineno-35-63" name="__codelineno-35-63"></a><a href="#__codelineno-35-63"><span class="linenos" data-linenos=" 63 "></span></a>            t {
<a id="__codelineno-35-64" name="__codelineno-35-64"></a><a href="#__codelineno-35-64"><span class="linenos" data-linenos=" 64 "></span></a>              dims: 1
<a id="__codelineno-35-65" name="__codelineno-35-65"></a><a href="#__codelineno-35-65"><span class="linenos" data-linenos=" 65 "></span></a>              data_type: 1
<a id="__codelineno-35-66" name="__codelineno-35-66"></a><a href="#__codelineno-35-66"><span class="linenos" data-linenos=" 66 "></span></a>              raw_data: &quot;\000\000\200?&quot;
<a id="__codelineno-35-67" name="__codelineno-35-67"></a><a href="#__codelineno-35-67"><span class="linenos" data-linenos=" 67 "></span></a>            }
<a id="__codelineno-35-68" name="__codelineno-35-68"></a><a href="#__codelineno-35-68"><span class="linenos" data-linenos=" 68 "></span></a>            type: TENSOR
<a id="__codelineno-35-69" name="__codelineno-35-69"></a><a href="#__codelineno-35-69"><span class="linenos" data-linenos=" 69 "></span></a>          }
<a id="__codelineno-35-70" name="__codelineno-35-70"></a><a href="#__codelineno-35-70"><span class="linenos" data-linenos=" 70 "></span></a>        }
<a id="__codelineno-35-71" name="__codelineno-35-71"></a><a href="#__codelineno-35-71"><span class="linenos" data-linenos=" 71 "></span></a>        name: &quot;then_body&quot;
<a id="__codelineno-35-72" name="__codelineno-35-72"></a><a href="#__codelineno-35-72"><span class="linenos" data-linenos=" 72 "></span></a>        output {
<a id="__codelineno-35-73" name="__codelineno-35-73"></a><a href="#__codelineno-35-73"><span class="linenos" data-linenos=" 73 "></span></a>          name: &quot;then_out&quot;
<a id="__codelineno-35-74" name="__codelineno-35-74"></a><a href="#__codelineno-35-74"><span class="linenos" data-linenos=" 74 "></span></a>          type {
<a id="__codelineno-35-75" name="__codelineno-35-75"></a><a href="#__codelineno-35-75"><span class="linenos" data-linenos=" 75 "></span></a>            tensor_type {
<a id="__codelineno-35-76" name="__codelineno-35-76"></a><a href="#__codelineno-35-76"><span class="linenos" data-linenos=" 76 "></span></a>              elem_type: 1
<a id="__codelineno-35-77" name="__codelineno-35-77"></a><a href="#__codelineno-35-77"><span class="linenos" data-linenos=" 77 "></span></a>            }
<a id="__codelineno-35-78" name="__codelineno-35-78"></a><a href="#__codelineno-35-78"><span class="linenos" data-linenos=" 78 "></span></a>          }
<a id="__codelineno-35-79" name="__codelineno-35-79"></a><a href="#__codelineno-35-79"><span class="linenos" data-linenos=" 79 "></span></a>        }
<a id="__codelineno-35-80" name="__codelineno-35-80"></a><a href="#__codelineno-35-80"><span class="linenos" data-linenos=" 80 "></span></a>      }
<a id="__codelineno-35-81" name="__codelineno-35-81"></a><a href="#__codelineno-35-81"><span class="linenos" data-linenos=" 81 "></span></a>      type: GRAPH
<a id="__codelineno-35-82" name="__codelineno-35-82"></a><a href="#__codelineno-35-82"><span class="linenos" data-linenos=" 82 "></span></a>    }
<a id="__codelineno-35-83" name="__codelineno-35-83"></a><a href="#__codelineno-35-83"><span class="linenos" data-linenos=" 83 "></span></a>  }
<a id="__codelineno-35-84" name="__codelineno-35-84"></a><a href="#__codelineno-35-84"><span class="linenos" data-linenos=" 84 "></span></a>  name: &quot;if&quot;
<a id="__codelineno-35-85" name="__codelineno-35-85"></a><a href="#__codelineno-35-85"><span class="linenos" data-linenos=" 85 "></span></a>  initializer {
<a id="__codelineno-35-86" name="__codelineno-35-86"></a><a href="#__codelineno-35-86"><span class="linenos" data-linenos=" 86 "></span></a>    dims: 1
<a id="__codelineno-35-87" name="__codelineno-35-87"></a><a href="#__codelineno-35-87"><span class="linenos" data-linenos=" 87 "></span></a>    data_type: 1
<a id="__codelineno-35-88" name="__codelineno-35-88"></a><a href="#__codelineno-35-88"><span class="linenos" data-linenos=" 88 "></span></a>    name: &quot;zero&quot;
<a id="__codelineno-35-89" name="__codelineno-35-89"></a><a href="#__codelineno-35-89"><span class="linenos" data-linenos=" 89 "></span></a>    raw_data: &quot;\000\000\000\000&quot;
<a id="__codelineno-35-90" name="__codelineno-35-90"></a><a href="#__codelineno-35-90"><span class="linenos" data-linenos=" 90 "></span></a>  }
<a id="__codelineno-35-91" name="__codelineno-35-91"></a><a href="#__codelineno-35-91"><span class="linenos" data-linenos=" 91 "></span></a>  input {
<a id="__codelineno-35-92" name="__codelineno-35-92"></a><a href="#__codelineno-35-92"><span class="linenos" data-linenos=" 92 "></span></a>    name: &quot;X&quot;
<a id="__codelineno-35-93" name="__codelineno-35-93"></a><a href="#__codelineno-35-93"><span class="linenos" data-linenos=" 93 "></span></a>    type {
<a id="__codelineno-35-94" name="__codelineno-35-94"></a><a href="#__codelineno-35-94"><span class="linenos" data-linenos=" 94 "></span></a>      tensor_type {
<a id="__codelineno-35-95" name="__codelineno-35-95"></a><a href="#__codelineno-35-95"><span class="linenos" data-linenos=" 95 "></span></a>        elem_type: 1
<a id="__codelineno-35-96" name="__codelineno-35-96"></a><a href="#__codelineno-35-96"><span class="linenos" data-linenos=" 96 "></span></a>        shape {
<a id="__codelineno-35-97" name="__codelineno-35-97"></a><a href="#__codelineno-35-97"><span class="linenos" data-linenos=" 97 "></span></a>          dim {
<a id="__codelineno-35-98" name="__codelineno-35-98"></a><a href="#__codelineno-35-98"><span class="linenos" data-linenos=" 98 "></span></a>          }
<a id="__codelineno-35-99" name="__codelineno-35-99"></a><a href="#__codelineno-35-99"><span class="linenos" data-linenos=" 99 "></span></a>          dim {
<a id="__codelineno-35-100" name="__codelineno-35-100"></a><a href="#__codelineno-35-100"><span class="linenos" data-linenos="100 "></span></a>          }
<a id="__codelineno-35-101" name="__codelineno-35-101"></a><a href="#__codelineno-35-101"><span class="linenos" data-linenos="101 "></span></a>        }
<a id="__codelineno-35-102" name="__codelineno-35-102"></a><a href="#__codelineno-35-102"><span class="linenos" data-linenos="102 "></span></a>      }
<a id="__codelineno-35-103" name="__codelineno-35-103"></a><a href="#__codelineno-35-103"><span class="linenos" data-linenos="103 "></span></a>    }
<a id="__codelineno-35-104" name="__codelineno-35-104"></a><a href="#__codelineno-35-104"><span class="linenos" data-linenos="104 "></span></a>  }
<a id="__codelineno-35-105" name="__codelineno-35-105"></a><a href="#__codelineno-35-105"><span class="linenos" data-linenos="105 "></span></a>  output {
<a id="__codelineno-35-106" name="__codelineno-35-106"></a><a href="#__codelineno-35-106"><span class="linenos" data-linenos="106 "></span></a>    name: &quot;Y&quot;
<a id="__codelineno-35-107" name="__codelineno-35-107"></a><a href="#__codelineno-35-107"><span class="linenos" data-linenos="107 "></span></a>    type {
<a id="__codelineno-35-108" name="__codelineno-35-108"></a><a href="#__codelineno-35-108"><span class="linenos" data-linenos="108 "></span></a>      tensor_type {
<a id="__codelineno-35-109" name="__codelineno-35-109"></a><a href="#__codelineno-35-109"><span class="linenos" data-linenos="109 "></span></a>        elem_type: 1
<a id="__codelineno-35-110" name="__codelineno-35-110"></a><a href="#__codelineno-35-110"><span class="linenos" data-linenos="110 "></span></a>        shape {
<a id="__codelineno-35-111" name="__codelineno-35-111"></a><a href="#__codelineno-35-111"><span class="linenos" data-linenos="111 "></span></a>          dim {
<a id="__codelineno-35-112" name="__codelineno-35-112"></a><a href="#__codelineno-35-112"><span class="linenos" data-linenos="112 "></span></a>          }
<a id="__codelineno-35-113" name="__codelineno-35-113"></a><a href="#__codelineno-35-113"><span class="linenos" data-linenos="113 "></span></a>        }
<a id="__codelineno-35-114" name="__codelineno-35-114"></a><a href="#__codelineno-35-114"><span class="linenos" data-linenos="114 "></span></a>      }
<a id="__codelineno-35-115" name="__codelineno-35-115"></a><a href="#__codelineno-35-115"><span class="linenos" data-linenos="115 "></span></a>    }
<a id="__codelineno-35-116" name="__codelineno-35-116"></a><a href="#__codelineno-35-116"><span class="linenos" data-linenos="116 "></span></a>  }
<a id="__codelineno-35-117" name="__codelineno-35-117"></a><a href="#__codelineno-35-117"><span class="linenos" data-linenos="117 "></span></a>}
<a id="__codelineno-35-118" name="__codelineno-35-118"></a><a href="#__codelineno-35-118"><span class="linenos" data-linenos="118 "></span></a>opset_import {
<a id="__codelineno-35-119" name="__codelineno-35-119"></a><a href="#__codelineno-35-119"><span class="linenos" data-linenos="119 "></span></a>  domain: &quot;&quot;
<a id="__codelineno-35-120" name="__codelineno-35-120"></a><a href="#__codelineno-35-120"><span class="linenos" data-linenos="120 "></span></a>  version: 15
<a id="__codelineno-35-121" name="__codelineno-35-121"></a><a href="#__codelineno-35-121"><span class="linenos" data-linenos="121 "></span></a>}
</code></pre></div>
</details>

<p>通过下图可以更容易地形象化整体。</p>
<p><img alt="条件算子" src="../img/dot_if_py.png" /></p>
<p>else 和 then 分支都非常简单。节点If甚至可以用节点Where替换，这样会更快。当两个分支都较大时，跳过一个分支会更有效率，这变得很有趣。</p>
<h2 id="scan">扫描算子scan</h2>
<p>阅读规范时，扫描似乎相当复杂。循环遍历张量的一维并将结果存储在预分配的张量中很有用。</p>
<p>以下示例为回归问题实现了经典的最近邻算法。第一步是计算输入特征X和训练集W之间的成对距离：
接下来是TopK算子，用于提取k 个最近邻居。</p>
<details>
  <summary> 扫描算子 </summary>

<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><a href="#__codelineno-36-1"><span class="linenos" data-linenos="  1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><a href="#__codelineno-36-2"><span class="linenos" data-linenos="  2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">numpy_helper</span><span class="p">,</span> <span class="n">TensorProto</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><a href="#__codelineno-36-3"><span class="linenos" data-linenos="  3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><a href="#__codelineno-36-4"><span class="linenos" data-linenos="  4 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">set_model_props</span><span class="p">,</span> <span class="n">make_tensor</span><span class="p">,</span> <span class="n">make_graph</span><span class="p">,</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><a href="#__codelineno-36-5"><span class="linenos" data-linenos="  5 "></span></a>    <span class="n">make_tensor_value_info</span><span class="p">)</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a><a href="#__codelineno-36-6"><span class="linenos" data-linenos="  6 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><a href="#__codelineno-36-7"><span class="linenos" data-linenos="  7 "></span></a>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a><a href="#__codelineno-36-8"><span class="linenos" data-linenos="  8 "></span></a><span class="c1"># subgraph</span>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><a href="#__codelineno-36-9"><span class="linenos" data-linenos="  9 "></span></a><span class="n">initializers</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><a href="#__codelineno-36-10"><span class="linenos" data-linenos=" 10 "></span></a><span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><a href="#__codelineno-36-11"><span class="linenos" data-linenos=" 11 "></span></a><span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a><a href="#__codelineno-36-12"><span class="linenos" data-linenos=" 12 "></span></a><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a><a href="#__codelineno-36-13"><span class="linenos" data-linenos=" 13 "></span></a>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a><a href="#__codelineno-36-14"><span class="linenos" data-linenos=" 14 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;next_in&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><a href="#__codelineno-36-15"><span class="linenos" data-linenos=" 15 "></span></a><span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a><a href="#__codelineno-36-16"><span class="linenos" data-linenos=" 16 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a><a href="#__codelineno-36-17"><span class="linenos" data-linenos=" 17 "></span></a><span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-36-18" name="__codelineno-36-18"></a><a href="#__codelineno-36-18"><span class="linenos" data-linenos=" 18 "></span></a>
<a id="__codelineno-36-19" name="__codelineno-36-19"></a><a href="#__codelineno-36-19"><span class="linenos" data-linenos=" 19 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;next_out&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-36-20" name="__codelineno-36-20"></a><a href="#__codelineno-36-20"><span class="linenos" data-linenos=" 20 "></span></a><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-36-21" name="__codelineno-36-21"></a><a href="#__codelineno-36-21"><span class="linenos" data-linenos=" 21 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;scan_out&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-36-22" name="__codelineno-36-22"></a><a href="#__codelineno-36-22"><span class="linenos" data-linenos=" 22 "></span></a><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-36-23" name="__codelineno-36-23"></a><a href="#__codelineno-36-23"><span class="linenos" data-linenos=" 23 "></span></a>
<a id="__codelineno-36-24" name="__codelineno-36-24"></a><a href="#__codelineno-36-24"><span class="linenos" data-linenos=" 24 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-25" name="__codelineno-36-25"></a><a href="#__codelineno-36-25"><span class="linenos" data-linenos=" 25 "></span></a>    <span class="s1">&#39;Identity&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;next_in&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;next_out&#39;</span><span class="p">],</span>
<a id="__codelineno-36-26" name="__codelineno-36-26"></a><a href="#__codelineno-36-26"><span class="linenos" data-linenos=" 26 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cdistd_17_Identity&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-27" name="__codelineno-36-27"></a><a href="#__codelineno-36-27"><span class="linenos" data-linenos=" 27 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-28" name="__codelineno-36-28"></a><a href="#__codelineno-36-28"><span class="linenos" data-linenos=" 28 "></span></a>
<a id="__codelineno-36-29" name="__codelineno-36-29"></a><a href="#__codelineno-36-29"><span class="linenos" data-linenos=" 29 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-30" name="__codelineno-36-30"></a><a href="#__codelineno-36-30"><span class="linenos" data-linenos=" 30 "></span></a>    <span class="s1">&#39;Sub&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;next_in&#39;</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;cdistdf_17_C0&#39;</span><span class="p">],</span>
<a id="__codelineno-36-31" name="__codelineno-36-31"></a><a href="#__codelineno-36-31"><span class="linenos" data-linenos=" 31 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cdistdf_17_Sub&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-32" name="__codelineno-36-32"></a><a href="#__codelineno-36-32"><span class="linenos" data-linenos=" 32 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-33" name="__codelineno-36-33"></a><a href="#__codelineno-36-33"><span class="linenos" data-linenos=" 33 "></span></a>
<a id="__codelineno-36-34" name="__codelineno-36-34"></a><a href="#__codelineno-36-34"><span class="linenos" data-linenos=" 34 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-35" name="__codelineno-36-35"></a><a href="#__codelineno-36-35"><span class="linenos" data-linenos=" 35 "></span></a>    <span class="s1">&#39;ReduceSumSquare&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cdistdf_17_C0&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;cdistdf_17_reduced0&#39;</span><span class="p">],</span>
<a id="__codelineno-36-36" name="__codelineno-36-36"></a><a href="#__codelineno-36-36"><span class="linenos" data-linenos=" 36 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cdistdf_17_ReduceSumSquare&#39;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-37" name="__codelineno-36-37"></a><a href="#__codelineno-36-37"><span class="linenos" data-linenos=" 37 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-38" name="__codelineno-36-38"></a><a href="#__codelineno-36-38"><span class="linenos" data-linenos=" 38 "></span></a>
<a id="__codelineno-36-39" name="__codelineno-36-39"></a><a href="#__codelineno-36-39"><span class="linenos" data-linenos=" 39 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-40" name="__codelineno-36-40"></a><a href="#__codelineno-36-40"><span class="linenos" data-linenos=" 40 "></span></a>    <span class="s1">&#39;Identity&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cdistdf_17_reduced0&#39;</span><span class="p">],</span>
<a id="__codelineno-36-41" name="__codelineno-36-41"></a><a href="#__codelineno-36-41"><span class="linenos" data-linenos=" 41 "></span></a>    <span class="p">[</span><span class="s1">&#39;scan_out&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cdistdf_17_Identity&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-42" name="__codelineno-36-42"></a><a href="#__codelineno-36-42"><span class="linenos" data-linenos=" 42 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-43" name="__codelineno-36-43"></a><a href="#__codelineno-36-43"><span class="linenos" data-linenos=" 43 "></span></a>
<a id="__codelineno-36-44" name="__codelineno-36-44"></a><a href="#__codelineno-36-44"><span class="linenos" data-linenos=" 44 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="s1">&#39;OnnxIdentity&#39;</span><span class="p">,</span>
<a id="__codelineno-36-45" name="__codelineno-36-45"></a><a href="#__codelineno-36-45"><span class="linenos" data-linenos=" 45 "></span></a>                   <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">initializers</span><span class="p">)</span>
<a id="__codelineno-36-46" name="__codelineno-36-46"></a><a href="#__codelineno-36-46"><span class="linenos" data-linenos=" 46 "></span></a>
<a id="__codelineno-36-47" name="__codelineno-36-47"></a><a href="#__codelineno-36-47"><span class="linenos" data-linenos=" 47 "></span></a><span class="c1"># main graph</span>
<a id="__codelineno-36-48" name="__codelineno-36-48"></a><a href="#__codelineno-36-48"><span class="linenos" data-linenos=" 48 "></span></a>
<a id="__codelineno-36-49" name="__codelineno-36-49"></a><a href="#__codelineno-36-49"><span class="linenos" data-linenos=" 49 "></span></a><span class="n">initializers</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-36-50" name="__codelineno-36-50"></a><a href="#__codelineno-36-50"><span class="linenos" data-linenos=" 50 "></span></a><span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-36-51" name="__codelineno-36-51"></a><a href="#__codelineno-36-51"><span class="linenos" data-linenos=" 51 "></span></a><span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-36-52" name="__codelineno-36-52"></a><a href="#__codelineno-36-52"><span class="linenos" data-linenos=" 52 "></span></a><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-36-53" name="__codelineno-36-53"></a><a href="#__codelineno-36-53"><span class="linenos" data-linenos=" 53 "></span></a>
<a id="__codelineno-36-54" name="__codelineno-36-54"></a><a href="#__codelineno-36-54"><span class="linenos" data-linenos=" 54 "></span></a><span class="n">opsets</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;ai.onnx.ml&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">}</span>
<a id="__codelineno-36-55" name="__codelineno-36-55"></a><a href="#__codelineno-36-55"><span class="linenos" data-linenos=" 55 "></span></a><span class="n">target_opset</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># subgraphs</span>
<a id="__codelineno-36-56" name="__codelineno-36-56"></a><a href="#__codelineno-36-56"><span class="linenos" data-linenos=" 56 "></span></a>
<a id="__codelineno-36-57" name="__codelineno-36-57"></a><a href="#__codelineno-36-57"><span class="linenos" data-linenos=" 57 "></span></a><span class="c1"># initializers</span>
<a id="__codelineno-36-58" name="__codelineno-36-58"></a><a href="#__codelineno-36-58"><span class="linenos" data-linenos=" 58 "></span></a><span class="n">list_value</span> <span class="o">=</span> <span class="p">[</span><span class="mf">23.29599822460675</span><span class="p">,</span> <span class="o">-</span><span class="mf">120.86516699239603</span><span class="p">,</span> <span class="o">-</span><span class="mf">144.70495899914215</span><span class="p">,</span> <span class="o">-</span><span class="mf">260.08772982740413</span><span class="p">,</span>
<a id="__codelineno-36-59" name="__codelineno-36-59"></a><a href="#__codelineno-36-59"><span class="linenos" data-linenos=" 59 "></span></a>              <span class="mf">154.65272105889147</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.23295157108991</span><span class="p">,</span> <span class="mf">247.45232560871727</span><span class="p">,</span> <span class="o">-</span><span class="mf">182.83789715805776</span><span class="p">,</span>
<a id="__codelineno-36-60" name="__codelineno-36-60"></a><a href="#__codelineno-36-60"><span class="linenos" data-linenos=" 60 "></span></a>              <span class="o">-</span><span class="mf">132.92727431421793</span><span class="p">,</span> <span class="mf">147.48710175784703</span><span class="p">,</span> <span class="mf">88.27761768038069</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.87785569894749</span><span class="p">,</span>
<a id="__codelineno-36-61" name="__codelineno-36-61"></a><a href="#__codelineno-36-61"><span class="linenos" data-linenos=" 61 "></span></a>              <span class="mf">111.71487894705504</span><span class="p">,</span> <span class="mf">301.0518319089629</span><span class="p">,</span> <span class="o">-</span><span class="mf">29.64235742280055</span><span class="p">,</span> <span class="o">-</span><span class="mf">113.78493504731911</span><span class="p">,</span>
<a id="__codelineno-36-62" name="__codelineno-36-62"></a><a href="#__codelineno-36-62"><span class="linenos" data-linenos=" 62 "></span></a>              <span class="o">-</span><span class="mf">204.41218591022718</span><span class="p">,</span> <span class="mf">112.26561056133608</span><span class="p">,</span> <span class="mf">66.04032954135549</span><span class="p">,</span>
<a id="__codelineno-36-63" name="__codelineno-36-63"></a><a href="#__codelineno-36-63"><span class="linenos" data-linenos=" 63 "></span></a>              <span class="o">-</span><span class="mf">229.5428380626701</span><span class="p">,</span> <span class="o">-</span><span class="mf">33.549262642481615</span><span class="p">,</span> <span class="o">-</span><span class="mf">140.95737409864623</span><span class="p">,</span> <span class="o">-</span><span class="mf">87.8145187836131</span><span class="p">,</span>
<a id="__codelineno-36-64" name="__codelineno-36-64"></a><a href="#__codelineno-36-64"><span class="linenos" data-linenos=" 64 "></span></a>              <span class="o">-</span><span class="mf">90.61397011283958</span><span class="p">,</span> <span class="mf">57.185488100413366</span><span class="p">,</span> <span class="mf">56.864151796743855</span><span class="p">,</span> <span class="mf">77.09054590340892</span><span class="p">,</span>
<a id="__codelineno-36-65" name="__codelineno-36-65"></a><a href="#__codelineno-36-65"><span class="linenos" data-linenos=" 65 "></span></a>              <span class="o">-</span><span class="mf">187.72501631246712</span><span class="p">,</span> <span class="o">-</span><span class="mf">42.779503579806025</span><span class="p">,</span> <span class="o">-</span><span class="mf">21.642642730674076</span><span class="p">,</span> <span class="o">-</span><span class="mf">44.58517761667535</span><span class="p">,</span>
<a id="__codelineno-36-66" name="__codelineno-36-66"></a><a href="#__codelineno-36-66"><span class="linenos" data-linenos=" 66 "></span></a>              <span class="mf">78.56025104939847</span><span class="p">,</span> <span class="o">-</span><span class="mf">23.92423223842056</span><span class="p">,</span> <span class="mf">234.9166231927213</span><span class="p">,</span> <span class="o">-</span><span class="mf">73.73512816431007</span><span class="p">,</span>
<a id="__codelineno-36-67" name="__codelineno-36-67"></a><a href="#__codelineno-36-67"><span class="linenos" data-linenos=" 67 "></span></a>              <span class="o">-</span><span class="mf">10.150864499514297</span><span class="p">,</span> <span class="o">-</span><span class="mf">70.37105466673813</span><span class="p">,</span> <span class="mf">65.5755688281476</span><span class="p">,</span> <span class="mf">108.68676290979731</span><span class="p">,</span> <span class="o">-</span><span class="mf">78.36748960443065</span><span class="p">]</span>
<a id="__codelineno-36-68" name="__codelineno-36-68"></a><a href="#__codelineno-36-68"><span class="linenos" data-linenos=" 68 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list_value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<a id="__codelineno-36-69" name="__codelineno-36-69"></a><a href="#__codelineno-36-69"><span class="linenos" data-linenos=" 69 "></span></a><span class="n">tensor</span> <span class="o">=</span> <span class="n">numpy_helper</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span>
<a id="__codelineno-36-70" name="__codelineno-36-70"></a><a href="#__codelineno-36-70"><span class="linenos" data-linenos=" 70 "></span></a>    <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;knny_ArrayFeatureExtractorcst&#39;</span><span class="p">)</span>
<a id="__codelineno-36-71" name="__codelineno-36-71"></a><a href="#__codelineno-36-71"><span class="linenos" data-linenos=" 71 "></span></a><span class="n">initializers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
<a id="__codelineno-36-72" name="__codelineno-36-72"></a><a href="#__codelineno-36-72"><span class="linenos" data-linenos=" 72 "></span></a>
<a id="__codelineno-36-73" name="__codelineno-36-73"></a><a href="#__codelineno-36-73"><span class="linenos" data-linenos=" 73 "></span></a><span class="n">list_value</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.1394007205963135</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6848101019859314</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.234825849533081</span><span class="p">,</span> <span class="mf">0.4023416340351105</span><span class="p">,</span>
<a id="__codelineno-36-74" name="__codelineno-36-74"></a><a href="#__codelineno-36-74"><span class="linenos" data-linenos=" 74 "></span></a>              <span class="mf">0.17742614448070526</span><span class="p">,</span> <span class="mf">0.46278226375579834</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4017809331417084</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.630198359489441</span><span class="p">,</span>
<a id="__codelineno-36-75" name="__codelineno-36-75"></a><a href="#__codelineno-36-75"><span class="linenos" data-linenos=" 75 "></span></a>              <span class="o">-</span><span class="mf">0.5096521973609924</span><span class="p">,</span> <span class="mf">0.7774903774261475</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4380742907524109</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2527953386306763</span><span class="p">,</span>
<a id="__codelineno-36-76" name="__codelineno-36-76"></a><a href="#__codelineno-36-76"><span class="linenos" data-linenos=" 76 "></span></a>              <span class="o">-</span><span class="mf">1.0485529899597168</span><span class="p">,</span> <span class="mf">1.950775384902954</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.420017957687378</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7062702178955078</span><span class="p">,</span>
<a id="__codelineno-36-77" name="__codelineno-36-77"></a><a href="#__codelineno-36-77"><span class="linenos" data-linenos=" 77 "></span></a>              <span class="mf">1.8675580024719238</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15135720372200012</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9772778749465942</span><span class="p">,</span> <span class="mf">0.9500884413719177</span><span class="p">,</span>
<a id="__codelineno-36-78" name="__codelineno-36-78"></a><a href="#__codelineno-36-78"><span class="linenos" data-linenos=" 78 "></span></a>              <span class="o">-</span><span class="mf">2.5529897212982178</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7421650290489197</span><span class="p">,</span> <span class="mf">0.653618574142456</span><span class="p">,</span> <span class="mf">0.8644362092018127</span><span class="p">,</span>
<a id="__codelineno-36-79" name="__codelineno-36-79"></a><a href="#__codelineno-36-79"><span class="linenos" data-linenos=" 79 "></span></a>              <span class="mf">1.5327792167663574</span><span class="p">,</span> <span class="mf">0.37816253304481506</span><span class="p">,</span> <span class="mf">1.4693588018417358</span><span class="p">,</span> <span class="mf">0.154947429895401</span><span class="p">,</span>
<a id="__codelineno-36-80" name="__codelineno-36-80"></a><a href="#__codelineno-36-80"><span class="linenos" data-linenos=" 80 "></span></a>              <span class="o">-</span><span class="mf">0.6724604368209839</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7262825965881348</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.35955315828323364</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8131462931632996</span><span class="p">,</span>
<a id="__codelineno-36-81" name="__codelineno-36-81"></a><a href="#__codelineno-36-81"><span class="linenos" data-linenos=" 81 "></span></a>              <span class="o">-</span><span class="mf">0.8707971572875977</span><span class="p">,</span> <span class="mf">0.056165341287851334</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5788496732711792</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3115525245666504</span><span class="p">,</span>
<a id="__codelineno-36-82" name="__codelineno-36-82"></a><a href="#__codelineno-36-82"><span class="linenos" data-linenos=" 82 "></span></a>              <span class="mf">1.2302906513214111</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.302302747964859</span><span class="p">,</span> <span class="mf">1.202379822731018</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.38732680678367615</span><span class="p">,</span>
<a id="__codelineno-36-83" name="__codelineno-36-83"></a><a href="#__codelineno-36-83"><span class="linenos" data-linenos=" 83 "></span></a>              <span class="mf">2.269754648208618</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.18718385696411133</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4543657302856445</span><span class="p">,</span> <span class="mf">0.04575851559638977</span><span class="p">,</span>
<a id="__codelineno-36-84" name="__codelineno-36-84"></a><a href="#__codelineno-36-84"><span class="linenos" data-linenos=" 84 "></span></a>              <span class="o">-</span><span class="mf">0.9072983860969543</span><span class="p">,</span> <span class="mf">0.12898291647434235</span><span class="p">,</span> <span class="mf">0.05194539576768875</span><span class="p">,</span> <span class="mf">0.7290905714035034</span><span class="p">,</span>
<a id="__codelineno-36-85" name="__codelineno-36-85"></a><a href="#__codelineno-36-85"><span class="linenos" data-linenos=" 85 "></span></a>              <span class="mf">1.4940791130065918</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8540957570075989</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2051582634449005</span><span class="p">,</span> <span class="mf">0.3130677044391632</span><span class="p">,</span>
<a id="__codelineno-36-86" name="__codelineno-36-86"></a><a href="#__codelineno-36-86"><span class="linenos" data-linenos=" 86 "></span></a>              <span class="mf">1.764052391052246</span><span class="p">,</span> <span class="mf">2.2408931255340576</span><span class="p">,</span> <span class="mf">0.40015721321105957</span><span class="p">,</span> <span class="mf">0.978738009929657</span><span class="p">,</span>
<a id="__codelineno-36-87" name="__codelineno-36-87"></a><a href="#__codelineno-36-87"><span class="linenos" data-linenos=" 87 "></span></a>              <span class="mf">0.06651721894741058</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3627411723136902</span><span class="p">,</span> <span class="mf">0.30247190594673157</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6343221068382263</span><span class="p">,</span>
<a id="__codelineno-36-88" name="__codelineno-36-88"></a><a href="#__codelineno-36-88"><span class="linenos" data-linenos=" 88 "></span></a>              <span class="o">-</span><span class="mf">0.5108051300048828</span><span class="p">,</span> <span class="mf">0.4283318817615509</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.18063223361969</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02818222902715206</span><span class="p">,</span>
<a id="__codelineno-36-89" name="__codelineno-36-89"></a><a href="#__codelineno-36-89"><span class="linenos" data-linenos=" 89 "></span></a>              <span class="o">-</span><span class="mf">1.6138978004455566</span><span class="p">,</span> <span class="mf">0.38690251111984253</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.21274028718471527</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8954665660858154</span><span class="p">,</span>
<a id="__codelineno-36-90" name="__codelineno-36-90"></a><a href="#__codelineno-36-90"><span class="linenos" data-linenos=" 90 "></span></a>              <span class="mf">0.7610377073287964</span><span class="p">,</span> <span class="mf">0.3336743414402008</span><span class="p">,</span> <span class="mf">0.12167501449584961</span><span class="p">,</span> <span class="mf">0.44386324286460876</span><span class="p">,</span>
<a id="__codelineno-36-91" name="__codelineno-36-91"></a><a href="#__codelineno-36-91"><span class="linenos" data-linenos=" 91 "></span></a>              <span class="o">-</span><span class="mf">0.10321885347366333</span><span class="p">,</span> <span class="mf">1.4542734622955322</span><span class="p">,</span> <span class="mf">0.4105985164642334</span><span class="p">,</span> <span class="mf">0.14404356479644775</span><span class="p">,</span>
<a id="__codelineno-36-92" name="__codelineno-36-92"></a><a href="#__codelineno-36-92"><span class="linenos" data-linenos=" 92 "></span></a>              <span class="o">-</span><span class="mf">0.8877857327461243</span><span class="p">,</span> <span class="mf">0.15634897351264954</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.980796456336975</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.34791216254234314</span><span class="p">]</span>
<a id="__codelineno-36-93" name="__codelineno-36-93"></a><a href="#__codelineno-36-93"><span class="linenos" data-linenos=" 93 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list_value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-36-94" name="__codelineno-36-94"></a><a href="#__codelineno-36-94"><span class="linenos" data-linenos=" 94 "></span></a><span class="n">tensor</span> <span class="o">=</span> <span class="n">numpy_helper</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sc_Scancst&#39;</span><span class="p">)</span>
<a id="__codelineno-36-95" name="__codelineno-36-95"></a><a href="#__codelineno-36-95"><span class="linenos" data-linenos=" 95 "></span></a><span class="n">initializers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
<a id="__codelineno-36-96" name="__codelineno-36-96"></a><a href="#__codelineno-36-96"><span class="linenos" data-linenos=" 96 "></span></a>
<a id="__codelineno-36-97" name="__codelineno-36-97"></a><a href="#__codelineno-36-97"><span class="linenos" data-linenos=" 97 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-36-98" name="__codelineno-36-98"></a><a href="#__codelineno-36-98"><span class="linenos" data-linenos=" 98 "></span></a><span class="n">tensor</span> <span class="o">=</span> <span class="n">numpy_helper</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;To_TopKcst&#39;</span><span class="p">)</span>
<a id="__codelineno-36-99" name="__codelineno-36-99"></a><a href="#__codelineno-36-99"><span class="linenos" data-linenos=" 99 "></span></a><span class="n">initializers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
<a id="__codelineno-36-100" name="__codelineno-36-100"></a><a href="#__codelineno-36-100"><span class="linenos" data-linenos="100 "></span></a>
<a id="__codelineno-36-101" name="__codelineno-36-101"></a><a href="#__codelineno-36-101"><span class="linenos" data-linenos="101 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-36-102" name="__codelineno-36-102"></a><a href="#__codelineno-36-102"><span class="linenos" data-linenos="102 "></span></a><span class="n">tensor</span> <span class="o">=</span> <span class="n">numpy_helper</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;knny_Reshapecst&#39;</span><span class="p">)</span>
<a id="__codelineno-36-103" name="__codelineno-36-103"></a><a href="#__codelineno-36-103"><span class="linenos" data-linenos="103 "></span></a><span class="n">initializers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
<a id="__codelineno-36-104" name="__codelineno-36-104"></a><a href="#__codelineno-36-104"><span class="linenos" data-linenos="104 "></span></a>
<a id="__codelineno-36-105" name="__codelineno-36-105"></a><a href="#__codelineno-36-105"><span class="linenos" data-linenos="105 "></span></a><span class="c1"># inputs</span>
<a id="__codelineno-36-106" name="__codelineno-36-106"></a><a href="#__codelineno-36-106"><span class="linenos" data-linenos="106 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<a id="__codelineno-36-107" name="__codelineno-36-107"></a><a href="#__codelineno-36-107"><span class="linenos" data-linenos="107 "></span></a><span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-36-108" name="__codelineno-36-108"></a><a href="#__codelineno-36-108"><span class="linenos" data-linenos="108 "></span></a>
<a id="__codelineno-36-109" name="__codelineno-36-109"></a><a href="#__codelineno-36-109"><span class="linenos" data-linenos="109 "></span></a><span class="c1"># outputs</span>
<a id="__codelineno-36-110" name="__codelineno-36-110"></a><a href="#__codelineno-36-110"><span class="linenos" data-linenos="110 "></span></a><span class="n">value</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-36-111" name="__codelineno-36-111"></a><a href="#__codelineno-36-111"><span class="linenos" data-linenos="111 "></span></a><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-36-112" name="__codelineno-36-112"></a><a href="#__codelineno-36-112"><span class="linenos" data-linenos="112 "></span></a>
<a id="__codelineno-36-113" name="__codelineno-36-113"></a><a href="#__codelineno-36-113"><span class="linenos" data-linenos="113 "></span></a><span class="c1"># nodes</span>
<a id="__codelineno-36-114" name="__codelineno-36-114"></a><a href="#__codelineno-36-114"><span class="linenos" data-linenos="114 "></span></a>
<a id="__codelineno-36-115" name="__codelineno-36-115"></a><a href="#__codelineno-36-115"><span class="linenos" data-linenos="115 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-116" name="__codelineno-36-116"></a><a href="#__codelineno-36-116"><span class="linenos" data-linenos="116 "></span></a>    <span class="s1">&#39;Scan&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s1">&#39;Sc_Scancst&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;UU032UU&#39;</span><span class="p">,</span> <span class="s1">&#39;UU033UU&#39;</span><span class="p">],</span>
<a id="__codelineno-36-117" name="__codelineno-36-117"></a><a href="#__codelineno-36-117"><span class="linenos" data-linenos="117 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sc_Scan&#39;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span> <span class="n">num_scan_inputs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-118" name="__codelineno-36-118"></a><a href="#__codelineno-36-118"><span class="linenos" data-linenos="118 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-119" name="__codelineno-36-119"></a><a href="#__codelineno-36-119"><span class="linenos" data-linenos="119 "></span></a>
<a id="__codelineno-36-120" name="__codelineno-36-120"></a><a href="#__codelineno-36-120"><span class="linenos" data-linenos="120 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-121" name="__codelineno-36-121"></a><a href="#__codelineno-36-121"><span class="linenos" data-linenos="121 "></span></a>    <span class="s1">&#39;Transpose&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;UU033UU&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Tr_transposed0&#39;</span><span class="p">],</span>
<a id="__codelineno-36-122" name="__codelineno-36-122"></a><a href="#__codelineno-36-122"><span class="linenos" data-linenos="122 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Tr_Transpose&#39;</span><span class="p">,</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-123" name="__codelineno-36-123"></a><a href="#__codelineno-36-123"><span class="linenos" data-linenos="123 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-124" name="__codelineno-36-124"></a><a href="#__codelineno-36-124"><span class="linenos" data-linenos="124 "></span></a>
<a id="__codelineno-36-125" name="__codelineno-36-125"></a><a href="#__codelineno-36-125"><span class="linenos" data-linenos="125 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-126" name="__codelineno-36-126"></a><a href="#__codelineno-36-126"><span class="linenos" data-linenos="126 "></span></a>    <span class="s1">&#39;Sqrt&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Tr_transposed0&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Sq_Y0&#39;</span><span class="p">],</span>
<a id="__codelineno-36-127" name="__codelineno-36-127"></a><a href="#__codelineno-36-127"><span class="linenos" data-linenos="127 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sq_Sqrt&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-128" name="__codelineno-36-128"></a><a href="#__codelineno-36-128"><span class="linenos" data-linenos="128 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-129" name="__codelineno-36-129"></a><a href="#__codelineno-36-129"><span class="linenos" data-linenos="129 "></span></a>
<a id="__codelineno-36-130" name="__codelineno-36-130"></a><a href="#__codelineno-36-130"><span class="linenos" data-linenos="130 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-131" name="__codelineno-36-131"></a><a href="#__codelineno-36-131"><span class="linenos" data-linenos="131 "></span></a>    <span class="s1">&#39;TopK&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Sq_Y0&#39;</span><span class="p">,</span> <span class="s1">&#39;To_TopKcst&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;To_Values0&#39;</span><span class="p">,</span> <span class="s1">&#39;To_Indices1&#39;</span><span class="p">],</span>
<a id="__codelineno-36-132" name="__codelineno-36-132"></a><a href="#__codelineno-36-132"><span class="linenos" data-linenos="132 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;To_TopK&#39;</span><span class="p">,</span> <span class="n">largest</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">sorted</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-133" name="__codelineno-36-133"></a><a href="#__codelineno-36-133"><span class="linenos" data-linenos="133 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-134" name="__codelineno-36-134"></a><a href="#__codelineno-36-134"><span class="linenos" data-linenos="134 "></span></a>
<a id="__codelineno-36-135" name="__codelineno-36-135"></a><a href="#__codelineno-36-135"><span class="linenos" data-linenos="135 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-136" name="__codelineno-36-136"></a><a href="#__codelineno-36-136"><span class="linenos" data-linenos="136 "></span></a>    <span class="s1">&#39;Flatten&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;To_Indices1&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;knny_output0&#39;</span><span class="p">],</span>
<a id="__codelineno-36-137" name="__codelineno-36-137"></a><a href="#__codelineno-36-137"><span class="linenos" data-linenos="137 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;knny_Flatten&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-138" name="__codelineno-36-138"></a><a href="#__codelineno-36-138"><span class="linenos" data-linenos="138 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-139" name="__codelineno-36-139"></a><a href="#__codelineno-36-139"><span class="linenos" data-linenos="139 "></span></a>
<a id="__codelineno-36-140" name="__codelineno-36-140"></a><a href="#__codelineno-36-140"><span class="linenos" data-linenos="140 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-141" name="__codelineno-36-141"></a><a href="#__codelineno-36-141"><span class="linenos" data-linenos="141 "></span></a>    <span class="s1">&#39;ArrayFeatureExtractor&#39;</span><span class="p">,</span>
<a id="__codelineno-36-142" name="__codelineno-36-142"></a><a href="#__codelineno-36-142"><span class="linenos" data-linenos="142 "></span></a>    <span class="p">[</span><span class="s1">&#39;knny_ArrayFeatureExtractorcst&#39;</span><span class="p">,</span> <span class="s1">&#39;knny_output0&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;knny_Z0&#39;</span><span class="p">],</span>
<a id="__codelineno-36-143" name="__codelineno-36-143"></a><a href="#__codelineno-36-143"><span class="linenos" data-linenos="143 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;knny_ArrayFeatureExtractor&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;ai.onnx.ml&#39;</span><span class="p">)</span>
<a id="__codelineno-36-144" name="__codelineno-36-144"></a><a href="#__codelineno-36-144"><span class="linenos" data-linenos="144 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-145" name="__codelineno-36-145"></a><a href="#__codelineno-36-145"><span class="linenos" data-linenos="145 "></span></a>
<a id="__codelineno-36-146" name="__codelineno-36-146"></a><a href="#__codelineno-36-146"><span class="linenos" data-linenos="146 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-147" name="__codelineno-36-147"></a><a href="#__codelineno-36-147"><span class="linenos" data-linenos="147 "></span></a>    <span class="s1">&#39;Reshape&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;knny_Z0&#39;</span><span class="p">,</span> <span class="s1">&#39;knny_Reshapecst&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;knny_reshaped0&#39;</span><span class="p">],</span>
<a id="__codelineno-36-148" name="__codelineno-36-148"></a><a href="#__codelineno-36-148"><span class="linenos" data-linenos="148 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;knny_Reshape&#39;</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-149" name="__codelineno-36-149"></a><a href="#__codelineno-36-149"><span class="linenos" data-linenos="149 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-150" name="__codelineno-36-150"></a><a href="#__codelineno-36-150"><span class="linenos" data-linenos="150 "></span></a>
<a id="__codelineno-36-151" name="__codelineno-36-151"></a><a href="#__codelineno-36-151"><span class="linenos" data-linenos="151 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-152" name="__codelineno-36-152"></a><a href="#__codelineno-36-152"><span class="linenos" data-linenos="152 "></span></a>    <span class="s1">&#39;Transpose&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;knny_reshaped0&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;knny_transposed0&#39;</span><span class="p">],</span>
<a id="__codelineno-36-153" name="__codelineno-36-153"></a><a href="#__codelineno-36-153"><span class="linenos" data-linenos="153 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;knny_Transpose&#39;</span><span class="p">,</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-154" name="__codelineno-36-154"></a><a href="#__codelineno-36-154"><span class="linenos" data-linenos="154 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-155" name="__codelineno-36-155"></a><a href="#__codelineno-36-155"><span class="linenos" data-linenos="155 "></span></a>
<a id="__codelineno-36-156" name="__codelineno-36-156"></a><a href="#__codelineno-36-156"><span class="linenos" data-linenos="156 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-157" name="__codelineno-36-157"></a><a href="#__codelineno-36-157"><span class="linenos" data-linenos="157 "></span></a>    <span class="s1">&#39;Cast&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;knny_transposed0&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Ca_output0&#39;</span><span class="p">],</span>
<a id="__codelineno-36-158" name="__codelineno-36-158"></a><a href="#__codelineno-36-158"><span class="linenos" data-linenos="158 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ca_Cast&#39;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-159" name="__codelineno-36-159"></a><a href="#__codelineno-36-159"><span class="linenos" data-linenos="159 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-160" name="__codelineno-36-160"></a><a href="#__codelineno-36-160"><span class="linenos" data-linenos="160 "></span></a>
<a id="__codelineno-36-161" name="__codelineno-36-161"></a><a href="#__codelineno-36-161"><span class="linenos" data-linenos="161 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-36-162" name="__codelineno-36-162"></a><a href="#__codelineno-36-162"><span class="linenos" data-linenos="162 "></span></a>    <span class="s1">&#39;ReduceMean&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Ca_output0&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">],</span>
<a id="__codelineno-36-163" name="__codelineno-36-163"></a><a href="#__codelineno-36-163"><span class="linenos" data-linenos="163 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Re_ReduceMean&#39;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-36-164" name="__codelineno-36-164"></a><a href="#__codelineno-36-164"><span class="linenos" data-linenos="164 "></span></a><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-36-165" name="__codelineno-36-165"></a><a href="#__codelineno-36-165"><span class="linenos" data-linenos="165 "></span></a>
<a id="__codelineno-36-166" name="__codelineno-36-166"></a><a href="#__codelineno-36-166"><span class="linenos" data-linenos="166 "></span></a><span class="c1"># graph</span>
<a id="__codelineno-36-167" name="__codelineno-36-167"></a><a href="#__codelineno-36-167"><span class="linenos" data-linenos="167 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="s1">&#39;KNN regressor&#39;</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">initializers</span><span class="p">)</span>
<a id="__codelineno-36-168" name="__codelineno-36-168"></a><a href="#__codelineno-36-168"><span class="linenos" data-linenos="168 "></span></a>
<a id="__codelineno-36-169" name="__codelineno-36-169"></a><a href="#__codelineno-36-169"><span class="linenos" data-linenos="169 "></span></a><span class="c1"># model</span>
<a id="__codelineno-36-170" name="__codelineno-36-170"></a><a href="#__codelineno-36-170"><span class="linenos" data-linenos="170 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a id="__codelineno-36-171" name="__codelineno-36-171"></a><a href="#__codelineno-36-171"><span class="linenos" data-linenos="171 "></span></a><span class="n">onnx_model</span><span class="o">.</span><span class="n">ir_version</span> <span class="o">=</span> <span class="mi">8</span>
<a id="__codelineno-36-172" name="__codelineno-36-172"></a><a href="#__codelineno-36-172"><span class="linenos" data-linenos="172 "></span></a><span class="n">onnx_model</span><span class="o">.</span><span class="n">producer_name</span> <span class="o">=</span> <span class="s1">&#39;skl2onnx&#39;</span>
<a id="__codelineno-36-173" name="__codelineno-36-173"></a><a href="#__codelineno-36-173"><span class="linenos" data-linenos="173 "></span></a><span class="n">onnx_model</span><span class="o">.</span><span class="n">producer_version</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a id="__codelineno-36-174" name="__codelineno-36-174"></a><a href="#__codelineno-36-174"><span class="linenos" data-linenos="174 "></span></a><span class="n">onnx_model</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s1">&#39;ai.onnx&#39;</span>
<a id="__codelineno-36-175" name="__codelineno-36-175"></a><a href="#__codelineno-36-175"><span class="linenos" data-linenos="175 "></span></a><span class="n">onnx_model</span><span class="o">.</span><span class="n">model_version</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-36-176" name="__codelineno-36-176"></a><a href="#__codelineno-36-176"><span class="linenos" data-linenos="176 "></span></a><span class="n">onnx_model</span><span class="o">.</span><span class="n">doc_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a id="__codelineno-36-177" name="__codelineno-36-177"></a><a href="#__codelineno-36-177"><span class="linenos" data-linenos="177 "></span></a><span class="n">set_model_props</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-36-178" name="__codelineno-36-178"></a><a href="#__codelineno-36-178"><span class="linenos" data-linenos="178 "></span></a>
<a id="__codelineno-36-179" name="__codelineno-36-179"></a><a href="#__codelineno-36-179"><span class="linenos" data-linenos="179 "></span></a><span class="c1"># opsets</span>
<a id="__codelineno-36-180" name="__codelineno-36-180"></a><a href="#__codelineno-36-180"><span class="linenos" data-linenos="180 "></span></a><span class="k">del</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">opset_import</span><span class="p">[:]</span>
<a id="__codelineno-36-181" name="__codelineno-36-181"></a><a href="#__codelineno-36-181"><span class="linenos" data-linenos="181 "></span></a><span class="k">for</span> <span class="n">dom</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">opsets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-36-182" name="__codelineno-36-182"></a><a href="#__codelineno-36-182"><span class="linenos" data-linenos="182 "></span></a>    <span class="n">op_set</span> <span class="o">=</span> <span class="n">onnx_model</span><span class="o">.</span><span class="n">opset_import</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
<a id="__codelineno-36-183" name="__codelineno-36-183"></a><a href="#__codelineno-36-183"><span class="linenos" data-linenos="183 "></span></a>    <span class="n">op_set</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">dom</span>
<a id="__codelineno-36-184" name="__codelineno-36-184"></a><a href="#__codelineno-36-184"><span class="linenos" data-linenos="184 "></span></a>    <span class="n">op_set</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-36-185" name="__codelineno-36-185"></a><a href="#__codelineno-36-185"><span class="linenos" data-linenos="185 "></span></a>
<a id="__codelineno-36-186" name="__codelineno-36-186"></a><a href="#__codelineno-36-186"><span class="linenos" data-linenos="186 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-36-187" name="__codelineno-36-187"></a><a href="#__codelineno-36-187"><span class="linenos" data-linenos="187 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;knnr.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-36-188" name="__codelineno-36-188"></a><a href="#__codelineno-36-188"><span class="linenos" data-linenos="188 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<a id="__codelineno-36-189" name="__codelineno-36-189"></a><a href="#__codelineno-36-189"><span class="linenos" data-linenos="189 "></span></a>
<a id="__codelineno-36-190" name="__codelineno-36-190"></a><a href="#__codelineno-36-190"><span class="linenos" data-linenos="190 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
</code></pre></div>
</details>

<details>
  <summary>  有扫描算子的计算图: json 格式 </summary>

<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><a href="#__codelineno-37-1"><span class="linenos" data-linenos="  1 "></span></a>ir_version: 8
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><a href="#__codelineno-37-2"><span class="linenos" data-linenos="  2 "></span></a>producer_name: &quot;skl2onnx&quot;
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><a href="#__codelineno-37-3"><span class="linenos" data-linenos="  3 "></span></a>producer_version: &quot;&quot;
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><a href="#__codelineno-37-4"><span class="linenos" data-linenos="  4 "></span></a>domain: &quot;ai.onnx&quot;
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><a href="#__codelineno-37-5"><span class="linenos" data-linenos="  5 "></span></a>model_version: 0
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><a href="#__codelineno-37-6"><span class="linenos" data-linenos="  6 "></span></a>doc_string: &quot;&quot;
<a id="__codelineno-37-7" name="__codelineno-37-7"></a><a href="#__codelineno-37-7"><span class="linenos" data-linenos="  7 "></span></a>graph {
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><a href="#__codelineno-37-8"><span class="linenos" data-linenos="  8 "></span></a>  node {
<a id="__codelineno-37-9" name="__codelineno-37-9"></a><a href="#__codelineno-37-9"><span class="linenos" data-linenos="  9 "></span></a>    input: &quot;input&quot;
<a id="__codelineno-37-10" name="__codelineno-37-10"></a><a href="#__codelineno-37-10"><span class="linenos" data-linenos=" 10 "></span></a>    input: &quot;Sc_Scancst&quot;
<a id="__codelineno-37-11" name="__codelineno-37-11"></a><a href="#__codelineno-37-11"><span class="linenos" data-linenos=" 11 "></span></a>    output: &quot;UU032UU&quot;
<a id="__codelineno-37-12" name="__codelineno-37-12"></a><a href="#__codelineno-37-12"><span class="linenos" data-linenos=" 12 "></span></a>    output: &quot;UU033UU&quot;
<a id="__codelineno-37-13" name="__codelineno-37-13"></a><a href="#__codelineno-37-13"><span class="linenos" data-linenos=" 13 "></span></a>    name: &quot;Sc_Scan&quot;
<a id="__codelineno-37-14" name="__codelineno-37-14"></a><a href="#__codelineno-37-14"><span class="linenos" data-linenos=" 14 "></span></a>    op_type: &quot;Scan&quot;
<a id="__codelineno-37-15" name="__codelineno-37-15"></a><a href="#__codelineno-37-15"><span class="linenos" data-linenos=" 15 "></span></a>    attribute {
<a id="__codelineno-37-16" name="__codelineno-37-16"></a><a href="#__codelineno-37-16"><span class="linenos" data-linenos=" 16 "></span></a>      name: &quot;body&quot;
<a id="__codelineno-37-17" name="__codelineno-37-17"></a><a href="#__codelineno-37-17"><span class="linenos" data-linenos=" 17 "></span></a>      g {
<a id="__codelineno-37-18" name="__codelineno-37-18"></a><a href="#__codelineno-37-18"><span class="linenos" data-linenos=" 18 "></span></a>        node {
<a id="__codelineno-37-19" name="__codelineno-37-19"></a><a href="#__codelineno-37-19"><span class="linenos" data-linenos=" 19 "></span></a>          input: &quot;next_in&quot;
<a id="__codelineno-37-20" name="__codelineno-37-20"></a><a href="#__codelineno-37-20"><span class="linenos" data-linenos=" 20 "></span></a>          output: &quot;next_out&quot;
<a id="__codelineno-37-21" name="__codelineno-37-21"></a><a href="#__codelineno-37-21"><span class="linenos" data-linenos=" 21 "></span></a>          name: &quot;cdistd_17_Identity&quot;
<a id="__codelineno-37-22" name="__codelineno-37-22"></a><a href="#__codelineno-37-22"><span class="linenos" data-linenos=" 22 "></span></a>          op_type: &quot;Identity&quot;
<a id="__codelineno-37-23" name="__codelineno-37-23"></a><a href="#__codelineno-37-23"><span class="linenos" data-linenos=" 23 "></span></a>          domain: &quot;&quot;
<a id="__codelineno-37-24" name="__codelineno-37-24"></a><a href="#__codelineno-37-24"><span class="linenos" data-linenos=" 24 "></span></a>        }
<a id="__codelineno-37-25" name="__codelineno-37-25"></a><a href="#__codelineno-37-25"><span class="linenos" data-linenos=" 25 "></span></a>        node {
<a id="__codelineno-37-26" name="__codelineno-37-26"></a><a href="#__codelineno-37-26"><span class="linenos" data-linenos=" 26 "></span></a>          input: &quot;next_in&quot;
<a id="__codelineno-37-27" name="__codelineno-37-27"></a><a href="#__codelineno-37-27"><span class="linenos" data-linenos=" 27 "></span></a>          input: &quot;next&quot;
<a id="__codelineno-37-28" name="__codelineno-37-28"></a><a href="#__codelineno-37-28"><span class="linenos" data-linenos=" 28 "></span></a>          output: &quot;cdistdf_17_C0&quot;
<a id="__codelineno-37-29" name="__codelineno-37-29"></a><a href="#__codelineno-37-29"><span class="linenos" data-linenos=" 29 "></span></a>          name: &quot;cdistdf_17_Sub&quot;
<a id="__codelineno-37-30" name="__codelineno-37-30"></a><a href="#__codelineno-37-30"><span class="linenos" data-linenos=" 30 "></span></a>          op_type: &quot;Sub&quot;
<a id="__codelineno-37-31" name="__codelineno-37-31"></a><a href="#__codelineno-37-31"><span class="linenos" data-linenos=" 31 "></span></a>          domain: &quot;&quot;
<a id="__codelineno-37-32" name="__codelineno-37-32"></a><a href="#__codelineno-37-32"><span class="linenos" data-linenos=" 32 "></span></a>        }
<a id="__codelineno-37-33" name="__codelineno-37-33"></a><a href="#__codelineno-37-33"><span class="linenos" data-linenos=" 33 "></span></a>        node {
<a id="__codelineno-37-34" name="__codelineno-37-34"></a><a href="#__codelineno-37-34"><span class="linenos" data-linenos=" 34 "></span></a>          input: &quot;cdistdf_17_C0&quot;
<a id="__codelineno-37-35" name="__codelineno-37-35"></a><a href="#__codelineno-37-35"><span class="linenos" data-linenos=" 35 "></span></a>          output: &quot;cdistdf_17_reduced0&quot;
<a id="__codelineno-37-36" name="__codelineno-37-36"></a><a href="#__codelineno-37-36"><span class="linenos" data-linenos=" 36 "></span></a>          name: &quot;cdistdf_17_ReduceSumSquare&quot;
<a id="__codelineno-37-37" name="__codelineno-37-37"></a><a href="#__codelineno-37-37"><span class="linenos" data-linenos=" 37 "></span></a>          op_type: &quot;ReduceSumSquare&quot;
<a id="__codelineno-37-38" name="__codelineno-37-38"></a><a href="#__codelineno-37-38"><span class="linenos" data-linenos=" 38 "></span></a>          attribute {
<a id="__codelineno-37-39" name="__codelineno-37-39"></a><a href="#__codelineno-37-39"><span class="linenos" data-linenos=" 39 "></span></a>            name: &quot;axes&quot;
<a id="__codelineno-37-40" name="__codelineno-37-40"></a><a href="#__codelineno-37-40"><span class="linenos" data-linenos=" 40 "></span></a>            ints: 1
<a id="__codelineno-37-41" name="__codelineno-37-41"></a><a href="#__codelineno-37-41"><span class="linenos" data-linenos=" 41 "></span></a>            type: INTS
<a id="__codelineno-37-42" name="__codelineno-37-42"></a><a href="#__codelineno-37-42"><span class="linenos" data-linenos=" 42 "></span></a>          }
<a id="__codelineno-37-43" name="__codelineno-37-43"></a><a href="#__codelineno-37-43"><span class="linenos" data-linenos=" 43 "></span></a>          attribute {
<a id="__codelineno-37-44" name="__codelineno-37-44"></a><a href="#__codelineno-37-44"><span class="linenos" data-linenos=" 44 "></span></a>            name: &quot;keepdims&quot;
<a id="__codelineno-37-45" name="__codelineno-37-45"></a><a href="#__codelineno-37-45"><span class="linenos" data-linenos=" 45 "></span></a>            i: 0
<a id="__codelineno-37-46" name="__codelineno-37-46"></a><a href="#__codelineno-37-46"><span class="linenos" data-linenos=" 46 "></span></a>            type: INT
<a id="__codelineno-37-47" name="__codelineno-37-47"></a><a href="#__codelineno-37-47"><span class="linenos" data-linenos=" 47 "></span></a>          }
<a id="__codelineno-37-48" name="__codelineno-37-48"></a><a href="#__codelineno-37-48"><span class="linenos" data-linenos=" 48 "></span></a>          domain: &quot;&quot;
<a id="__codelineno-37-49" name="__codelineno-37-49"></a><a href="#__codelineno-37-49"><span class="linenos" data-linenos=" 49 "></span></a>        }
<a id="__codelineno-37-50" name="__codelineno-37-50"></a><a href="#__codelineno-37-50"><span class="linenos" data-linenos=" 50 "></span></a>        node {
<a id="__codelineno-37-51" name="__codelineno-37-51"></a><a href="#__codelineno-37-51"><span class="linenos" data-linenos=" 51 "></span></a>          input: &quot;cdistdf_17_reduced0&quot;
<a id="__codelineno-37-52" name="__codelineno-37-52"></a><a href="#__codelineno-37-52"><span class="linenos" data-linenos=" 52 "></span></a>          output: &quot;scan_out&quot;
<a id="__codelineno-37-53" name="__codelineno-37-53"></a><a href="#__codelineno-37-53"><span class="linenos" data-linenos=" 53 "></span></a>          name: &quot;cdistdf_17_Identity&quot;
<a id="__codelineno-37-54" name="__codelineno-37-54"></a><a href="#__codelineno-37-54"><span class="linenos" data-linenos=" 54 "></span></a>          op_type: &quot;Identity&quot;
<a id="__codelineno-37-55" name="__codelineno-37-55"></a><a href="#__codelineno-37-55"><span class="linenos" data-linenos=" 55 "></span></a>          domain: &quot;&quot;
<a id="__codelineno-37-56" name="__codelineno-37-56"></a><a href="#__codelineno-37-56"><span class="linenos" data-linenos=" 56 "></span></a>        }
<a id="__codelineno-37-57" name="__codelineno-37-57"></a><a href="#__codelineno-37-57"><span class="linenos" data-linenos=" 57 "></span></a>        name: &quot;OnnxIdentity&quot;
<a id="__codelineno-37-58" name="__codelineno-37-58"></a><a href="#__codelineno-37-58"><span class="linenos" data-linenos=" 58 "></span></a>        input {
<a id="__codelineno-37-59" name="__codelineno-37-59"></a><a href="#__codelineno-37-59"><span class="linenos" data-linenos=" 59 "></span></a>          name: &quot;next_in&quot;
<a id="__codelineno-37-60" name="__codelineno-37-60"></a><a href="#__codelineno-37-60"><span class="linenos" data-linenos=" 60 "></span></a>          type {
<a id="__codelineno-37-61" name="__codelineno-37-61"></a><a href="#__codelineno-37-61"><span class="linenos" data-linenos=" 61 "></span></a>            tensor_type {
<a id="__codelineno-37-62" name="__codelineno-37-62"></a><a href="#__codelineno-37-62"><span class="linenos" data-linenos=" 62 "></span></a>              elem_type: 1
<a id="__codelineno-37-63" name="__codelineno-37-63"></a><a href="#__codelineno-37-63"><span class="linenos" data-linenos=" 63 "></span></a>              shape {
<a id="__codelineno-37-64" name="__codelineno-37-64"></a><a href="#__codelineno-37-64"><span class="linenos" data-linenos=" 64 "></span></a>                dim {
<a id="__codelineno-37-65" name="__codelineno-37-65"></a><a href="#__codelineno-37-65"><span class="linenos" data-linenos=" 65 "></span></a>                }
<a id="__codelineno-37-66" name="__codelineno-37-66"></a><a href="#__codelineno-37-66"><span class="linenos" data-linenos=" 66 "></span></a>                dim {
<a id="__codelineno-37-67" name="__codelineno-37-67"></a><a href="#__codelineno-37-67"><span class="linenos" data-linenos=" 67 "></span></a>                  dim_value: 4
<a id="__codelineno-37-68" name="__codelineno-37-68"></a><a href="#__codelineno-37-68"><span class="linenos" data-linenos=" 68 "></span></a>                }
<a id="__codelineno-37-69" name="__codelineno-37-69"></a><a href="#__codelineno-37-69"><span class="linenos" data-linenos=" 69 "></span></a>              }
<a id="__codelineno-37-70" name="__codelineno-37-70"></a><a href="#__codelineno-37-70"><span class="linenos" data-linenos=" 70 "></span></a>            }
<a id="__codelineno-37-71" name="__codelineno-37-71"></a><a href="#__codelineno-37-71"><span class="linenos" data-linenos=" 71 "></span></a>          }
<a id="__codelineno-37-72" name="__codelineno-37-72"></a><a href="#__codelineno-37-72"><span class="linenos" data-linenos=" 72 "></span></a>        }
<a id="__codelineno-37-73" name="__codelineno-37-73"></a><a href="#__codelineno-37-73"><span class="linenos" data-linenos=" 73 "></span></a>        input {
<a id="__codelineno-37-74" name="__codelineno-37-74"></a><a href="#__codelineno-37-74"><span class="linenos" data-linenos=" 74 "></span></a>          name: &quot;next&quot;
<a id="__codelineno-37-75" name="__codelineno-37-75"></a><a href="#__codelineno-37-75"><span class="linenos" data-linenos=" 75 "></span></a>          type {
<a id="__codelineno-37-76" name="__codelineno-37-76"></a><a href="#__codelineno-37-76"><span class="linenos" data-linenos=" 76 "></span></a>            tensor_type {
<a id="__codelineno-37-77" name="__codelineno-37-77"></a><a href="#__codelineno-37-77"><span class="linenos" data-linenos=" 77 "></span></a>              elem_type: 1
<a id="__codelineno-37-78" name="__codelineno-37-78"></a><a href="#__codelineno-37-78"><span class="linenos" data-linenos=" 78 "></span></a>              shape {
<a id="__codelineno-37-79" name="__codelineno-37-79"></a><a href="#__codelineno-37-79"><span class="linenos" data-linenos=" 79 "></span></a>                dim {
<a id="__codelineno-37-80" name="__codelineno-37-80"></a><a href="#__codelineno-37-80"><span class="linenos" data-linenos=" 80 "></span></a>                }
<a id="__codelineno-37-81" name="__codelineno-37-81"></a><a href="#__codelineno-37-81"><span class="linenos" data-linenos=" 81 "></span></a>              }
<a id="__codelineno-37-82" name="__codelineno-37-82"></a><a href="#__codelineno-37-82"><span class="linenos" data-linenos=" 82 "></span></a>            }
<a id="__codelineno-37-83" name="__codelineno-37-83"></a><a href="#__codelineno-37-83"><span class="linenos" data-linenos=" 83 "></span></a>          }
<a id="__codelineno-37-84" name="__codelineno-37-84"></a><a href="#__codelineno-37-84"><span class="linenos" data-linenos=" 84 "></span></a>        }
<a id="__codelineno-37-85" name="__codelineno-37-85"></a><a href="#__codelineno-37-85"><span class="linenos" data-linenos=" 85 "></span></a>        output {
<a id="__codelineno-37-86" name="__codelineno-37-86"></a><a href="#__codelineno-37-86"><span class="linenos" data-linenos=" 86 "></span></a>          name: &quot;next_out&quot;
<a id="__codelineno-37-87" name="__codelineno-37-87"></a><a href="#__codelineno-37-87"><span class="linenos" data-linenos=" 87 "></span></a>          type {
<a id="__codelineno-37-88" name="__codelineno-37-88"></a><a href="#__codelineno-37-88"><span class="linenos" data-linenos=" 88 "></span></a>            tensor_type {
<a id="__codelineno-37-89" name="__codelineno-37-89"></a><a href="#__codelineno-37-89"><span class="linenos" data-linenos=" 89 "></span></a>              elem_type: 1
<a id="__codelineno-37-90" name="__codelineno-37-90"></a><a href="#__codelineno-37-90"><span class="linenos" data-linenos=" 90 "></span></a>              shape {
<a id="__codelineno-37-91" name="__codelineno-37-91"></a><a href="#__codelineno-37-91"><span class="linenos" data-linenos=" 91 "></span></a>                dim {
<a id="__codelineno-37-92" name="__codelineno-37-92"></a><a href="#__codelineno-37-92"><span class="linenos" data-linenos=" 92 "></span></a>                }
<a id="__codelineno-37-93" name="__codelineno-37-93"></a><a href="#__codelineno-37-93"><span class="linenos" data-linenos=" 93 "></span></a>                dim {
<a id="__codelineno-37-94" name="__codelineno-37-94"></a><a href="#__codelineno-37-94"><span class="linenos" data-linenos=" 94 "></span></a>                }
<a id="__codelineno-37-95" name="__codelineno-37-95"></a><a href="#__codelineno-37-95"><span class="linenos" data-linenos=" 95 "></span></a>              }
<a id="__codelineno-37-96" name="__codelineno-37-96"></a><a href="#__codelineno-37-96"><span class="linenos" data-linenos=" 96 "></span></a>            }
<a id="__codelineno-37-97" name="__codelineno-37-97"></a><a href="#__codelineno-37-97"><span class="linenos" data-linenos=" 97 "></span></a>          }
<a id="__codelineno-37-98" name="__codelineno-37-98"></a><a href="#__codelineno-37-98"><span class="linenos" data-linenos=" 98 "></span></a>        }
<a id="__codelineno-37-99" name="__codelineno-37-99"></a><a href="#__codelineno-37-99"><span class="linenos" data-linenos=" 99 "></span></a>        output {
<a id="__codelineno-37-100" name="__codelineno-37-100"></a><a href="#__codelineno-37-100"><span class="linenos" data-linenos="100 "></span></a>          name: &quot;scan_out&quot;
<a id="__codelineno-37-101" name="__codelineno-37-101"></a><a href="#__codelineno-37-101"><span class="linenos" data-linenos="101 "></span></a>          type {
<a id="__codelineno-37-102" name="__codelineno-37-102"></a><a href="#__codelineno-37-102"><span class="linenos" data-linenos="102 "></span></a>            tensor_type {
<a id="__codelineno-37-103" name="__codelineno-37-103"></a><a href="#__codelineno-37-103"><span class="linenos" data-linenos="103 "></span></a>              elem_type: 1
<a id="__codelineno-37-104" name="__codelineno-37-104"></a><a href="#__codelineno-37-104"><span class="linenos" data-linenos="104 "></span></a>              shape {
<a id="__codelineno-37-105" name="__codelineno-37-105"></a><a href="#__codelineno-37-105"><span class="linenos" data-linenos="105 "></span></a>                dim {
<a id="__codelineno-37-106" name="__codelineno-37-106"></a><a href="#__codelineno-37-106"><span class="linenos" data-linenos="106 "></span></a>                }
<a id="__codelineno-37-107" name="__codelineno-37-107"></a><a href="#__codelineno-37-107"><span class="linenos" data-linenos="107 "></span></a>              }
<a id="__codelineno-37-108" name="__codelineno-37-108"></a><a href="#__codelineno-37-108"><span class="linenos" data-linenos="108 "></span></a>            }
<a id="__codelineno-37-109" name="__codelineno-37-109"></a><a href="#__codelineno-37-109"><span class="linenos" data-linenos="109 "></span></a>          }
<a id="__codelineno-37-110" name="__codelineno-37-110"></a><a href="#__codelineno-37-110"><span class="linenos" data-linenos="110 "></span></a>        }
<a id="__codelineno-37-111" name="__codelineno-37-111"></a><a href="#__codelineno-37-111"><span class="linenos" data-linenos="111 "></span></a>      }
<a id="__codelineno-37-112" name="__codelineno-37-112"></a><a href="#__codelineno-37-112"><span class="linenos" data-linenos="112 "></span></a>      type: GRAPH
<a id="__codelineno-37-113" name="__codelineno-37-113"></a><a href="#__codelineno-37-113"><span class="linenos" data-linenos="113 "></span></a>    }
<a id="__codelineno-37-114" name="__codelineno-37-114"></a><a href="#__codelineno-37-114"><span class="linenos" data-linenos="114 "></span></a>    attribute {
<a id="__codelineno-37-115" name="__codelineno-37-115"></a><a href="#__codelineno-37-115"><span class="linenos" data-linenos="115 "></span></a>      name: &quot;num_scan_inputs&quot;
<a id="__codelineno-37-116" name="__codelineno-37-116"></a><a href="#__codelineno-37-116"><span class="linenos" data-linenos="116 "></span></a>      i: 1
<a id="__codelineno-37-117" name="__codelineno-37-117"></a><a href="#__codelineno-37-117"><span class="linenos" data-linenos="117 "></span></a>      type: INT
<a id="__codelineno-37-118" name="__codelineno-37-118"></a><a href="#__codelineno-37-118"><span class="linenos" data-linenos="118 "></span></a>    }
<a id="__codelineno-37-119" name="__codelineno-37-119"></a><a href="#__codelineno-37-119"><span class="linenos" data-linenos="119 "></span></a>    domain: &quot;&quot;
<a id="__codelineno-37-120" name="__codelineno-37-120"></a><a href="#__codelineno-37-120"><span class="linenos" data-linenos="120 "></span></a>  }
<a id="__codelineno-37-121" name="__codelineno-37-121"></a><a href="#__codelineno-37-121"><span class="linenos" data-linenos="121 "></span></a>  node {
<a id="__codelineno-37-122" name="__codelineno-37-122"></a><a href="#__codelineno-37-122"><span class="linenos" data-linenos="122 "></span></a>    input: &quot;UU033UU&quot;
<a id="__codelineno-37-123" name="__codelineno-37-123"></a><a href="#__codelineno-37-123"><span class="linenos" data-linenos="123 "></span></a>    output: &quot;Tr_transposed0&quot;
<a id="__codelineno-37-124" name="__codelineno-37-124"></a><a href="#__codelineno-37-124"><span class="linenos" data-linenos="124 "></span></a>    name: &quot;Tr_Transpose&quot;
<a id="__codelineno-37-125" name="__codelineno-37-125"></a><a href="#__codelineno-37-125"><span class="linenos" data-linenos="125 "></span></a>    op_type: &quot;Transpose&quot;
<a id="__codelineno-37-126" name="__codelineno-37-126"></a><a href="#__codelineno-37-126"><span class="linenos" data-linenos="126 "></span></a>    attribute {
<a id="__codelineno-37-127" name="__codelineno-37-127"></a><a href="#__codelineno-37-127"><span class="linenos" data-linenos="127 "></span></a>      name: &quot;perm&quot;
<a id="__codelineno-37-128" name="__codelineno-37-128"></a><a href="#__codelineno-37-128"><span class="linenos" data-linenos="128 "></span></a>      ints: 1
<a id="__codelineno-37-129" name="__codelineno-37-129"></a><a href="#__codelineno-37-129"><span class="linenos" data-linenos="129 "></span></a>      ints: 0
<a id="__codelineno-37-130" name="__codelineno-37-130"></a><a href="#__codelineno-37-130"><span class="linenos" data-linenos="130 "></span></a>      type: INTS
<a id="__codelineno-37-131" name="__codelineno-37-131"></a><a href="#__codelineno-37-131"><span class="linenos" data-linenos="131 "></span></a>    }
<a id="__codelineno-37-132" name="__codelineno-37-132"></a><a href="#__codelineno-37-132"><span class="linenos" data-linenos="132 "></span></a>    domain: &quot;&quot;
<a id="__codelineno-37-133" name="__codelineno-37-133"></a><a href="#__codelineno-37-133"><span class="linenos" data-linenos="133 "></span></a>  }
<a id="__codelineno-37-134" name="__codelineno-37-134"></a><a href="#__codelineno-37-134"><span class="linenos" data-linenos="134 "></span></a>  node {
<a id="__codelineno-37-135" name="__codelineno-37-135"></a><a href="#__codelineno-37-135"><span class="linenos" data-linenos="135 "></span></a>    input: &quot;Tr_transposed0&quot;
<a id="__codelineno-37-136" name="__codelineno-37-136"></a><a href="#__codelineno-37-136"><span class="linenos" data-linenos="136 "></span></a>    output: &quot;Sq_Y0&quot;
<a id="__codelineno-37-137" name="__codelineno-37-137"></a><a href="#__codelineno-37-137"><span class="linenos" data-linenos="137 "></span></a>    name: &quot;Sq_Sqrt&quot;
<a id="__codelineno-37-138" name="__codelineno-37-138"></a><a href="#__codelineno-37-138"><span class="linenos" data-linenos="138 "></span></a>    op_type: &quot;Sqrt&quot;
<a id="__codelineno-37-139" name="__codelineno-37-139"></a><a href="#__codelineno-37-139"><span class="linenos" data-linenos="139 "></span></a>    domain: &quot;&quot;
<a id="__codelineno-37-140" name="__codelineno-37-140"></a><a href="#__codelineno-37-140"><span class="linenos" data-linenos="140 "></span></a>  }
<a id="__codelineno-37-141" name="__codelineno-37-141"></a><a href="#__codelineno-37-141"><span class="linenos" data-linenos="141 "></span></a>  node {
<a id="__codelineno-37-142" name="__codelineno-37-142"></a><a href="#__codelineno-37-142"><span class="linenos" data-linenos="142 "></span></a>    input: &quot;Sq_Y0&quot;
<a id="__codelineno-37-143" name="__codelineno-37-143"></a><a href="#__codelineno-37-143"><span class="linenos" data-linenos="143 "></span></a>    input: &quot;To_TopKcst&quot;
<a id="__codelineno-37-144" name="__codelineno-37-144"></a><a href="#__codelineno-37-144"><span class="linenos" data-linenos="144 "></span></a>    output: &quot;To_Values0&quot;
<a id="__codelineno-37-145" name="__codelineno-37-145"></a><a href="#__codelineno-37-145"><span class="linenos" data-linenos="145 "></span></a>    output: &quot;To_Indices1&quot;
<a id="__codelineno-37-146" name="__codelineno-37-146"></a><a href="#__codelineno-37-146"><span class="linenos" data-linenos="146 "></span></a>    name: &quot;To_TopK&quot;
<a id="__codelineno-37-147" name="__codelineno-37-147"></a><a href="#__codelineno-37-147"><span class="linenos" data-linenos="147 "></span></a>    op_type: &quot;TopK&quot;
<a id="__codelineno-37-148" name="__codelineno-37-148"></a><a href="#__codelineno-37-148"><span class="linenos" data-linenos="148 "></span></a>    attribute {
<a id="__codelineno-37-149" name="__codelineno-37-149"></a><a href="#__codelineno-37-149"><span class="linenos" data-linenos="149 "></span></a>      name: &quot;largest&quot;
<a id="__codelineno-37-150" name="__codelineno-37-150"></a><a href="#__codelineno-37-150"><span class="linenos" data-linenos="150 "></span></a>      i: 0
<a id="__codelineno-37-151" name="__codelineno-37-151"></a><a href="#__codelineno-37-151"><span class="linenos" data-linenos="151 "></span></a>      type: INT
<a id="__codelineno-37-152" name="__codelineno-37-152"></a><a href="#__codelineno-37-152"><span class="linenos" data-linenos="152 "></span></a>    }
<a id="__codelineno-37-153" name="__codelineno-37-153"></a><a href="#__codelineno-37-153"><span class="linenos" data-linenos="153 "></span></a>    attribute {
<a id="__codelineno-37-154" name="__codelineno-37-154"></a><a href="#__codelineno-37-154"><span class="linenos" data-linenos="154 "></span></a>      name: &quot;sorted&quot;
<a id="__codelineno-37-155" name="__codelineno-37-155"></a><a href="#__codelineno-37-155"><span class="linenos" data-linenos="155 "></span></a>      i: 1
<a id="__codelineno-37-156" name="__codelineno-37-156"></a><a href="#__codelineno-37-156"><span class="linenos" data-linenos="156 "></span></a>      type: INT
<a id="__codelineno-37-157" name="__codelineno-37-157"></a><a href="#__codelineno-37-157"><span class="linenos" data-linenos="157 "></span></a>    }
<a id="__codelineno-37-158" name="__codelineno-37-158"></a><a href="#__codelineno-37-158"><span class="linenos" data-linenos="158 "></span></a>    domain: &quot;&quot;
<a id="__codelineno-37-159" name="__codelineno-37-159"></a><a href="#__codelineno-37-159"><span class="linenos" data-linenos="159 "></span></a>  }
<a id="__codelineno-37-160" name="__codelineno-37-160"></a><a href="#__codelineno-37-160"><span class="linenos" data-linenos="160 "></span></a>  node {
<a id="__codelineno-37-161" name="__codelineno-37-161"></a><a href="#__codelineno-37-161"><span class="linenos" data-linenos="161 "></span></a>    input: &quot;To_Indices1&quot;
<a id="__codelineno-37-162" name="__codelineno-37-162"></a><a href="#__codelineno-37-162"><span class="linenos" data-linenos="162 "></span></a>    output: &quot;knny_output0&quot;
<a id="__codelineno-37-163" name="__codelineno-37-163"></a><a href="#__codelineno-37-163"><span class="linenos" data-linenos="163 "></span></a>    name: &quot;knny_Flatten&quot;
<a id="__codelineno-37-164" name="__codelineno-37-164"></a><a href="#__codelineno-37-164"><span class="linenos" data-linenos="164 "></span></a>    op_type: &quot;Flatten&quot;
<a id="__codelineno-37-165" name="__codelineno-37-165"></a><a href="#__codelineno-37-165"><span class="linenos" data-linenos="165 "></span></a>    domain: &quot;&quot;
<a id="__codelineno-37-166" name="__codelineno-37-166"></a><a href="#__codelineno-37-166"><span class="linenos" data-linenos="166 "></span></a>  }
<a id="__codelineno-37-167" name="__codelineno-37-167"></a><a href="#__codelineno-37-167"><span class="linenos" data-linenos="167 "></span></a>  node {
<a id="__codelineno-37-168" name="__codelineno-37-168"></a><a href="#__codelineno-37-168"><span class="linenos" data-linenos="168 "></span></a>    input: &quot;knny_ArrayFeatureExtractorcst&quot;
<a id="__codelineno-37-169" name="__codelineno-37-169"></a><a href="#__codelineno-37-169"><span class="linenos" data-linenos="169 "></span></a>    input: &quot;knny_output0&quot;
<a id="__codelineno-37-170" name="__codelineno-37-170"></a><a href="#__codelineno-37-170"><span class="linenos" data-linenos="170 "></span></a>    output: &quot;knny_Z0&quot;
<a id="__codelineno-37-171" name="__codelineno-37-171"></a><a href="#__codelineno-37-171"><span class="linenos" data-linenos="171 "></span></a>    name: &quot;knny_ArrayFeatureExtractor&quot;
<a id="__codelineno-37-172" name="__codelineno-37-172"></a><a href="#__codelineno-37-172"><span class="linenos" data-linenos="172 "></span></a>    op_type: &quot;ArrayFeatureExtractor&quot;
<a id="__codelineno-37-173" name="__codelineno-37-173"></a><a href="#__codelineno-37-173"><span class="linenos" data-linenos="173 "></span></a>    domain: &quot;ai.onnx.ml&quot;
<a id="__codelineno-37-174" name="__codelineno-37-174"></a><a href="#__codelineno-37-174"><span class="linenos" data-linenos="174 "></span></a>  }
<a id="__codelineno-37-175" name="__codelineno-37-175"></a><a href="#__codelineno-37-175"><span class="linenos" data-linenos="175 "></span></a>  node {
<a id="__codelineno-37-176" name="__codelineno-37-176"></a><a href="#__codelineno-37-176"><span class="linenos" data-linenos="176 "></span></a>    input: &quot;knny_Z0&quot;
<a id="__codelineno-37-177" name="__codelineno-37-177"></a><a href="#__codelineno-37-177"><span class="linenos" data-linenos="177 "></span></a>    input: &quot;knny_Reshapecst&quot;
<a id="__codelineno-37-178" name="__codelineno-37-178"></a><a href="#__codelineno-37-178"><span class="linenos" data-linenos="178 "></span></a>    output: &quot;knny_reshaped0&quot;
<a id="__codelineno-37-179" name="__codelineno-37-179"></a><a href="#__codelineno-37-179"><span class="linenos" data-linenos="179 "></span></a>    name: &quot;knny_Reshape&quot;
<a id="__codelineno-37-180" name="__codelineno-37-180"></a><a href="#__codelineno-37-180"><span class="linenos" data-linenos="180 "></span></a>    op_type: &quot;Reshape&quot;
<a id="__codelineno-37-181" name="__codelineno-37-181"></a><a href="#__codelineno-37-181"><span class="linenos" data-linenos="181 "></span></a>    attribute {
<a id="__codelineno-37-182" name="__codelineno-37-182"></a><a href="#__codelineno-37-182"><span class="linenos" data-linenos="182 "></span></a>      name: &quot;allowzero&quot;
<a id="__codelineno-37-183" name="__codelineno-37-183"></a><a href="#__codelineno-37-183"><span class="linenos" data-linenos="183 "></span></a>      i: 0
<a id="__codelineno-37-184" name="__codelineno-37-184"></a><a href="#__codelineno-37-184"><span class="linenos" data-linenos="184 "></span></a>      type: INT
<a id="__codelineno-37-185" name="__codelineno-37-185"></a><a href="#__codelineno-37-185"><span class="linenos" data-linenos="185 "></span></a>    }
<a id="__codelineno-37-186" name="__codelineno-37-186"></a><a href="#__codelineno-37-186"><span class="linenos" data-linenos="186 "></span></a>    domain: &quot;&quot;
<a id="__codelineno-37-187" name="__codelineno-37-187"></a><a href="#__codelineno-37-187"><span class="linenos" data-linenos="187 "></span></a>  }
<a id="__codelineno-37-188" name="__codelineno-37-188"></a><a href="#__codelineno-37-188"><span class="linenos" data-linenos="188 "></span></a>  node {
<a id="__codelineno-37-189" name="__codelineno-37-189"></a><a href="#__codelineno-37-189"><span class="linenos" data-linenos="189 "></span></a>    input: &quot;knny_reshaped0&quot;
<a id="__codelineno-37-190" name="__codelineno-37-190"></a><a href="#__codelineno-37-190"><span class="linenos" data-linenos="190 "></span></a>    output: &quot;knny_transposed0&quot;
<a id="__codelineno-37-191" name="__codelineno-37-191"></a><a href="#__codelineno-37-191"><span class="linenos" data-linenos="191 "></span></a>    name: &quot;knny_Transpose&quot;
<a id="__codelineno-37-192" name="__codelineno-37-192"></a><a href="#__codelineno-37-192"><span class="linenos" data-linenos="192 "></span></a>    op_type: &quot;Transpose&quot;
<a id="__codelineno-37-193" name="__codelineno-37-193"></a><a href="#__codelineno-37-193"><span class="linenos" data-linenos="193 "></span></a>    attribute {
<a id="__codelineno-37-194" name="__codelineno-37-194"></a><a href="#__codelineno-37-194"><span class="linenos" data-linenos="194 "></span></a>      name: &quot;perm&quot;
<a id="__codelineno-37-195" name="__codelineno-37-195"></a><a href="#__codelineno-37-195"><span class="linenos" data-linenos="195 "></span></a>      ints: 1
<a id="__codelineno-37-196" name="__codelineno-37-196"></a><a href="#__codelineno-37-196"><span class="linenos" data-linenos="196 "></span></a>      ints: 0
<a id="__codelineno-37-197" name="__codelineno-37-197"></a><a href="#__codelineno-37-197"><span class="linenos" data-linenos="197 "></span></a>      ints: 2
<a id="__codelineno-37-198" name="__codelineno-37-198"></a><a href="#__codelineno-37-198"><span class="linenos" data-linenos="198 "></span></a>      type: INTS
<a id="__codelineno-37-199" name="__codelineno-37-199"></a><a href="#__codelineno-37-199"><span class="linenos" data-linenos="199 "></span></a>    }
<a id="__codelineno-37-200" name="__codelineno-37-200"></a><a href="#__codelineno-37-200"><span class="linenos" data-linenos="200 "></span></a>    domain: &quot;&quot;
<a id="__codelineno-37-201" name="__codelineno-37-201"></a><a href="#__codelineno-37-201"><span class="linenos" data-linenos="201 "></span></a>  }
<a id="__codelineno-37-202" name="__codelineno-37-202"></a><a href="#__codelineno-37-202"><span class="linenos" data-linenos="202 "></span></a>  node {
<a id="__codelineno-37-203" name="__codelineno-37-203"></a><a href="#__codelineno-37-203"><span class="linenos" data-linenos="203 "></span></a>    input: &quot;knny_transposed0&quot;
<a id="__codelineno-37-204" name="__codelineno-37-204"></a><a href="#__codelineno-37-204"><span class="linenos" data-linenos="204 "></span></a>    output: &quot;Ca_output0&quot;
<a id="__codelineno-37-205" name="__codelineno-37-205"></a><a href="#__codelineno-37-205"><span class="linenos" data-linenos="205 "></span></a>    name: &quot;Ca_Cast&quot;
<a id="__codelineno-37-206" name="__codelineno-37-206"></a><a href="#__codelineno-37-206"><span class="linenos" data-linenos="206 "></span></a>    op_type: &quot;Cast&quot;
<a id="__codelineno-37-207" name="__codelineno-37-207"></a><a href="#__codelineno-37-207"><span class="linenos" data-linenos="207 "></span></a>    attribute {
<a id="__codelineno-37-208" name="__codelineno-37-208"></a><a href="#__codelineno-37-208"><span class="linenos" data-linenos="208 "></span></a>      name: &quot;to&quot;
<a id="__codelineno-37-209" name="__codelineno-37-209"></a><a href="#__codelineno-37-209"><span class="linenos" data-linenos="209 "></span></a>      i: 1
<a id="__codelineno-37-210" name="__codelineno-37-210"></a><a href="#__codelineno-37-210"><span class="linenos" data-linenos="210 "></span></a>      type: INT
<a id="__codelineno-37-211" name="__codelineno-37-211"></a><a href="#__codelineno-37-211"><span class="linenos" data-linenos="211 "></span></a>    }
<a id="__codelineno-37-212" name="__codelineno-37-212"></a><a href="#__codelineno-37-212"><span class="linenos" data-linenos="212 "></span></a>    domain: &quot;&quot;
<a id="__codelineno-37-213" name="__codelineno-37-213"></a><a href="#__codelineno-37-213"><span class="linenos" data-linenos="213 "></span></a>  }
<a id="__codelineno-37-214" name="__codelineno-37-214"></a><a href="#__codelineno-37-214"><span class="linenos" data-linenos="214 "></span></a>  node {
<a id="__codelineno-37-215" name="__codelineno-37-215"></a><a href="#__codelineno-37-215"><span class="linenos" data-linenos="215 "></span></a>    input: &quot;Ca_output0&quot;
<a id="__codelineno-37-216" name="__codelineno-37-216"></a><a href="#__codelineno-37-216"><span class="linenos" data-linenos="216 "></span></a>    output: &quot;variable&quot;
<a id="__codelineno-37-217" name="__codelineno-37-217"></a><a href="#__codelineno-37-217"><span class="linenos" data-linenos="217 "></span></a>    name: &quot;Re_ReduceMean&quot;
<a id="__codelineno-37-218" name="__codelineno-37-218"></a><a href="#__codelineno-37-218"><span class="linenos" data-linenos="218 "></span></a>    op_type: &quot;ReduceMean&quot;
<a id="__codelineno-37-219" name="__codelineno-37-219"></a><a href="#__codelineno-37-219"><span class="linenos" data-linenos="219 "></span></a>    attribute {
<a id="__codelineno-37-220" name="__codelineno-37-220"></a><a href="#__codelineno-37-220"><span class="linenos" data-linenos="220 "></span></a>      name: &quot;axes&quot;
<a id="__codelineno-37-221" name="__codelineno-37-221"></a><a href="#__codelineno-37-221"><span class="linenos" data-linenos="221 "></span></a>      ints: 2
<a id="__codelineno-37-222" name="__codelineno-37-222"></a><a href="#__codelineno-37-222"><span class="linenos" data-linenos="222 "></span></a>      type: INTS
<a id="__codelineno-37-223" name="__codelineno-37-223"></a><a href="#__codelineno-37-223"><span class="linenos" data-linenos="223 "></span></a>    }
<a id="__codelineno-37-224" name="__codelineno-37-224"></a><a href="#__codelineno-37-224"><span class="linenos" data-linenos="224 "></span></a>    attribute {
<a id="__codelineno-37-225" name="__codelineno-37-225"></a><a href="#__codelineno-37-225"><span class="linenos" data-linenos="225 "></span></a>      name: &quot;keepdims&quot;
<a id="__codelineno-37-226" name="__codelineno-37-226"></a><a href="#__codelineno-37-226"><span class="linenos" data-linenos="226 "></span></a>      i: 0
<a id="__codelineno-37-227" name="__codelineno-37-227"></a><a href="#__codelineno-37-227"><span class="linenos" data-linenos="227 "></span></a>      type: INT
<a id="__codelineno-37-228" name="__codelineno-37-228"></a><a href="#__codelineno-37-228"><span class="linenos" data-linenos="228 "></span></a>    }
<a id="__codelineno-37-229" name="__codelineno-37-229"></a><a href="#__codelineno-37-229"><span class="linenos" data-linenos="229 "></span></a>    domain: &quot;&quot;
<a id="__codelineno-37-230" name="__codelineno-37-230"></a><a href="#__codelineno-37-230"><span class="linenos" data-linenos="230 "></span></a>  }
<a id="__codelineno-37-231" name="__codelineno-37-231"></a><a href="#__codelineno-37-231"><span class="linenos" data-linenos="231 "></span></a>  name: &quot;KNN regressor&quot;
<a id="__codelineno-37-232" name="__codelineno-37-232"></a><a href="#__codelineno-37-232"><span class="linenos" data-linenos="232 "></span></a>  initializer {
<a id="__codelineno-37-233" name="__codelineno-37-233"></a><a href="#__codelineno-37-233"><span class="linenos" data-linenos="233 "></span></a>    dims: 2
<a id="__codelineno-37-234" name="__codelineno-37-234"></a><a href="#__codelineno-37-234"><span class="linenos" data-linenos="234 "></span></a>    dims: 20
<a id="__codelineno-37-235" name="__codelineno-37-235"></a><a href="#__codelineno-37-235"><span class="linenos" data-linenos="235 "></span></a>    data_type: 11
<a id="__codelineno-37-236" name="__codelineno-37-236"></a><a href="#__codelineno-37-236"><span class="linenos" data-linenos="236 "></span></a>    name: &quot;knny_ArrayFeatureExtractorcst&quot;
<a id="__codelineno-37-237" name="__codelineno-37-237"></a><a href="#__codelineno-37-237"><span class="linenos" data-linenos="237 "></span></a>    raw_data: &quot;,\\&amp;\212\306K7@\333z`\345^7^\300\304\312,\006\217\026b\300Z9dWgAp\300.+F\027\343Tc@\203\330\264\255\350\216^\300\260\022\216sy\356n@\237h\263\r\320\332f\300\224\277.;\254\235`\300\336\370lV\226ob@\261\201\362|\304\021V@c,[Mv\301-\300\322\214\240\223\300\355[@)\036\262M\324\320r@nE;\211q\244=\300\021n5`&lt;r\\\300\207\211\201\2400\215i\300H\232p\303\377\020\\@\317K[\302\224\202P@&amp;\306\355\355^\261l\300\301/\377&lt;N\306@\300#w\001\317\242\236a\300$fd\023!\364U\300\204\327LIK\247V\300J\211\366\022\276\227L@\262\345\254\206\234nL@f{\013\201\313ES@\234\343hU3wg\300\3370\367\305\306cE\300\336A\347;\204\2445\300f\374\242\031\347JF\300\325\2557\&#39;\333\243S@\331\354\345{\232\3547\300\307o)\372T]m@#\005\000W\014oR\300\&#39;\025\227\034&gt;M$\300\310\252\022\\\277\227Q\300l_\243\036\326dP@\333kk\354\363+[@\223)\036\363\204\227S\300&quot;
<a id="__codelineno-37-238" name="__codelineno-37-238"></a><a href="#__codelineno-37-238"><span class="linenos" data-linenos="238 "></span></a>  }
<a id="__codelineno-37-239" name="__codelineno-37-239"></a><a href="#__codelineno-37-239"><span class="linenos" data-linenos="239 "></span></a>  initializer {
<a id="__codelineno-37-240" name="__codelineno-37-240"></a><a href="#__codelineno-37-240"><span class="linenos" data-linenos="240 "></span></a>    dims: 20
<a id="__codelineno-37-241" name="__codelineno-37-241"></a><a href="#__codelineno-37-241"><span class="linenos" data-linenos="241 "></span></a>    dims: 4
<a id="__codelineno-37-242" name="__codelineno-37-242"></a><a href="#__codelineno-37-242"><span class="linenos" data-linenos="242 "></span></a>    data_type: 1
<a id="__codelineno-37-243" name="__codelineno-37-243"></a><a href="#__codelineno-37-243"><span class="linenos" data-linenos="243 "></span></a>    name: &quot;Sc_Scancst&quot;
<a id="__codelineno-37-244" name="__codelineno-37-244"></a><a href="#__codelineno-37-244"><span class="linenos" data-linenos="244 "></span></a>    raw_data: &quot;\342\327\221?\267O/\277\306\016\236\277\271\377\315&gt;3\2575&gt;\314\361\354&gt;;\266\315\276W\252\320\277\221x\002\277\234\tG?FK\340\276\231[\240\277\3746\206\277\002\263\371?&amp;\303\265\277\020g\332\277$\014\357?b\375\032\276\342.z\277\3778s?/d#\300\207\376=\277\214S\&#39;?\261K]?\0342\304?\205\236\301&gt;\363\023\274?\212\252\036&gt;^&amp;,\277\324\366\334\277Z\027\270\276[*P\277\220\354^\277\241\rf=~/\024\277\320\203\237\276*z\235?m\307\232\276\225\347\231?\263O\306\276\251C\021@ \255?\276\250(\272\277Hm;=\265Dh\277\031\024\004&gt;\262\304T=\256\245:?\374=\277?\005\246Z\277\002\025R\276iJ\240&gt;x\314\341?\313j\017@h\341\314&gt;\223\216z?.:\210=6\271\271\276\231\335\232&gt;\357b\&quot;\277 \304\002\277QN\333&gt;\365\036\227\277k\336\346\2744\224\316\277\026\030\306&gt;\227\330Y\276L=e\277^\323B?]\327\252&gt;\3000\371=\013B\343&gt;hd\323\275\242%\272?\3709\322&gt;(\200\023&gt;\355Ec\277\362\031 &gt;\275\212\375\277\213!\262\276&quot;
<a id="__codelineno-37-245" name="__codelineno-37-245"></a><a href="#__codelineno-37-245"><span class="linenos" data-linenos="245 "></span></a>  }
<a id="__codelineno-37-246" name="__codelineno-37-246"></a><a href="#__codelineno-37-246"><span class="linenos" data-linenos="246 "></span></a>  initializer {
<a id="__codelineno-37-247" name="__codelineno-37-247"></a><a href="#__codelineno-37-247"><span class="linenos" data-linenos="247 "></span></a>    dims: 1
<a id="__codelineno-37-248" name="__codelineno-37-248"></a><a href="#__codelineno-37-248"><span class="linenos" data-linenos="248 "></span></a>    data_type: 7
<a id="__codelineno-37-249" name="__codelineno-37-249"></a><a href="#__codelineno-37-249"><span class="linenos" data-linenos="249 "></span></a>    name: &quot;To_TopKcst&quot;
<a id="__codelineno-37-250" name="__codelineno-37-250"></a><a href="#__codelineno-37-250"><span class="linenos" data-linenos="250 "></span></a>    raw_data: &quot;\002\000\000\000\000\000\000\000&quot;
<a id="__codelineno-37-251" name="__codelineno-37-251"></a><a href="#__codelineno-37-251"><span class="linenos" data-linenos="251 "></span></a>  }
<a id="__codelineno-37-252" name="__codelineno-37-252"></a><a href="#__codelineno-37-252"><span class="linenos" data-linenos="252 "></span></a>  initializer {
<a id="__codelineno-37-253" name="__codelineno-37-253"></a><a href="#__codelineno-37-253"><span class="linenos" data-linenos="253 "></span></a>    dims: 3
<a id="__codelineno-37-254" name="__codelineno-37-254"></a><a href="#__codelineno-37-254"><span class="linenos" data-linenos="254 "></span></a>    data_type: 7
<a id="__codelineno-37-255" name="__codelineno-37-255"></a><a href="#__codelineno-37-255"><span class="linenos" data-linenos="255 "></span></a>    name: &quot;knny_Reshapecst&quot;
<a id="__codelineno-37-256" name="__codelineno-37-256"></a><a href="#__codelineno-37-256"><span class="linenos" data-linenos="256 "></span></a>    raw_data: &quot;\002\000\000\000\000\000\000\000\377\377\377\377\377\377\377\377\002\000\000\000\000\000\000\000&quot;
<a id="__codelineno-37-257" name="__codelineno-37-257"></a><a href="#__codelineno-37-257"><span class="linenos" data-linenos="257 "></span></a>  }
<a id="__codelineno-37-258" name="__codelineno-37-258"></a><a href="#__codelineno-37-258"><span class="linenos" data-linenos="258 "></span></a>  input {
<a id="__codelineno-37-259" name="__codelineno-37-259"></a><a href="#__codelineno-37-259"><span class="linenos" data-linenos="259 "></span></a>    name: &quot;input&quot;
<a id="__codelineno-37-260" name="__codelineno-37-260"></a><a href="#__codelineno-37-260"><span class="linenos" data-linenos="260 "></span></a>    type {
<a id="__codelineno-37-261" name="__codelineno-37-261"></a><a href="#__codelineno-37-261"><span class="linenos" data-linenos="261 "></span></a>      tensor_type {
<a id="__codelineno-37-262" name="__codelineno-37-262"></a><a href="#__codelineno-37-262"><span class="linenos" data-linenos="262 "></span></a>        elem_type: 1
<a id="__codelineno-37-263" name="__codelineno-37-263"></a><a href="#__codelineno-37-263"><span class="linenos" data-linenos="263 "></span></a>        shape {
<a id="__codelineno-37-264" name="__codelineno-37-264"></a><a href="#__codelineno-37-264"><span class="linenos" data-linenos="264 "></span></a>          dim {
<a id="__codelineno-37-265" name="__codelineno-37-265"></a><a href="#__codelineno-37-265"><span class="linenos" data-linenos="265 "></span></a>          }
<a id="__codelineno-37-266" name="__codelineno-37-266"></a><a href="#__codelineno-37-266"><span class="linenos" data-linenos="266 "></span></a>          dim {
<a id="__codelineno-37-267" name="__codelineno-37-267"></a><a href="#__codelineno-37-267"><span class="linenos" data-linenos="267 "></span></a>            dim_value: 4
<a id="__codelineno-37-268" name="__codelineno-37-268"></a><a href="#__codelineno-37-268"><span class="linenos" data-linenos="268 "></span></a>          }
<a id="__codelineno-37-269" name="__codelineno-37-269"></a><a href="#__codelineno-37-269"><span class="linenos" data-linenos="269 "></span></a>        }
<a id="__codelineno-37-270" name="__codelineno-37-270"></a><a href="#__codelineno-37-270"><span class="linenos" data-linenos="270 "></span></a>      }
<a id="__codelineno-37-271" name="__codelineno-37-271"></a><a href="#__codelineno-37-271"><span class="linenos" data-linenos="271 "></span></a>    }
<a id="__codelineno-37-272" name="__codelineno-37-272"></a><a href="#__codelineno-37-272"><span class="linenos" data-linenos="272 "></span></a>  }
<a id="__codelineno-37-273" name="__codelineno-37-273"></a><a href="#__codelineno-37-273"><span class="linenos" data-linenos="273 "></span></a>  output {
<a id="__codelineno-37-274" name="__codelineno-37-274"></a><a href="#__codelineno-37-274"><span class="linenos" data-linenos="274 "></span></a>    name: &quot;variable&quot;
<a id="__codelineno-37-275" name="__codelineno-37-275"></a><a href="#__codelineno-37-275"><span class="linenos" data-linenos="275 "></span></a>    type {
<a id="__codelineno-37-276" name="__codelineno-37-276"></a><a href="#__codelineno-37-276"><span class="linenos" data-linenos="276 "></span></a>      tensor_type {
<a id="__codelineno-37-277" name="__codelineno-37-277"></a><a href="#__codelineno-37-277"><span class="linenos" data-linenos="277 "></span></a>        elem_type: 1
<a id="__codelineno-37-278" name="__codelineno-37-278"></a><a href="#__codelineno-37-278"><span class="linenos" data-linenos="278 "></span></a>        shape {
<a id="__codelineno-37-279" name="__codelineno-37-279"></a><a href="#__codelineno-37-279"><span class="linenos" data-linenos="279 "></span></a>          dim {
<a id="__codelineno-37-280" name="__codelineno-37-280"></a><a href="#__codelineno-37-280"><span class="linenos" data-linenos="280 "></span></a>          }
<a id="__codelineno-37-281" name="__codelineno-37-281"></a><a href="#__codelineno-37-281"><span class="linenos" data-linenos="281 "></span></a>          dim {
<a id="__codelineno-37-282" name="__codelineno-37-282"></a><a href="#__codelineno-37-282"><span class="linenos" data-linenos="282 "></span></a>            dim_value: 2
<a id="__codelineno-37-283" name="__codelineno-37-283"></a><a href="#__codelineno-37-283"><span class="linenos" data-linenos="283 "></span></a>          }
<a id="__codelineno-37-284" name="__codelineno-37-284"></a><a href="#__codelineno-37-284"><span class="linenos" data-linenos="284 "></span></a>        }
<a id="__codelineno-37-285" name="__codelineno-37-285"></a><a href="#__codelineno-37-285"><span class="linenos" data-linenos="285 "></span></a>      }
<a id="__codelineno-37-286" name="__codelineno-37-286"></a><a href="#__codelineno-37-286"><span class="linenos" data-linenos="286 "></span></a>    }
<a id="__codelineno-37-287" name="__codelineno-37-287"></a><a href="#__codelineno-37-287"><span class="linenos" data-linenos="287 "></span></a>  }
<a id="__codelineno-37-288" name="__codelineno-37-288"></a><a href="#__codelineno-37-288"><span class="linenos" data-linenos="288 "></span></a>}
<a id="__codelineno-37-289" name="__codelineno-37-289"></a><a href="#__codelineno-37-289"><span class="linenos" data-linenos="289 "></span></a>opset_import {
<a id="__codelineno-37-290" name="__codelineno-37-290"></a><a href="#__codelineno-37-290"><span class="linenos" data-linenos="290 "></span></a>  domain: &quot;&quot;
<a id="__codelineno-37-291" name="__codelineno-37-291"></a><a href="#__codelineno-37-291"><span class="linenos" data-linenos="291 "></span></a>  version: 15
<a id="__codelineno-37-292" name="__codelineno-37-292"></a><a href="#__codelineno-37-292"><span class="linenos" data-linenos="292 "></span></a>}
<a id="__codelineno-37-293" name="__codelineno-37-293"></a><a href="#__codelineno-37-293"><span class="linenos" data-linenos="293 "></span></a>opset_import {
<a id="__codelineno-37-294" name="__codelineno-37-294"></a><a href="#__codelineno-37-294"><span class="linenos" data-linenos="294 "></span></a>  domain: &quot;ai.onnx.ml&quot;
<a id="__codelineno-37-295" name="__codelineno-37-295"></a><a href="#__codelineno-37-295"><span class="linenos" data-linenos="295 "></span></a>  version: 15
<a id="__codelineno-37-296" name="__codelineno-37-296"></a><a href="#__codelineno-37-296"><span class="linenos" data-linenos="296 "></span></a>}
</code></pre></div>
</details>

<p>从视觉上看，它看起来如下所示：
<img alt="扫描算子" src="../img/dot_scan.png" /></p>
<p>子图由操作符Scan执行。在这种情况下，有一个扫描输入，这意味着操作符仅构建一个输出。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><a href="#__codelineno-38-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><a href="#__codelineno-38-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="s1">&#39;Scan&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X1&#39;</span><span class="p">,</span> <span class="s1">&#39;X2&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y1&#39;</span><span class="p">,</span> <span class="s1">&#39;Y2&#39;</span><span class="p">],</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><a href="#__codelineno-38-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sc_Scan&#39;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span> <span class="n">num_scan_inputs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</code></pre></div>
<p>在第一次迭代中，子图得到X1和X2的第一行。该图产生两个输出。第一个在下一次迭代中替换X1 ，第二个存储在容器中形成Y2 。在第二次迭代中，子图的第二个输入是X2的第二行。这里有一个简短的总结。绿色是第一次迭代，蓝色是第二次迭代。</p>
<p><img alt="子图" src="../img/scanop.png" /></p>
<h2 id="_13">函数</h2>
<p>如上一章所述，如果存在函数的具体实现，则可以使用函数来缩短构建模型的代码，并为运行时运行预测提供更多可能性，从而加快运行速度。如果没有，运行时仍然可以使用基于现有运算符的默认实现。</p>
<p>Functionmake_function用于定义函数。它的工作方式类似于类型较少的图。它更像一个模板。此 API 可能会演变。它也不包含初始化程序。</p>
<h3 id="_14">没有属性的函数</h3>
<p>这是比较简单的情况。函数的每个输入都是执行时已知的动态对象。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><a href="#__codelineno-39-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><a href="#__codelineno-39-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">numpy_helper</span><span class="p">,</span> <span class="n">TensorProto</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><a href="#__codelineno-39-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><a href="#__codelineno-39-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">set_model_props</span><span class="p">,</span> <span class="n">make_tensor</span><span class="p">,</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><a href="#__codelineno-39-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">make_graph</span><span class="p">,</span> <span class="n">make_tensor_value_info</span><span class="p">,</span> <span class="n">make_opsetid</span><span class="p">,</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a><a href="#__codelineno-39-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">make_function</span><span class="p">)</span>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><a href="#__codelineno-39-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a><a href="#__codelineno-39-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a><a href="#__codelineno-39-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">new_domain</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
<a id="__codelineno-39-10" name="__codelineno-39-10"></a><a href="#__codelineno-39-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">opset_imports</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_opsetid</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="n">make_opsetid</span><span class="p">(</span><span class="n">new_domain</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<a id="__codelineno-39-11" name="__codelineno-39-11"></a><a href="#__codelineno-39-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-39-12" name="__codelineno-39-12"></a><a href="#__codelineno-39-12"><span class="linenos" data-linenos="12 "></span></a><span class="c1"># Let&#39;s define a function for a linear regression</span>
<a id="__codelineno-39-13" name="__codelineno-39-13"></a><a href="#__codelineno-39-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-39-14" name="__codelineno-39-14"></a><a href="#__codelineno-39-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">node1</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">])</span>
<a id="__codelineno-39-15" name="__codelineno-39-15"></a><a href="#__codelineno-39-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-39-16" name="__codelineno-39-16"></a><a href="#__codelineno-39-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-39-17" name="__codelineno-39-17"></a><a href="#__codelineno-39-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">linear_regression</span> <span class="o">=</span> <span class="n">make_function</span><span class="p">(</span>
<a id="__codelineno-39-18" name="__codelineno-39-18"></a><a href="#__codelineno-39-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">new_domain</span><span class="p">,</span>            <span class="c1"># domain name</span>
<a id="__codelineno-39-19" name="__codelineno-39-19"></a><a href="#__codelineno-39-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="s1">&#39;LinearRegression&#39;</span><span class="p">,</span>     <span class="c1"># function name</span>
<a id="__codelineno-39-20" name="__codelineno-39-20"></a><a href="#__codelineno-39-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span>        <span class="c1"># input names</span>
<a id="__codelineno-39-21" name="__codelineno-39-21"></a><a href="#__codelineno-39-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span>                  <span class="c1"># output names</span>
<a id="__codelineno-39-22" name="__codelineno-39-22"></a><a href="#__codelineno-39-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="p">[</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">],</span>         <span class="c1"># nodes</span>
<a id="__codelineno-39-23" name="__codelineno-39-23"></a><a href="#__codelineno-39-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="n">opset_imports</span><span class="p">,</span>          <span class="c1"># opsets</span>
<a id="__codelineno-39-24" name="__codelineno-39-24"></a><a href="#__codelineno-39-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="p">[])</span>                     <span class="c1"># attribute names</span>
<a id="__codelineno-39-25" name="__codelineno-39-25"></a><a href="#__codelineno-39-25"><span class="linenos" data-linenos="25 "></span></a>
<a id="__codelineno-39-26" name="__codelineno-39-26"></a><a href="#__codelineno-39-26"><span class="linenos" data-linenos="26 "></span></a><span class="c1"># Let&#39;s use it in a graph.</span>
<a id="__codelineno-39-27" name="__codelineno-39-27"></a><a href="#__codelineno-39-27"><span class="linenos" data-linenos="27 "></span></a>
<a id="__codelineno-39-28" name="__codelineno-39-28"></a><a href="#__codelineno-39-28"><span class="linenos" data-linenos="28 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-39-29" name="__codelineno-39-29"></a><a href="#__codelineno-39-29"><span class="linenos" data-linenos="29 "></span></a><span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-39-30" name="__codelineno-39-30"></a><a href="#__codelineno-39-30"><span class="linenos" data-linenos="30 "></span></a><span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-39-31" name="__codelineno-39-31"></a><a href="#__codelineno-39-31"><span class="linenos" data-linenos="31 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-39-32" name="__codelineno-39-32"></a><a href="#__codelineno-39-32"><span class="linenos" data-linenos="32 "></span></a>
<a id="__codelineno-39-33" name="__codelineno-39-33"></a><a href="#__codelineno-39-33"><span class="linenos" data-linenos="33 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">(</span>
<a id="__codelineno-39-34" name="__codelineno-39-34"></a><a href="#__codelineno-39-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="p">[</span><span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;LinearRegression&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y1&#39;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">new_domain</span><span class="p">),</span>
<a id="__codelineno-39-35" name="__codelineno-39-35"></a><a href="#__codelineno-39-35"><span class="linenos" data-linenos="35 "></span></a>     <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Abs&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Y1&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])],</span>
<a id="__codelineno-39-36" name="__codelineno-39-36"></a><a href="#__codelineno-39-36"><span class="linenos" data-linenos="36 "></span></a>    <span class="s1">&#39;example&#39;</span><span class="p">,</span>
<a id="__codelineno-39-37" name="__codelineno-39-37"></a><a href="#__codelineno-39-37"><span class="linenos" data-linenos="37 "></span></a>    <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<a id="__codelineno-39-38" name="__codelineno-39-38"></a><a href="#__codelineno-39-38"><span class="linenos" data-linenos="38 "></span></a>
<a id="__codelineno-39-39" name="__codelineno-39-39"></a><a href="#__codelineno-39-39"><span class="linenos" data-linenos="39 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span>
<a id="__codelineno-39-40" name="__codelineno-39-40"></a><a href="#__codelineno-39-40"><span class="linenos" data-linenos="40 "></span></a>    <span class="n">graph</span><span class="p">,</span> <span class="n">opset_imports</span><span class="o">=</span><span class="n">opset_imports</span><span class="p">,</span>
<a id="__codelineno-39-41" name="__codelineno-39-41"></a><a href="#__codelineno-39-41"><span class="linenos" data-linenos="41 "></span></a>    <span class="n">functions</span><span class="o">=</span><span class="p">[</span><span class="n">linear_regression</span><span class="p">])</span>  <span class="c1"># functions to add)</span>
<a id="__codelineno-39-42" name="__codelineno-39-42"></a><a href="#__codelineno-39-42"><span class="linenos" data-linenos="42 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-39-43" name="__codelineno-39-43"></a><a href="#__codelineno-39-43"><span class="linenos" data-linenos="43 "></span></a>
<a id="__codelineno-39-44" name="__codelineno-39-44"></a><a href="#__codelineno-39-44"><span class="linenos" data-linenos="44 "></span></a><span class="c1"># the work is done, let&#39;s display it...</span>
<a id="__codelineno-39-45" name="__codelineno-39-45"></a><a href="#__codelineno-39-45"><span class="linenos" data-linenos="45 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><a href="#__codelineno-40-1"><span class="linenos" data-linenos="  1 "></span></a>ir_version:<span class="w"> </span><span class="m">11</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><a href="#__codelineno-40-2"><span class="linenos" data-linenos="  2 "></span></a>graph<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><a href="#__codelineno-40-3"><span class="linenos" data-linenos="  3 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><a href="#__codelineno-40-4"><span class="linenos" data-linenos="  4 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><a href="#__codelineno-40-5"><span class="linenos" data-linenos="  5 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><a href="#__codelineno-40-6"><span class="linenos" data-linenos="  6 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a><a href="#__codelineno-40-7"><span class="linenos" data-linenos="  7 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;Y1&quot;</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a><a href="#__codelineno-40-8"><span class="linenos" data-linenos="  8 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;LinearRegression&quot;</span>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a><a href="#__codelineno-40-9"><span class="linenos" data-linenos="  9 "></span></a><span class="w">    </span>domain:<span class="w"> </span><span class="s2">&quot;custom&quot;</span>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a><a href="#__codelineno-40-10"><span class="linenos" data-linenos=" 10 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a><a href="#__codelineno-40-11"><span class="linenos" data-linenos=" 11 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a><a href="#__codelineno-40-12"><span class="linenos" data-linenos=" 12 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;Y1&quot;</span>
<a id="__codelineno-40-13" name="__codelineno-40-13"></a><a href="#__codelineno-40-13"><span class="linenos" data-linenos=" 13 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a><a href="#__codelineno-40-14"><span class="linenos" data-linenos=" 14 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;Abs&quot;</span>
<a id="__codelineno-40-15" name="__codelineno-40-15"></a><a href="#__codelineno-40-15"><span class="linenos" data-linenos=" 15 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-40-16" name="__codelineno-40-16"></a><a href="#__codelineno-40-16"><span class="linenos" data-linenos=" 16 "></span></a><span class="w">  </span>name:<span class="w"> </span><span class="s2">&quot;example&quot;</span>
<a id="__codelineno-40-17" name="__codelineno-40-17"></a><a href="#__codelineno-40-17"><span class="linenos" data-linenos=" 17 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-18" name="__codelineno-40-18"></a><a href="#__codelineno-40-18"><span class="linenos" data-linenos=" 18 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-40-19" name="__codelineno-40-19"></a><a href="#__codelineno-40-19"><span class="linenos" data-linenos=" 19 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-20" name="__codelineno-40-20"></a><a href="#__codelineno-40-20"><span class="linenos" data-linenos=" 20 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-21" name="__codelineno-40-21"></a><a href="#__codelineno-40-21"><span class="linenos" data-linenos=" 21 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-40-22" name="__codelineno-40-22"></a><a href="#__codelineno-40-22"><span class="linenos" data-linenos=" 22 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-23" name="__codelineno-40-23"></a><a href="#__codelineno-40-23"><span class="linenos" data-linenos=" 23 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-24" name="__codelineno-40-24"></a><a href="#__codelineno-40-24"><span class="linenos" data-linenos=" 24 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-40-25" name="__codelineno-40-25"></a><a href="#__codelineno-40-25"><span class="linenos" data-linenos=" 25 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-26" name="__codelineno-40-26"></a><a href="#__codelineno-40-26"><span class="linenos" data-linenos=" 26 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-40-27" name="__codelineno-40-27"></a><a href="#__codelineno-40-27"><span class="linenos" data-linenos=" 27 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-40-28" name="__codelineno-40-28"></a><a href="#__codelineno-40-28"><span class="linenos" data-linenos=" 28 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-40-29" name="__codelineno-40-29"></a><a href="#__codelineno-40-29"><span class="linenos" data-linenos=" 29 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-40-30" name="__codelineno-40-30"></a><a href="#__codelineno-40-30"><span class="linenos" data-linenos=" 30 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-40-31" name="__codelineno-40-31"></a><a href="#__codelineno-40-31"><span class="linenos" data-linenos=" 31 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-32" name="__codelineno-40-32"></a><a href="#__codelineno-40-32"><span class="linenos" data-linenos=" 32 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-40-33" name="__codelineno-40-33"></a><a href="#__codelineno-40-33"><span class="linenos" data-linenos=" 33 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-34" name="__codelineno-40-34"></a><a href="#__codelineno-40-34"><span class="linenos" data-linenos=" 34 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-35" name="__codelineno-40-35"></a><a href="#__codelineno-40-35"><span class="linenos" data-linenos=" 35 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-40-36" name="__codelineno-40-36"></a><a href="#__codelineno-40-36"><span class="linenos" data-linenos=" 36 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-37" name="__codelineno-40-37"></a><a href="#__codelineno-40-37"><span class="linenos" data-linenos=" 37 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-38" name="__codelineno-40-38"></a><a href="#__codelineno-40-38"><span class="linenos" data-linenos=" 38 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-40-39" name="__codelineno-40-39"></a><a href="#__codelineno-40-39"><span class="linenos" data-linenos=" 39 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-40" name="__codelineno-40-40"></a><a href="#__codelineno-40-40"><span class="linenos" data-linenos=" 40 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-40-41" name="__codelineno-40-41"></a><a href="#__codelineno-40-41"><span class="linenos" data-linenos=" 41 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-40-42" name="__codelineno-40-42"></a><a href="#__codelineno-40-42"><span class="linenos" data-linenos=" 42 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-40-43" name="__codelineno-40-43"></a><a href="#__codelineno-40-43"><span class="linenos" data-linenos=" 43 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-40-44" name="__codelineno-40-44"></a><a href="#__codelineno-40-44"><span class="linenos" data-linenos=" 44 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-40-45" name="__codelineno-40-45"></a><a href="#__codelineno-40-45"><span class="linenos" data-linenos=" 45 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-46" name="__codelineno-40-46"></a><a href="#__codelineno-40-46"><span class="linenos" data-linenos=" 46 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-40-47" name="__codelineno-40-47"></a><a href="#__codelineno-40-47"><span class="linenos" data-linenos=" 47 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-48" name="__codelineno-40-48"></a><a href="#__codelineno-40-48"><span class="linenos" data-linenos=" 48 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-49" name="__codelineno-40-49"></a><a href="#__codelineno-40-49"><span class="linenos" data-linenos=" 49 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-40-50" name="__codelineno-40-50"></a><a href="#__codelineno-40-50"><span class="linenos" data-linenos=" 50 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-51" name="__codelineno-40-51"></a><a href="#__codelineno-40-51"><span class="linenos" data-linenos=" 51 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-52" name="__codelineno-40-52"></a><a href="#__codelineno-40-52"><span class="linenos" data-linenos=" 52 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-40-53" name="__codelineno-40-53"></a><a href="#__codelineno-40-53"><span class="linenos" data-linenos=" 53 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-54" name="__codelineno-40-54"></a><a href="#__codelineno-40-54"><span class="linenos" data-linenos=" 54 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-40-55" name="__codelineno-40-55"></a><a href="#__codelineno-40-55"><span class="linenos" data-linenos=" 55 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-40-56" name="__codelineno-40-56"></a><a href="#__codelineno-40-56"><span class="linenos" data-linenos=" 56 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-40-57" name="__codelineno-40-57"></a><a href="#__codelineno-40-57"><span class="linenos" data-linenos=" 57 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-40-58" name="__codelineno-40-58"></a><a href="#__codelineno-40-58"><span class="linenos" data-linenos=" 58 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-40-59" name="__codelineno-40-59"></a><a href="#__codelineno-40-59"><span class="linenos" data-linenos=" 59 "></span></a><span class="w">  </span>output<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-60" name="__codelineno-40-60"></a><a href="#__codelineno-40-60"><span class="linenos" data-linenos=" 60 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-40-61" name="__codelineno-40-61"></a><a href="#__codelineno-40-61"><span class="linenos" data-linenos=" 61 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-62" name="__codelineno-40-62"></a><a href="#__codelineno-40-62"><span class="linenos" data-linenos=" 62 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-63" name="__codelineno-40-63"></a><a href="#__codelineno-40-63"><span class="linenos" data-linenos=" 63 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-40-64" name="__codelineno-40-64"></a><a href="#__codelineno-40-64"><span class="linenos" data-linenos=" 64 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-65" name="__codelineno-40-65"></a><a href="#__codelineno-40-65"><span class="linenos" data-linenos=" 65 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-66" name="__codelineno-40-66"></a><a href="#__codelineno-40-66"><span class="linenos" data-linenos=" 66 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-40-67" name="__codelineno-40-67"></a><a href="#__codelineno-40-67"><span class="linenos" data-linenos=" 67 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-40-68" name="__codelineno-40-68"></a><a href="#__codelineno-40-68"><span class="linenos" data-linenos=" 68 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-40-69" name="__codelineno-40-69"></a><a href="#__codelineno-40-69"><span class="linenos" data-linenos=" 69 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-40-70" name="__codelineno-40-70"></a><a href="#__codelineno-40-70"><span class="linenos" data-linenos=" 70 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-40-71" name="__codelineno-40-71"></a><a href="#__codelineno-40-71"><span class="linenos" data-linenos=" 71 "></span></a><span class="o">}</span>
<a id="__codelineno-40-72" name="__codelineno-40-72"></a><a href="#__codelineno-40-72"><span class="linenos" data-linenos=" 72 "></span></a>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-73" name="__codelineno-40-73"></a><a href="#__codelineno-40-73"><span class="linenos" data-linenos=" 73 "></span></a><span class="w">  </span>domain:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-40-74" name="__codelineno-40-74"></a><a href="#__codelineno-40-74"><span class="linenos" data-linenos=" 74 "></span></a><span class="w">  </span>version:<span class="w"> </span><span class="m">14</span>
<a id="__codelineno-40-75" name="__codelineno-40-75"></a><a href="#__codelineno-40-75"><span class="linenos" data-linenos=" 75 "></span></a><span class="o">}</span>
<a id="__codelineno-40-76" name="__codelineno-40-76"></a><a href="#__codelineno-40-76"><span class="linenos" data-linenos=" 76 "></span></a>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-77" name="__codelineno-40-77"></a><a href="#__codelineno-40-77"><span class="linenos" data-linenos=" 77 "></span></a><span class="w">  </span>domain:<span class="w"> </span><span class="s2">&quot;custom&quot;</span>
<a id="__codelineno-40-78" name="__codelineno-40-78"></a><a href="#__codelineno-40-78"><span class="linenos" data-linenos=" 78 "></span></a><span class="w">  </span>version:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-40-79" name="__codelineno-40-79"></a><a href="#__codelineno-40-79"><span class="linenos" data-linenos=" 79 "></span></a><span class="o">}</span>
<a id="__codelineno-40-80" name="__codelineno-40-80"></a><a href="#__codelineno-40-80"><span class="linenos" data-linenos=" 80 "></span></a>functions<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-81" name="__codelineno-40-81"></a><a href="#__codelineno-40-81"><span class="linenos" data-linenos=" 81 "></span></a><span class="w">  </span>name:<span class="w"> </span><span class="s2">&quot;LinearRegression&quot;</span>
<a id="__codelineno-40-82" name="__codelineno-40-82"></a><a href="#__codelineno-40-82"><span class="linenos" data-linenos=" 82 "></span></a><span class="w">  </span>input:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-40-83" name="__codelineno-40-83"></a><a href="#__codelineno-40-83"><span class="linenos" data-linenos=" 83 "></span></a><span class="w">  </span>input:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-40-84" name="__codelineno-40-84"></a><a href="#__codelineno-40-84"><span class="linenos" data-linenos=" 84 "></span></a><span class="w">  </span>input:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-40-85" name="__codelineno-40-85"></a><a href="#__codelineno-40-85"><span class="linenos" data-linenos=" 85 "></span></a><span class="w">  </span>output:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-40-86" name="__codelineno-40-86"></a><a href="#__codelineno-40-86"><span class="linenos" data-linenos=" 86 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-87" name="__codelineno-40-87"></a><a href="#__codelineno-40-87"><span class="linenos" data-linenos=" 87 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-40-88" name="__codelineno-40-88"></a><a href="#__codelineno-40-88"><span class="linenos" data-linenos=" 88 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-40-89" name="__codelineno-40-89"></a><a href="#__codelineno-40-89"><span class="linenos" data-linenos=" 89 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-40-90" name="__codelineno-40-90"></a><a href="#__codelineno-40-90"><span class="linenos" data-linenos=" 90 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;MatMul&quot;</span>
<a id="__codelineno-40-91" name="__codelineno-40-91"></a><a href="#__codelineno-40-91"><span class="linenos" data-linenos=" 91 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-40-92" name="__codelineno-40-92"></a><a href="#__codelineno-40-92"><span class="linenos" data-linenos=" 92 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-93" name="__codelineno-40-93"></a><a href="#__codelineno-40-93"><span class="linenos" data-linenos=" 93 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-40-94" name="__codelineno-40-94"></a><a href="#__codelineno-40-94"><span class="linenos" data-linenos=" 94 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-40-95" name="__codelineno-40-95"></a><a href="#__codelineno-40-95"><span class="linenos" data-linenos=" 95 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-40-96" name="__codelineno-40-96"></a><a href="#__codelineno-40-96"><span class="linenos" data-linenos=" 96 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;Add&quot;</span>
<a id="__codelineno-40-97" name="__codelineno-40-97"></a><a href="#__codelineno-40-97"><span class="linenos" data-linenos=" 97 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-40-98" name="__codelineno-40-98"></a><a href="#__codelineno-40-98"><span class="linenos" data-linenos=" 98 "></span></a><span class="w">  </span>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-99" name="__codelineno-40-99"></a><a href="#__codelineno-40-99"><span class="linenos" data-linenos=" 99 "></span></a><span class="w">    </span>domain:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-40-100" name="__codelineno-40-100"></a><a href="#__codelineno-40-100"><span class="linenos" data-linenos="100 "></span></a><span class="w">    </span>version:<span class="w"> </span><span class="m">14</span>
<a id="__codelineno-40-101" name="__codelineno-40-101"></a><a href="#__codelineno-40-101"><span class="linenos" data-linenos="101 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-40-102" name="__codelineno-40-102"></a><a href="#__codelineno-40-102"><span class="linenos" data-linenos="102 "></span></a><span class="w">  </span>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-40-103" name="__codelineno-40-103"></a><a href="#__codelineno-40-103"><span class="linenos" data-linenos="103 "></span></a><span class="w">    </span>domain:<span class="w"> </span><span class="s2">&quot;custom&quot;</span>
<a id="__codelineno-40-104" name="__codelineno-40-104"></a><a href="#__codelineno-40-104"><span class="linenos" data-linenos="104 "></span></a><span class="w">    </span>version:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-40-105" name="__codelineno-40-105"></a><a href="#__codelineno-40-105"><span class="linenos" data-linenos="105 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-40-106" name="__codelineno-40-106"></a><a href="#__codelineno-40-106"><span class="linenos" data-linenos="106 "></span></a><span class="w">  </span>domain:<span class="w"> </span><span class="s2">&quot;custom&quot;</span>
<a id="__codelineno-40-107" name="__codelineno-40-107"></a><a href="#__codelineno-40-107"><span class="linenos" data-linenos="107 "></span></a><span class="o">}</span>
</code></pre></div>
<h3 id="_15">具有属性的函数</h3>
<p>以下函数与上一个函数等效，只是输入B被转换为名为bias 的参数。代码几乎相同，只是 bias 现在是一个常量。在函数定义内部，创建了一个节点Constant以将参数作为结果插入。它通过属性链接到参数ref_attr_name。
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><a href="#__codelineno-41-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><a href="#__codelineno-41-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">numpy_helper</span><span class="p">,</span> <span class="n">TensorProto</span><span class="p">,</span> <span class="n">AttributeProto</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><a href="#__codelineno-41-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><a href="#__codelineno-41-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">set_model_props</span><span class="p">,</span> <span class="n">make_tensor</span><span class="p">,</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><a href="#__codelineno-41-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">make_graph</span><span class="p">,</span> <span class="n">make_tensor_value_info</span><span class="p">,</span> <span class="n">make_opsetid</span><span class="p">,</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><a href="#__codelineno-41-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">make_function</span><span class="p">)</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a><a href="#__codelineno-41-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a><a href="#__codelineno-41-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><a href="#__codelineno-41-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">new_domain</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a><a href="#__codelineno-41-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">opset_imports</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_opsetid</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="n">make_opsetid</span><span class="p">(</span><span class="n">new_domain</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a><a href="#__codelineno-41-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a><a href="#__codelineno-41-12"><span class="linenos" data-linenos="12 "></span></a><span class="c1"># Let&#39;s define a function for a linear regression</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a><a href="#__codelineno-41-13"><span class="linenos" data-linenos="13 "></span></a><span class="c1"># The first step consists in creating a constant</span>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a><a href="#__codelineno-41-14"><span class="linenos" data-linenos="14 "></span></a><span class="c1"># equal to the input parameter of the function.</span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a><a href="#__codelineno-41-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">cst</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Constant&#39;</span><span class="p">,</span>  <span class="p">[],</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">])</span>
<a id="__codelineno-41-16" name="__codelineno-41-16"></a><a href="#__codelineno-41-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-41-17" name="__codelineno-41-17"></a><a href="#__codelineno-41-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">att</span> <span class="o">=</span> <span class="n">AttributeProto</span><span class="p">()</span>
<a id="__codelineno-41-18" name="__codelineno-41-18"></a><a href="#__codelineno-41-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">att</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span>
<a id="__codelineno-41-19" name="__codelineno-41-19"></a><a href="#__codelineno-41-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-41-20" name="__codelineno-41-20"></a><a href="#__codelineno-41-20"><span class="linenos" data-linenos="20 "></span></a><span class="c1"># This line indicates the value comes from the argument</span>
<a id="__codelineno-41-21" name="__codelineno-41-21"></a><a href="#__codelineno-41-21"><span class="linenos" data-linenos="21 "></span></a><span class="c1"># named &#39;bias&#39; the function is given.</span>
<a id="__codelineno-41-22" name="__codelineno-41-22"></a><a href="#__codelineno-41-22"><span class="linenos" data-linenos="22 "></span></a><span class="n">att</span><span class="o">.</span><span class="n">ref_attr_name</span> <span class="o">=</span> <span class="s2">&quot;bias&quot;</span>
<a id="__codelineno-41-23" name="__codelineno-41-23"></a><a href="#__codelineno-41-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">att</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">AttributeProto</span><span class="o">.</span><span class="n">TENSOR</span>
<a id="__codelineno-41-24" name="__codelineno-41-24"></a><a href="#__codelineno-41-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">cst</span><span class="o">.</span><span class="n">attribute</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">att</span><span class="p">)</span>
<a id="__codelineno-41-25" name="__codelineno-41-25"></a><a href="#__codelineno-41-25"><span class="linenos" data-linenos="25 "></span></a>
<a id="__codelineno-41-26" name="__codelineno-41-26"></a><a href="#__codelineno-41-26"><span class="linenos" data-linenos="26 "></span></a><span class="n">node1</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">])</span>
<a id="__codelineno-41-27" name="__codelineno-41-27"></a><a href="#__codelineno-41-27"><span class="linenos" data-linenos="27 "></span></a><span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-41-28" name="__codelineno-41-28"></a><a href="#__codelineno-41-28"><span class="linenos" data-linenos="28 "></span></a>
<a id="__codelineno-41-29" name="__codelineno-41-29"></a><a href="#__codelineno-41-29"><span class="linenos" data-linenos="29 "></span></a><span class="n">linear_regression</span> <span class="o">=</span> <span class="n">make_function</span><span class="p">(</span>
<a id="__codelineno-41-30" name="__codelineno-41-30"></a><a href="#__codelineno-41-30"><span class="linenos" data-linenos="30 "></span></a>    <span class="n">new_domain</span><span class="p">,</span>            <span class="c1"># domain name</span>
<a id="__codelineno-41-31" name="__codelineno-41-31"></a><a href="#__codelineno-41-31"><span class="linenos" data-linenos="31 "></span></a>    <span class="s1">&#39;LinearRegression&#39;</span><span class="p">,</span>     <span class="c1"># function name</span>
<a id="__codelineno-41-32" name="__codelineno-41-32"></a><a href="#__codelineno-41-32"><span class="linenos" data-linenos="32 "></span></a>    <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span>             <span class="c1"># input names</span>
<a id="__codelineno-41-33" name="__codelineno-41-33"></a><a href="#__codelineno-41-33"><span class="linenos" data-linenos="33 "></span></a>    <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span>                  <span class="c1"># output names</span>
<a id="__codelineno-41-34" name="__codelineno-41-34"></a><a href="#__codelineno-41-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="p">[</span><span class="n">cst</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">],</span>    <span class="c1"># nodes</span>
<a id="__codelineno-41-35" name="__codelineno-41-35"></a><a href="#__codelineno-41-35"><span class="linenos" data-linenos="35 "></span></a>    <span class="n">opset_imports</span><span class="p">,</span>          <span class="c1"># opsets</span>
<a id="__codelineno-41-36" name="__codelineno-41-36"></a><a href="#__codelineno-41-36"><span class="linenos" data-linenos="36 "></span></a>    <span class="p">[</span><span class="s2">&quot;bias&quot;</span><span class="p">])</span>               <span class="c1"># attribute names</span>
<a id="__codelineno-41-37" name="__codelineno-41-37"></a><a href="#__codelineno-41-37"><span class="linenos" data-linenos="37 "></span></a>
<a id="__codelineno-41-38" name="__codelineno-41-38"></a><a href="#__codelineno-41-38"><span class="linenos" data-linenos="38 "></span></a><span class="c1"># Let&#39;s use it in a graph.</span>
<a id="__codelineno-41-39" name="__codelineno-41-39"></a><a href="#__codelineno-41-39"><span class="linenos" data-linenos="39 "></span></a>
<a id="__codelineno-41-40" name="__codelineno-41-40"></a><a href="#__codelineno-41-40"><span class="linenos" data-linenos="40 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-41-41" name="__codelineno-41-41"></a><a href="#__codelineno-41-41"><span class="linenos" data-linenos="41 "></span></a><span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-41-42" name="__codelineno-41-42"></a><a href="#__codelineno-41-42"><span class="linenos" data-linenos="42 "></span></a><span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-41-43" name="__codelineno-41-43"></a><a href="#__codelineno-41-43"><span class="linenos" data-linenos="43 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-41-44" name="__codelineno-41-44"></a><a href="#__codelineno-41-44"><span class="linenos" data-linenos="44 "></span></a>
<a id="__codelineno-41-45" name="__codelineno-41-45"></a><a href="#__codelineno-41-45"><span class="linenos" data-linenos="45 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">(</span>
<a id="__codelineno-41-46" name="__codelineno-41-46"></a><a href="#__codelineno-41-46"><span class="linenos" data-linenos="46 "></span></a>    <span class="p">[</span><span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;LinearRegression&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y1&#39;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">new_domain</span><span class="p">,</span>
<a id="__codelineno-41-47" name="__codelineno-41-47"></a><a href="#__codelineno-41-47"><span class="linenos" data-linenos="47 "></span></a>               <span class="c1"># bias is now an argument of the function and is defined as a tensor</span>
<a id="__codelineno-41-48" name="__codelineno-41-48"></a><a href="#__codelineno-41-48"><span class="linenos" data-linenos="48 "></span></a>               <span class="n">bias</span><span class="o">=</span><span class="n">make_tensor</span><span class="p">(</span><span class="s1">&#39;former_B&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.67</span><span class="p">])),</span>
<a id="__codelineno-41-49" name="__codelineno-41-49"></a><a href="#__codelineno-41-49"><span class="linenos" data-linenos="49 "></span></a>     <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Abs&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Y1&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])],</span>
<a id="__codelineno-41-50" name="__codelineno-41-50"></a><a href="#__codelineno-41-50"><span class="linenos" data-linenos="50 "></span></a>    <span class="s1">&#39;example&#39;</span><span class="p">,</span>
<a id="__codelineno-41-51" name="__codelineno-41-51"></a><a href="#__codelineno-41-51"><span class="linenos" data-linenos="51 "></span></a>    <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">A</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<a id="__codelineno-41-52" name="__codelineno-41-52"></a><a href="#__codelineno-41-52"><span class="linenos" data-linenos="52 "></span></a>
<a id="__codelineno-41-53" name="__codelineno-41-53"></a><a href="#__codelineno-41-53"><span class="linenos" data-linenos="53 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span>
<a id="__codelineno-41-54" name="__codelineno-41-54"></a><a href="#__codelineno-41-54"><span class="linenos" data-linenos="54 "></span></a>    <span class="n">graph</span><span class="p">,</span> <span class="n">opset_imports</span><span class="o">=</span><span class="n">opset_imports</span><span class="p">,</span>
<a id="__codelineno-41-55" name="__codelineno-41-55"></a><a href="#__codelineno-41-55"><span class="linenos" data-linenos="55 "></span></a>    <span class="n">functions</span><span class="o">=</span><span class="p">[</span><span class="n">linear_regression</span><span class="p">])</span>  <span class="c1"># functions to add)</span>
<a id="__codelineno-41-56" name="__codelineno-41-56"></a><a href="#__codelineno-41-56"><span class="linenos" data-linenos="56 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-41-57" name="__codelineno-41-57"></a><a href="#__codelineno-41-57"><span class="linenos" data-linenos="57 "></span></a>
<a id="__codelineno-41-58" name="__codelineno-41-58"></a><a href="#__codelineno-41-58"><span class="linenos" data-linenos="58 "></span></a><span class="c1"># the work is done, let&#39;s display it...</span>
<a id="__codelineno-41-59" name="__codelineno-41-59"></a><a href="#__codelineno-41-59"><span class="linenos" data-linenos="59 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><a href="#__codelineno-42-1"><span class="linenos" data-linenos="  1 "></span></a>ir_version:<span class="w"> </span><span class="m">11</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><a href="#__codelineno-42-2"><span class="linenos" data-linenos="  2 "></span></a>graph<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><a href="#__codelineno-42-3"><span class="linenos" data-linenos="  3 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><a href="#__codelineno-42-4"><span class="linenos" data-linenos="  4 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><a href="#__codelineno-42-5"><span class="linenos" data-linenos="  5 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a><a href="#__codelineno-42-6"><span class="linenos" data-linenos="  6 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;Y1&quot;</span>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a><a href="#__codelineno-42-7"><span class="linenos" data-linenos="  7 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;LinearRegression&quot;</span>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a><a href="#__codelineno-42-8"><span class="linenos" data-linenos="  8 "></span></a><span class="w">    </span>attribute<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a><a href="#__codelineno-42-9"><span class="linenos" data-linenos="  9 "></span></a><span class="w">      </span>name:<span class="w"> </span><span class="s2">&quot;bias&quot;</span>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a><a href="#__codelineno-42-10"><span class="linenos" data-linenos=" 10 "></span></a><span class="w">      </span>t<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-11" name="__codelineno-42-11"></a><a href="#__codelineno-42-11"><span class="linenos" data-linenos=" 11 "></span></a><span class="w">        </span>dims:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-42-12" name="__codelineno-42-12"></a><a href="#__codelineno-42-12"><span class="linenos" data-linenos=" 12 "></span></a><span class="w">        </span>data_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-42-13" name="__codelineno-42-13"></a><a href="#__codelineno-42-13"><span class="linenos" data-linenos=" 13 "></span></a><span class="w">        </span>float_data:<span class="w"> </span><span class="m">0</span>.6700000166893005
<a id="__codelineno-42-14" name="__codelineno-42-14"></a><a href="#__codelineno-42-14"><span class="linenos" data-linenos=" 14 "></span></a><span class="w">        </span>name:<span class="w"> </span><span class="s2">&quot;former_B&quot;</span>
<a id="__codelineno-42-15" name="__codelineno-42-15"></a><a href="#__codelineno-42-15"><span class="linenos" data-linenos=" 15 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-42-16" name="__codelineno-42-16"></a><a href="#__codelineno-42-16"><span class="linenos" data-linenos=" 16 "></span></a><span class="w">      </span>type:<span class="w"> </span>TENSOR
<a id="__codelineno-42-17" name="__codelineno-42-17"></a><a href="#__codelineno-42-17"><span class="linenos" data-linenos=" 17 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-42-18" name="__codelineno-42-18"></a><a href="#__codelineno-42-18"><span class="linenos" data-linenos=" 18 "></span></a><span class="w">    </span>domain:<span class="w"> </span><span class="s2">&quot;custom&quot;</span>
<a id="__codelineno-42-19" name="__codelineno-42-19"></a><a href="#__codelineno-42-19"><span class="linenos" data-linenos=" 19 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-42-20" name="__codelineno-42-20"></a><a href="#__codelineno-42-20"><span class="linenos" data-linenos=" 20 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-21" name="__codelineno-42-21"></a><a href="#__codelineno-42-21"><span class="linenos" data-linenos=" 21 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;Y1&quot;</span>
<a id="__codelineno-42-22" name="__codelineno-42-22"></a><a href="#__codelineno-42-22"><span class="linenos" data-linenos=" 22 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-42-23" name="__codelineno-42-23"></a><a href="#__codelineno-42-23"><span class="linenos" data-linenos=" 23 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;Abs&quot;</span>
<a id="__codelineno-42-24" name="__codelineno-42-24"></a><a href="#__codelineno-42-24"><span class="linenos" data-linenos=" 24 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-42-25" name="__codelineno-42-25"></a><a href="#__codelineno-42-25"><span class="linenos" data-linenos=" 25 "></span></a><span class="w">  </span>name:<span class="w"> </span><span class="s2">&quot;example&quot;</span>
<a id="__codelineno-42-26" name="__codelineno-42-26"></a><a href="#__codelineno-42-26"><span class="linenos" data-linenos=" 26 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-27" name="__codelineno-42-27"></a><a href="#__codelineno-42-27"><span class="linenos" data-linenos=" 27 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-42-28" name="__codelineno-42-28"></a><a href="#__codelineno-42-28"><span class="linenos" data-linenos=" 28 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-29" name="__codelineno-42-29"></a><a href="#__codelineno-42-29"><span class="linenos" data-linenos=" 29 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-30" name="__codelineno-42-30"></a><a href="#__codelineno-42-30"><span class="linenos" data-linenos=" 30 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-42-31" name="__codelineno-42-31"></a><a href="#__codelineno-42-31"><span class="linenos" data-linenos=" 31 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-32" name="__codelineno-42-32"></a><a href="#__codelineno-42-32"><span class="linenos" data-linenos=" 32 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-33" name="__codelineno-42-33"></a><a href="#__codelineno-42-33"><span class="linenos" data-linenos=" 33 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-42-34" name="__codelineno-42-34"></a><a href="#__codelineno-42-34"><span class="linenos" data-linenos=" 34 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-35" name="__codelineno-42-35"></a><a href="#__codelineno-42-35"><span class="linenos" data-linenos=" 35 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-42-36" name="__codelineno-42-36"></a><a href="#__codelineno-42-36"><span class="linenos" data-linenos=" 36 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-42-37" name="__codelineno-42-37"></a><a href="#__codelineno-42-37"><span class="linenos" data-linenos=" 37 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-42-38" name="__codelineno-42-38"></a><a href="#__codelineno-42-38"><span class="linenos" data-linenos=" 38 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-42-39" name="__codelineno-42-39"></a><a href="#__codelineno-42-39"><span class="linenos" data-linenos=" 39 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-42-40" name="__codelineno-42-40"></a><a href="#__codelineno-42-40"><span class="linenos" data-linenos=" 40 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-41" name="__codelineno-42-41"></a><a href="#__codelineno-42-41"><span class="linenos" data-linenos=" 41 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-42-42" name="__codelineno-42-42"></a><a href="#__codelineno-42-42"><span class="linenos" data-linenos=" 42 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-43" name="__codelineno-42-43"></a><a href="#__codelineno-42-43"><span class="linenos" data-linenos=" 43 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-44" name="__codelineno-42-44"></a><a href="#__codelineno-42-44"><span class="linenos" data-linenos=" 44 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-42-45" name="__codelineno-42-45"></a><a href="#__codelineno-42-45"><span class="linenos" data-linenos=" 45 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-46" name="__codelineno-42-46"></a><a href="#__codelineno-42-46"><span class="linenos" data-linenos=" 46 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-47" name="__codelineno-42-47"></a><a href="#__codelineno-42-47"><span class="linenos" data-linenos=" 47 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-42-48" name="__codelineno-42-48"></a><a href="#__codelineno-42-48"><span class="linenos" data-linenos=" 48 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-49" name="__codelineno-42-49"></a><a href="#__codelineno-42-49"><span class="linenos" data-linenos=" 49 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-42-50" name="__codelineno-42-50"></a><a href="#__codelineno-42-50"><span class="linenos" data-linenos=" 50 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-42-51" name="__codelineno-42-51"></a><a href="#__codelineno-42-51"><span class="linenos" data-linenos=" 51 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-42-52" name="__codelineno-42-52"></a><a href="#__codelineno-42-52"><span class="linenos" data-linenos=" 52 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-42-53" name="__codelineno-42-53"></a><a href="#__codelineno-42-53"><span class="linenos" data-linenos=" 53 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-42-54" name="__codelineno-42-54"></a><a href="#__codelineno-42-54"><span class="linenos" data-linenos=" 54 "></span></a><span class="w">  </span>output<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-55" name="__codelineno-42-55"></a><a href="#__codelineno-42-55"><span class="linenos" data-linenos=" 55 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-42-56" name="__codelineno-42-56"></a><a href="#__codelineno-42-56"><span class="linenos" data-linenos=" 56 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-57" name="__codelineno-42-57"></a><a href="#__codelineno-42-57"><span class="linenos" data-linenos=" 57 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-58" name="__codelineno-42-58"></a><a href="#__codelineno-42-58"><span class="linenos" data-linenos=" 58 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-42-59" name="__codelineno-42-59"></a><a href="#__codelineno-42-59"><span class="linenos" data-linenos=" 59 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-60" name="__codelineno-42-60"></a><a href="#__codelineno-42-60"><span class="linenos" data-linenos=" 60 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-61" name="__codelineno-42-61"></a><a href="#__codelineno-42-61"><span class="linenos" data-linenos=" 61 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-42-62" name="__codelineno-42-62"></a><a href="#__codelineno-42-62"><span class="linenos" data-linenos=" 62 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-42-63" name="__codelineno-42-63"></a><a href="#__codelineno-42-63"><span class="linenos" data-linenos=" 63 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-42-64" name="__codelineno-42-64"></a><a href="#__codelineno-42-64"><span class="linenos" data-linenos=" 64 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-42-65" name="__codelineno-42-65"></a><a href="#__codelineno-42-65"><span class="linenos" data-linenos=" 65 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-42-66" name="__codelineno-42-66"></a><a href="#__codelineno-42-66"><span class="linenos" data-linenos=" 66 "></span></a><span class="o">}</span>
<a id="__codelineno-42-67" name="__codelineno-42-67"></a><a href="#__codelineno-42-67"><span class="linenos" data-linenos=" 67 "></span></a>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-68" name="__codelineno-42-68"></a><a href="#__codelineno-42-68"><span class="linenos" data-linenos=" 68 "></span></a><span class="w">  </span>domain:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-42-69" name="__codelineno-42-69"></a><a href="#__codelineno-42-69"><span class="linenos" data-linenos=" 69 "></span></a><span class="w">  </span>version:<span class="w"> </span><span class="m">14</span>
<a id="__codelineno-42-70" name="__codelineno-42-70"></a><a href="#__codelineno-42-70"><span class="linenos" data-linenos=" 70 "></span></a><span class="o">}</span>
<a id="__codelineno-42-71" name="__codelineno-42-71"></a><a href="#__codelineno-42-71"><span class="linenos" data-linenos=" 71 "></span></a>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-72" name="__codelineno-42-72"></a><a href="#__codelineno-42-72"><span class="linenos" data-linenos=" 72 "></span></a><span class="w">  </span>domain:<span class="w"> </span><span class="s2">&quot;custom&quot;</span>
<a id="__codelineno-42-73" name="__codelineno-42-73"></a><a href="#__codelineno-42-73"><span class="linenos" data-linenos=" 73 "></span></a><span class="w">  </span>version:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-42-74" name="__codelineno-42-74"></a><a href="#__codelineno-42-74"><span class="linenos" data-linenos=" 74 "></span></a><span class="o">}</span>
<a id="__codelineno-42-75" name="__codelineno-42-75"></a><a href="#__codelineno-42-75"><span class="linenos" data-linenos=" 75 "></span></a>functions<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-76" name="__codelineno-42-76"></a><a href="#__codelineno-42-76"><span class="linenos" data-linenos=" 76 "></span></a><span class="w">  </span>name:<span class="w"> </span><span class="s2">&quot;LinearRegression&quot;</span>
<a id="__codelineno-42-77" name="__codelineno-42-77"></a><a href="#__codelineno-42-77"><span class="linenos" data-linenos=" 77 "></span></a><span class="w">  </span>input:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-42-78" name="__codelineno-42-78"></a><a href="#__codelineno-42-78"><span class="linenos" data-linenos=" 78 "></span></a><span class="w">  </span>input:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-42-79" name="__codelineno-42-79"></a><a href="#__codelineno-42-79"><span class="linenos" data-linenos=" 79 "></span></a><span class="w">  </span>output:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-42-80" name="__codelineno-42-80"></a><a href="#__codelineno-42-80"><span class="linenos" data-linenos=" 80 "></span></a><span class="w">  </span>attribute:<span class="w"> </span><span class="s2">&quot;bias&quot;</span>
<a id="__codelineno-42-81" name="__codelineno-42-81"></a><a href="#__codelineno-42-81"><span class="linenos" data-linenos=" 81 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-82" name="__codelineno-42-82"></a><a href="#__codelineno-42-82"><span class="linenos" data-linenos=" 82 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-42-83" name="__codelineno-42-83"></a><a href="#__codelineno-42-83"><span class="linenos" data-linenos=" 83 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;Constant&quot;</span>
<a id="__codelineno-42-84" name="__codelineno-42-84"></a><a href="#__codelineno-42-84"><span class="linenos" data-linenos=" 84 "></span></a><span class="w">    </span>attribute<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-85" name="__codelineno-42-85"></a><a href="#__codelineno-42-85"><span class="linenos" data-linenos=" 85 "></span></a><span class="w">      </span>name:<span class="w"> </span><span class="s2">&quot;value&quot;</span>
<a id="__codelineno-42-86" name="__codelineno-42-86"></a><a href="#__codelineno-42-86"><span class="linenos" data-linenos=" 86 "></span></a><span class="w">      </span>type:<span class="w"> </span>TENSOR
<a id="__codelineno-42-87" name="__codelineno-42-87"></a><a href="#__codelineno-42-87"><span class="linenos" data-linenos=" 87 "></span></a><span class="w">      </span>ref_attr_name:<span class="w"> </span><span class="s2">&quot;bias&quot;</span>
<a id="__codelineno-42-88" name="__codelineno-42-88"></a><a href="#__codelineno-42-88"><span class="linenos" data-linenos=" 88 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-42-89" name="__codelineno-42-89"></a><a href="#__codelineno-42-89"><span class="linenos" data-linenos=" 89 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-42-90" name="__codelineno-42-90"></a><a href="#__codelineno-42-90"><span class="linenos" data-linenos=" 90 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-91" name="__codelineno-42-91"></a><a href="#__codelineno-42-91"><span class="linenos" data-linenos=" 91 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-42-92" name="__codelineno-42-92"></a><a href="#__codelineno-42-92"><span class="linenos" data-linenos=" 92 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-42-93" name="__codelineno-42-93"></a><a href="#__codelineno-42-93"><span class="linenos" data-linenos=" 93 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-42-94" name="__codelineno-42-94"></a><a href="#__codelineno-42-94"><span class="linenos" data-linenos=" 94 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;MatMul&quot;</span>
<a id="__codelineno-42-95" name="__codelineno-42-95"></a><a href="#__codelineno-42-95"><span class="linenos" data-linenos=" 95 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-42-96" name="__codelineno-42-96"></a><a href="#__codelineno-42-96"><span class="linenos" data-linenos=" 96 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-97" name="__codelineno-42-97"></a><a href="#__codelineno-42-97"><span class="linenos" data-linenos=" 97 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-42-98" name="__codelineno-42-98"></a><a href="#__codelineno-42-98"><span class="linenos" data-linenos=" 98 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-42-99" name="__codelineno-42-99"></a><a href="#__codelineno-42-99"><span class="linenos" data-linenos=" 99 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-42-100" name="__codelineno-42-100"></a><a href="#__codelineno-42-100"><span class="linenos" data-linenos="100 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;Add&quot;</span>
<a id="__codelineno-42-101" name="__codelineno-42-101"></a><a href="#__codelineno-42-101"><span class="linenos" data-linenos="101 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-42-102" name="__codelineno-42-102"></a><a href="#__codelineno-42-102"><span class="linenos" data-linenos="102 "></span></a><span class="w">  </span>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-103" name="__codelineno-42-103"></a><a href="#__codelineno-42-103"><span class="linenos" data-linenos="103 "></span></a><span class="w">    </span>domain:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-42-104" name="__codelineno-42-104"></a><a href="#__codelineno-42-104"><span class="linenos" data-linenos="104 "></span></a><span class="w">    </span>version:<span class="w"> </span><span class="m">14</span>
<a id="__codelineno-42-105" name="__codelineno-42-105"></a><a href="#__codelineno-42-105"><span class="linenos" data-linenos="105 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-42-106" name="__codelineno-42-106"></a><a href="#__codelineno-42-106"><span class="linenos" data-linenos="106 "></span></a><span class="w">  </span>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-107" name="__codelineno-42-107"></a><a href="#__codelineno-42-107"><span class="linenos" data-linenos="107 "></span></a><span class="w">    </span>domain:<span class="w"> </span><span class="s2">&quot;custom&quot;</span>
<a id="__codelineno-42-108" name="__codelineno-42-108"></a><a href="#__codelineno-42-108"><span class="linenos" data-linenos="108 "></span></a><span class="w">    </span>version:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-42-109" name="__codelineno-42-109"></a><a href="#__codelineno-42-109"><span class="linenos" data-linenos="109 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-42-110" name="__codelineno-42-110"></a><a href="#__codelineno-42-110"><span class="linenos" data-linenos="110 "></span></a><span class="w">  </span>domain:<span class="w"> </span><span class="s2">&quot;custom&quot;</span>
<a id="__codelineno-42-111" name="__codelineno-42-111"></a><a href="#__codelineno-42-111"><span class="linenos" data-linenos="111 "></span></a><span class="o">}</span>
</code></pre></div></p>
<h2 id="_16">解析</h2>
<p>onnx 模块提供了一种更快的方式来定义图形，并且更容易阅读。当图形是在单个函数中构建时，这很容易使用，当图形是由转换机器学习管道的每个部分的许多不同函数构建时，就不那么容易了。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><a href="#__codelineno-43-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">onnx.parser</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><a href="#__codelineno-43-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><a href="#__codelineno-43-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><a href="#__codelineno-43-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="nb">input</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a><a href="#__codelineno-43-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="s1">    &lt;</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><a href="#__codelineno-43-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="s1">        ir_version: 8,</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a><a href="#__codelineno-43-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="s1">        opset_import: [ &quot;&quot; : 15]</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a><a href="#__codelineno-43-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="s1">    &gt;</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a><a href="#__codelineno-43-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="s1">    agraph (float[I,J] X, float[I] A, float[I] B) =&gt; (float[I] Y) {</span>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a><a href="#__codelineno-43-10"><span class="linenos" data-linenos="10 "></span></a><span class="s1">        XA = MatMul(X, A)</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a><a href="#__codelineno-43-11"><span class="linenos" data-linenos="11 "></span></a><span class="s1">        Y = Add(XA, B)</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a><a href="#__codelineno-43-12"><span class="linenos" data-linenos="12 "></span></a><span class="s1">    }</span>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a><a href="#__codelineno-43-13"><span class="linenos" data-linenos="13 "></span></a><span class="s1">    &#39;&#39;&#39;</span>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a><a href="#__codelineno-43-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_model</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a><a href="#__codelineno-43-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a><a href="#__codelineno-43-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-43-17" name="__codelineno-43-17"></a><a href="#__codelineno-43-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><a href="#__codelineno-44-1"><span class="linenos" data-linenos=" 1 "></span></a>ir_version:<span class="w"> </span><span class="m">8</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><a href="#__codelineno-44-2"><span class="linenos" data-linenos=" 2 "></span></a>graph<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><a href="#__codelineno-44-3"><span class="linenos" data-linenos=" 3 "></span></a>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><a href="#__codelineno-44-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><a href="#__codelineno-44-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><a href="#__codelineno-44-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><a href="#__codelineno-44-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;MatMul&quot;</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a><a href="#__codelineno-44-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span>domain:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a><a href="#__codelineno-44-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="o">}</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a><a href="#__codelineno-44-10"><span class="linenos" data-linenos="10 "></span></a>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-11" name="__codelineno-44-11"></a><a href="#__codelineno-44-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-44-12" name="__codelineno-44-12"></a><a href="#__codelineno-44-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-44-13" name="__codelineno-44-13"></a><a href="#__codelineno-44-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-44-14" name="__codelineno-44-14"></a><a href="#__codelineno-44-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;Add&quot;</span>
<a id="__codelineno-44-15" name="__codelineno-44-15"></a><a href="#__codelineno-44-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span>domain:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-44-16" name="__codelineno-44-16"></a><a href="#__codelineno-44-16"><span class="linenos" data-linenos="16 "></span></a><span class="o">}</span>
<a id="__codelineno-44-17" name="__codelineno-44-17"></a><a href="#__codelineno-44-17"><span class="linenos" data-linenos="17 "></span></a>name:<span class="w"> </span><span class="s2">&quot;agraph&quot;</span>
<a id="__codelineno-44-18" name="__codelineno-44-18"></a><a href="#__codelineno-44-18"><span class="linenos" data-linenos="18 "></span></a>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-19" name="__codelineno-44-19"></a><a href="#__codelineno-44-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-44-20" name="__codelineno-44-20"></a><a href="#__codelineno-44-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-21" name="__codelineno-44-21"></a><a href="#__codelineno-44-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">    </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-22" name="__codelineno-44-22"></a><a href="#__codelineno-44-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-44-23" name="__codelineno-44-23"></a><a href="#__codelineno-44-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-24" name="__codelineno-44-24"></a><a href="#__codelineno-44-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">        </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-25" name="__codelineno-44-25"></a><a href="#__codelineno-44-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">            </span>dim_param:<span class="w"> </span><span class="s2">&quot;I&quot;</span>
<a id="__codelineno-44-26" name="__codelineno-44-26"></a><a href="#__codelineno-44-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-44-27" name="__codelineno-44-27"></a><a href="#__codelineno-44-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">        </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-28" name="__codelineno-44-28"></a><a href="#__codelineno-44-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">            </span>dim_param:<span class="w"> </span><span class="s2">&quot;J&quot;</span>
<a id="__codelineno-44-29" name="__codelineno-44-29"></a><a href="#__codelineno-44-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-44-30" name="__codelineno-44-30"></a><a href="#__codelineno-44-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-44-31" name="__codelineno-44-31"></a><a href="#__codelineno-44-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-44-32" name="__codelineno-44-32"></a><a href="#__codelineno-44-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-44-33" name="__codelineno-44-33"></a><a href="#__codelineno-44-33"><span class="linenos" data-linenos="33 "></span></a><span class="o">}</span>
<a id="__codelineno-44-34" name="__codelineno-44-34"></a><a href="#__codelineno-44-34"><span class="linenos" data-linenos="34 "></span></a>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-35" name="__codelineno-44-35"></a><a href="#__codelineno-44-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-44-36" name="__codelineno-44-36"></a><a href="#__codelineno-44-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-37" name="__codelineno-44-37"></a><a href="#__codelineno-44-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">    </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-38" name="__codelineno-44-38"></a><a href="#__codelineno-44-38"><span class="linenos" data-linenos="38 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-44-39" name="__codelineno-44-39"></a><a href="#__codelineno-44-39"><span class="linenos" data-linenos="39 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-40" name="__codelineno-44-40"></a><a href="#__codelineno-44-40"><span class="linenos" data-linenos="40 "></span></a><span class="w">        </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-41" name="__codelineno-44-41"></a><a href="#__codelineno-44-41"><span class="linenos" data-linenos="41 "></span></a><span class="w">            </span>dim_param:<span class="w"> </span><span class="s2">&quot;I&quot;</span>
<a id="__codelineno-44-42" name="__codelineno-44-42"></a><a href="#__codelineno-44-42"><span class="linenos" data-linenos="42 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-44-43" name="__codelineno-44-43"></a><a href="#__codelineno-44-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-44-44" name="__codelineno-44-44"></a><a href="#__codelineno-44-44"><span class="linenos" data-linenos="44 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-44-45" name="__codelineno-44-45"></a><a href="#__codelineno-44-45"><span class="linenos" data-linenos="45 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-44-46" name="__codelineno-44-46"></a><a href="#__codelineno-44-46"><span class="linenos" data-linenos="46 "></span></a><span class="o">}</span>
<a id="__codelineno-44-47" name="__codelineno-44-47"></a><a href="#__codelineno-44-47"><span class="linenos" data-linenos="47 "></span></a>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-48" name="__codelineno-44-48"></a><a href="#__codelineno-44-48"><span class="linenos" data-linenos="48 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-44-49" name="__codelineno-44-49"></a><a href="#__codelineno-44-49"><span class="linenos" data-linenos="49 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-50" name="__codelineno-44-50"></a><a href="#__codelineno-44-50"><span class="linenos" data-linenos="50 "></span></a><span class="w">    </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-51" name="__codelineno-44-51"></a><a href="#__codelineno-44-51"><span class="linenos" data-linenos="51 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-44-52" name="__codelineno-44-52"></a><a href="#__codelineno-44-52"><span class="linenos" data-linenos="52 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-53" name="__codelineno-44-53"></a><a href="#__codelineno-44-53"><span class="linenos" data-linenos="53 "></span></a><span class="w">        </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-54" name="__codelineno-44-54"></a><a href="#__codelineno-44-54"><span class="linenos" data-linenos="54 "></span></a><span class="w">            </span>dim_param:<span class="w"> </span><span class="s2">&quot;I&quot;</span>
<a id="__codelineno-44-55" name="__codelineno-44-55"></a><a href="#__codelineno-44-55"><span class="linenos" data-linenos="55 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-44-56" name="__codelineno-44-56"></a><a href="#__codelineno-44-56"><span class="linenos" data-linenos="56 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-44-57" name="__codelineno-44-57"></a><a href="#__codelineno-44-57"><span class="linenos" data-linenos="57 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-44-58" name="__codelineno-44-58"></a><a href="#__codelineno-44-58"><span class="linenos" data-linenos="58 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-44-59" name="__codelineno-44-59"></a><a href="#__codelineno-44-59"><span class="linenos" data-linenos="59 "></span></a><span class="o">}</span>
<a id="__codelineno-44-60" name="__codelineno-44-60"></a><a href="#__codelineno-44-60"><span class="linenos" data-linenos="60 "></span></a>output<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-61" name="__codelineno-44-61"></a><a href="#__codelineno-44-61"><span class="linenos" data-linenos="61 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-44-62" name="__codelineno-44-62"></a><a href="#__codelineno-44-62"><span class="linenos" data-linenos="62 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-63" name="__codelineno-44-63"></a><a href="#__codelineno-44-63"><span class="linenos" data-linenos="63 "></span></a><span class="w">    </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-64" name="__codelineno-44-64"></a><a href="#__codelineno-44-64"><span class="linenos" data-linenos="64 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-44-65" name="__codelineno-44-65"></a><a href="#__codelineno-44-65"><span class="linenos" data-linenos="65 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-66" name="__codelineno-44-66"></a><a href="#__codelineno-44-66"><span class="linenos" data-linenos="66 "></span></a><span class="w">        </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-67" name="__codelineno-44-67"></a><a href="#__codelineno-44-67"><span class="linenos" data-linenos="67 "></span></a><span class="w">            </span>dim_param:<span class="w"> </span><span class="s2">&quot;I&quot;</span>
<a id="__codelineno-44-68" name="__codelineno-44-68"></a><a href="#__codelineno-44-68"><span class="linenos" data-linenos="68 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-44-69" name="__codelineno-44-69"></a><a href="#__codelineno-44-69"><span class="linenos" data-linenos="69 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-44-70" name="__codelineno-44-70"></a><a href="#__codelineno-44-70"><span class="linenos" data-linenos="70 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-44-71" name="__codelineno-44-71"></a><a href="#__codelineno-44-71"><span class="linenos" data-linenos="71 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-44-72" name="__codelineno-44-72"></a><a href="#__codelineno-44-72"><span class="linenos" data-linenos="72 "></span></a><span class="o">}</span>
<a id="__codelineno-44-73" name="__codelineno-44-73"></a><a href="#__codelineno-44-73"><span class="linenos" data-linenos="73 "></span></a><span class="o">}</span>
<a id="__codelineno-44-74" name="__codelineno-44-74"></a><a href="#__codelineno-44-74"><span class="linenos" data-linenos="74 "></span></a>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-75" name="__codelineno-44-75"></a><a href="#__codelineno-44-75"><span class="linenos" data-linenos="75 "></span></a>domain:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-44-76" name="__codelineno-44-76"></a><a href="#__codelineno-44-76"><span class="linenos" data-linenos="76 "></span></a>version:<span class="w"> </span><span class="m">15</span>
<a id="__codelineno-44-77" name="__codelineno-44-77"></a><a href="#__codelineno-44-77"><span class="linenos" data-linenos="77 "></span></a><span class="o">}</span>
</code></pre></div>
<p>这种方式用于创建小模型，但在转换库时很少使用。</p>
<h2 id="_17">检查器和形状推断</h2>
<p>onnx 提供了一个函数来检查模型是否有效。只要检测到不一致，它就会检查输入类型或形状。以下示例添加了两个不同类型的矩阵，这是不允许的。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><a href="#__codelineno-45-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">onnx.parser</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><a href="#__codelineno-45-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">onnx.checker</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><a href="#__codelineno-45-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><a href="#__codelineno-45-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="nb">input</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a><a href="#__codelineno-45-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="s1">    &lt;</span>
<a id="__codelineno-45-6" name="__codelineno-45-6"></a><a href="#__codelineno-45-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="s1">        ir_version: 8,</span>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a><a href="#__codelineno-45-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="s1">        opset_import: [ &quot;&quot; : 15]</span>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a><a href="#__codelineno-45-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="s1">    &gt;</span>
<a id="__codelineno-45-9" name="__codelineno-45-9"></a><a href="#__codelineno-45-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="s1">    agraph (float[I,4] X, float[4,2] A, int[4] B) =&gt; (float[I] Y) {</span>
<a id="__codelineno-45-10" name="__codelineno-45-10"></a><a href="#__codelineno-45-10"><span class="linenos" data-linenos="10 "></span></a><span class="s1">        XA = MatMul(X, A)</span>
<a id="__codelineno-45-11" name="__codelineno-45-11"></a><a href="#__codelineno-45-11"><span class="linenos" data-linenos="11 "></span></a><span class="s1">        Y = Add(XA, B)</span>
<a id="__codelineno-45-12" name="__codelineno-45-12"></a><a href="#__codelineno-45-12"><span class="linenos" data-linenos="12 "></span></a><span class="s1">    }</span>
<a id="__codelineno-45-13" name="__codelineno-45-13"></a><a href="#__codelineno-45-13"><span class="linenos" data-linenos="13 "></span></a><span class="s1">    &#39;&#39;&#39;</span>
<a id="__codelineno-45-14" name="__codelineno-45-14"></a><a href="#__codelineno-45-14"><span class="linenos" data-linenos="14 "></span></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-45-15" name="__codelineno-45-15"></a><a href="#__codelineno-45-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">onnx_model</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_model</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
<a id="__codelineno-45-16" name="__codelineno-45-16"></a><a href="#__codelineno-45-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">onnx</span><span class="o">.</span><span class="n">checker</span><span class="o">.</span><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-45-17" name="__codelineno-45-17"></a><a href="#__codelineno-45-17"><span class="linenos" data-linenos="17 "></span></a><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-45-18" name="__codelineno-45-18"></a><a href="#__codelineno-45-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><a href="#__codelineno-46-1"><span class="linenos" data-linenos="1 "></span></a>b<span class="s1">&#39;[ParseError at position (line: 6 column: 44)]\nError context:     agraph (float[I,4] X, float[4,2] A, int[4] B) =&gt; (float[I] Y) {\nExpected character ) not found.&#39;</span>
</code></pre></div>
<p>check_model由于不一致而引发错误。这适用于主域或 ML 域中定义的所有运算符。对于任何规范中未定义的自定义运算符，它保持沉默。</p>
<p>形状推断有一个目的：估计中间结果的形状和类型。如果已知，运行时可以预先估计内存消耗并优化计算。它可以融合一些运算符，它可以进行现场计算……</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><a href="#__codelineno-47-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">onnx.parser</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><a href="#__codelineno-47-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">helper</span><span class="p">,</span> <span class="n">shape_inference</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><a href="#__codelineno-47-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><a href="#__codelineno-47-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="nb">input</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a><a href="#__codelineno-47-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="s1">    &lt;</span>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a><a href="#__codelineno-47-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="s1">        ir_version: 8,</span>
<a id="__codelineno-47-7" name="__codelineno-47-7"></a><a href="#__codelineno-47-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="s1">        opset_import: [ &quot;&quot; : 15]</span>
<a id="__codelineno-47-8" name="__codelineno-47-8"></a><a href="#__codelineno-47-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="s1">    &gt;</span>
<a id="__codelineno-47-9" name="__codelineno-47-9"></a><a href="#__codelineno-47-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="s1">    agraph (float[I,4] X, float[4,2] A, float[4] B) =&gt; (float[I] Y) {</span>
<a id="__codelineno-47-10" name="__codelineno-47-10"></a><a href="#__codelineno-47-10"><span class="linenos" data-linenos="10 "></span></a><span class="s1">        XA = MatMul(X, A)</span>
<a id="__codelineno-47-11" name="__codelineno-47-11"></a><a href="#__codelineno-47-11"><span class="linenos" data-linenos="11 "></span></a><span class="s1">        Y = Add(XA, B)</span>
<a id="__codelineno-47-12" name="__codelineno-47-12"></a><a href="#__codelineno-47-12"><span class="linenos" data-linenos="12 "></span></a><span class="s1">    }</span>
<a id="__codelineno-47-13" name="__codelineno-47-13"></a><a href="#__codelineno-47-13"><span class="linenos" data-linenos="13 "></span></a><span class="s1">    &#39;&#39;&#39;</span>
<a id="__codelineno-47-14" name="__codelineno-47-14"></a><a href="#__codelineno-47-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_model</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
<a id="__codelineno-47-15" name="__codelineno-47-15"></a><a href="#__codelineno-47-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">inferred_model</span> <span class="o">=</span> <span class="n">shape_inference</span><span class="o">.</span><span class="n">infer_shapes</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-47-16" name="__codelineno-47-16"></a><a href="#__codelineno-47-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-47-17" name="__codelineno-47-17"></a><a href="#__codelineno-47-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">inferred_model</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><a href="#__codelineno-48-1"><span class="linenos" data-linenos=" 1 "></span></a>ir_version:<span class="w"> </span><span class="m">8</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><a href="#__codelineno-48-2"><span class="linenos" data-linenos=" 2 "></span></a>graph<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><a href="#__codelineno-48-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><a href="#__codelineno-48-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a><a href="#__codelineno-48-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a><a href="#__codelineno-48-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a><a href="#__codelineno-48-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;MatMul&quot;</span>
<a id="__codelineno-48-8" name="__codelineno-48-8"></a><a href="#__codelineno-48-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span>domain:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-48-9" name="__codelineno-48-9"></a><a href="#__codelineno-48-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-48-10" name="__codelineno-48-10"></a><a href="#__codelineno-48-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">  </span>node<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-11" name="__codelineno-48-11"></a><a href="#__codelineno-48-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-48-12" name="__codelineno-48-12"></a><a href="#__codelineno-48-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span>input:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-48-13" name="__codelineno-48-13"></a><a href="#__codelineno-48-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span>output:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-48-14" name="__codelineno-48-14"></a><a href="#__codelineno-48-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span>op_type:<span class="w"> </span><span class="s2">&quot;Add&quot;</span>
<a id="__codelineno-48-15" name="__codelineno-48-15"></a><a href="#__codelineno-48-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span>domain:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-48-16" name="__codelineno-48-16"></a><a href="#__codelineno-48-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-48-17" name="__codelineno-48-17"></a><a href="#__codelineno-48-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">  </span>name:<span class="w"> </span><span class="s2">&quot;agraph&quot;</span>
<a id="__codelineno-48-18" name="__codelineno-48-18"></a><a href="#__codelineno-48-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-19" name="__codelineno-48-19"></a><a href="#__codelineno-48-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;X&quot;</span>
<a id="__codelineno-48-20" name="__codelineno-48-20"></a><a href="#__codelineno-48-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-21" name="__codelineno-48-21"></a><a href="#__codelineno-48-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-22" name="__codelineno-48-22"></a><a href="#__codelineno-48-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-48-23" name="__codelineno-48-23"></a><a href="#__codelineno-48-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-24" name="__codelineno-48-24"></a><a href="#__codelineno-48-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-25" name="__codelineno-48-25"></a><a href="#__codelineno-48-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">            </span>dim_param:<span class="w"> </span><span class="s2">&quot;I&quot;</span>
<a id="__codelineno-48-26" name="__codelineno-48-26"></a><a href="#__codelineno-48-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-48-27" name="__codelineno-48-27"></a><a href="#__codelineno-48-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-28" name="__codelineno-48-28"></a><a href="#__codelineno-48-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">            </span>dim_value:<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-48-29" name="__codelineno-48-29"></a><a href="#__codelineno-48-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-48-30" name="__codelineno-48-30"></a><a href="#__codelineno-48-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-48-31" name="__codelineno-48-31"></a><a href="#__codelineno-48-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-48-32" name="__codelineno-48-32"></a><a href="#__codelineno-48-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-48-33" name="__codelineno-48-33"></a><a href="#__codelineno-48-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-48-34" name="__codelineno-48-34"></a><a href="#__codelineno-48-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-35" name="__codelineno-48-35"></a><a href="#__codelineno-48-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-48-36" name="__codelineno-48-36"></a><a href="#__codelineno-48-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-37" name="__codelineno-48-37"></a><a href="#__codelineno-48-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-38" name="__codelineno-48-38"></a><a href="#__codelineno-48-38"><span class="linenos" data-linenos="38 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-48-39" name="__codelineno-48-39"></a><a href="#__codelineno-48-39"><span class="linenos" data-linenos="39 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-40" name="__codelineno-48-40"></a><a href="#__codelineno-48-40"><span class="linenos" data-linenos="40 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-41" name="__codelineno-48-41"></a><a href="#__codelineno-48-41"><span class="linenos" data-linenos="41 "></span></a><span class="w">            </span>dim_value:<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-48-42" name="__codelineno-48-42"></a><a href="#__codelineno-48-42"><span class="linenos" data-linenos="42 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-48-43" name="__codelineno-48-43"></a><a href="#__codelineno-48-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-44" name="__codelineno-48-44"></a><a href="#__codelineno-48-44"><span class="linenos" data-linenos="44 "></span></a><span class="w">            </span>dim_value:<span class="w"> </span><span class="m">2</span>
<a id="__codelineno-48-45" name="__codelineno-48-45"></a><a href="#__codelineno-48-45"><span class="linenos" data-linenos="45 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-48-46" name="__codelineno-48-46"></a><a href="#__codelineno-48-46"><span class="linenos" data-linenos="46 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-48-47" name="__codelineno-48-47"></a><a href="#__codelineno-48-47"><span class="linenos" data-linenos="47 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-48-48" name="__codelineno-48-48"></a><a href="#__codelineno-48-48"><span class="linenos" data-linenos="48 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-48-49" name="__codelineno-48-49"></a><a href="#__codelineno-48-49"><span class="linenos" data-linenos="49 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-48-50" name="__codelineno-48-50"></a><a href="#__codelineno-48-50"><span class="linenos" data-linenos="50 "></span></a><span class="w">  </span>input<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-51" name="__codelineno-48-51"></a><a href="#__codelineno-48-51"><span class="linenos" data-linenos="51 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;B&quot;</span>
<a id="__codelineno-48-52" name="__codelineno-48-52"></a><a href="#__codelineno-48-52"><span class="linenos" data-linenos="52 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-53" name="__codelineno-48-53"></a><a href="#__codelineno-48-53"><span class="linenos" data-linenos="53 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-54" name="__codelineno-48-54"></a><a href="#__codelineno-48-54"><span class="linenos" data-linenos="54 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-48-55" name="__codelineno-48-55"></a><a href="#__codelineno-48-55"><span class="linenos" data-linenos="55 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-56" name="__codelineno-48-56"></a><a href="#__codelineno-48-56"><span class="linenos" data-linenos="56 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-57" name="__codelineno-48-57"></a><a href="#__codelineno-48-57"><span class="linenos" data-linenos="57 "></span></a><span class="w">            </span>dim_value:<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-48-58" name="__codelineno-48-58"></a><a href="#__codelineno-48-58"><span class="linenos" data-linenos="58 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-48-59" name="__codelineno-48-59"></a><a href="#__codelineno-48-59"><span class="linenos" data-linenos="59 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-48-60" name="__codelineno-48-60"></a><a href="#__codelineno-48-60"><span class="linenos" data-linenos="60 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-48-61" name="__codelineno-48-61"></a><a href="#__codelineno-48-61"><span class="linenos" data-linenos="61 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-48-62" name="__codelineno-48-62"></a><a href="#__codelineno-48-62"><span class="linenos" data-linenos="62 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-48-63" name="__codelineno-48-63"></a><a href="#__codelineno-48-63"><span class="linenos" data-linenos="63 "></span></a><span class="w">  </span>output<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-64" name="__codelineno-48-64"></a><a href="#__codelineno-48-64"><span class="linenos" data-linenos="64 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-48-65" name="__codelineno-48-65"></a><a href="#__codelineno-48-65"><span class="linenos" data-linenos="65 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-66" name="__codelineno-48-66"></a><a href="#__codelineno-48-66"><span class="linenos" data-linenos="66 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-67" name="__codelineno-48-67"></a><a href="#__codelineno-48-67"><span class="linenos" data-linenos="67 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-48-68" name="__codelineno-48-68"></a><a href="#__codelineno-48-68"><span class="linenos" data-linenos="68 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-69" name="__codelineno-48-69"></a><a href="#__codelineno-48-69"><span class="linenos" data-linenos="69 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-70" name="__codelineno-48-70"></a><a href="#__codelineno-48-70"><span class="linenos" data-linenos="70 "></span></a><span class="w">            </span>dim_param:<span class="w"> </span><span class="s2">&quot;I&quot;</span>
<a id="__codelineno-48-71" name="__codelineno-48-71"></a><a href="#__codelineno-48-71"><span class="linenos" data-linenos="71 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-48-72" name="__codelineno-48-72"></a><a href="#__codelineno-48-72"><span class="linenos" data-linenos="72 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-48-73" name="__codelineno-48-73"></a><a href="#__codelineno-48-73"><span class="linenos" data-linenos="73 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-48-74" name="__codelineno-48-74"></a><a href="#__codelineno-48-74"><span class="linenos" data-linenos="74 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-48-75" name="__codelineno-48-75"></a><a href="#__codelineno-48-75"><span class="linenos" data-linenos="75 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-48-76" name="__codelineno-48-76"></a><a href="#__codelineno-48-76"><span class="linenos" data-linenos="76 "></span></a><span class="w">  </span>value_info<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-77" name="__codelineno-48-77"></a><a href="#__codelineno-48-77"><span class="linenos" data-linenos="77 "></span></a><span class="w">    </span>name:<span class="w"> </span><span class="s2">&quot;XA&quot;</span>
<a id="__codelineno-48-78" name="__codelineno-48-78"></a><a href="#__codelineno-48-78"><span class="linenos" data-linenos="78 "></span></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-79" name="__codelineno-48-79"></a><a href="#__codelineno-48-79"><span class="linenos" data-linenos="79 "></span></a><span class="w">      </span>tensor_type<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-80" name="__codelineno-48-80"></a><a href="#__codelineno-48-80"><span class="linenos" data-linenos="80 "></span></a><span class="w">        </span>elem_type:<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-48-81" name="__codelineno-48-81"></a><a href="#__codelineno-48-81"><span class="linenos" data-linenos="81 "></span></a><span class="w">        </span>shape<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-82" name="__codelineno-48-82"></a><a href="#__codelineno-48-82"><span class="linenos" data-linenos="82 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-83" name="__codelineno-48-83"></a><a href="#__codelineno-48-83"><span class="linenos" data-linenos="83 "></span></a><span class="w">            </span>dim_param:<span class="w"> </span><span class="s2">&quot;I&quot;</span>
<a id="__codelineno-48-84" name="__codelineno-48-84"></a><a href="#__codelineno-48-84"><span class="linenos" data-linenos="84 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-48-85" name="__codelineno-48-85"></a><a href="#__codelineno-48-85"><span class="linenos" data-linenos="85 "></span></a><span class="w">          </span>dim<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-86" name="__codelineno-48-86"></a><a href="#__codelineno-48-86"><span class="linenos" data-linenos="86 "></span></a><span class="w">            </span>dim_value:<span class="w"> </span><span class="m">2</span>
<a id="__codelineno-48-87" name="__codelineno-48-87"></a><a href="#__codelineno-48-87"><span class="linenos" data-linenos="87 "></span></a><span class="w">          </span><span class="o">}</span>
<a id="__codelineno-48-88" name="__codelineno-48-88"></a><a href="#__codelineno-48-88"><span class="linenos" data-linenos="88 "></span></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-48-89" name="__codelineno-48-89"></a><a href="#__codelineno-48-89"><span class="linenos" data-linenos="89 "></span></a><span class="w">      </span><span class="o">}</span>
<a id="__codelineno-48-90" name="__codelineno-48-90"></a><a href="#__codelineno-48-90"><span class="linenos" data-linenos="90 "></span></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-48-91" name="__codelineno-48-91"></a><a href="#__codelineno-48-91"><span class="linenos" data-linenos="91 "></span></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-48-92" name="__codelineno-48-92"></a><a href="#__codelineno-48-92"><span class="linenos" data-linenos="92 "></span></a><span class="o">}</span>
<a id="__codelineno-48-93" name="__codelineno-48-93"></a><a href="#__codelineno-48-93"><span class="linenos" data-linenos="93 "></span></a>opset_import<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-48-94" name="__codelineno-48-94"></a><a href="#__codelineno-48-94"><span class="linenos" data-linenos="94 "></span></a><span class="w">  </span>domain:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-48-95" name="__codelineno-48-95"></a><a href="#__codelineno-48-95"><span class="linenos" data-linenos="95 "></span></a><span class="w">  </span>version:<span class="w"> </span><span class="m">15</span>
<a id="__codelineno-48-96" name="__codelineno-48-96"></a><a href="#__codelineno-48-96"><span class="linenos" data-linenos="96 "></span></a><span class="o">}</span>
</code></pre></div>
<p>有一个新的属性value_info用于存储推断的形状。字母I可以看作一个变量。它取决于输入，但函数能够判断哪个中间结果将共享相同的维度。形状推断并不总是有效。例如，Reshape 运算符。形状推断仅在形状恒定时才有效。如果不是恒定的，则除非以下节点需要特定形状，否则无法轻松推断形状。dim_param: "I"</p>
<h2 id="_18">评估和运行时</h2>
<p>ONNX 标准允许框架以 ONNX 格式导出经过训练的模型，并使用支持 ONNX 格式的任何后端进行推理。onnxruntime 是一种有效的选项。它适用于许多平台。它针对快速推理进行了优化。可以在ONNX后端仪表板上跟踪其覆盖范围 。onnx 实现了一个有助于理解模型的 Python 运行时。它不适用于生产，性能也不是目标。</p>
<h3 id="_19">线性回归的评估</h3>
<p>完整 API 描述于onnx.reference。它需要一个模型（ModelProto、文件名等）。方法run返回字典中指定的一组给定输入的输出。</p>
<p><div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><a href="#__codelineno-49-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><a href="#__codelineno-49-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">numpy_helper</span><span class="p">,</span> <span class="n">TensorProto</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a><a href="#__codelineno-49-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><a href="#__codelineno-49-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">set_model_props</span><span class="p">,</span> <span class="n">make_tensor</span><span class="p">,</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a><a href="#__codelineno-49-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">make_graph</span><span class="p">,</span> <span class="n">make_tensor_value_info</span><span class="p">)</span>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a><a href="#__codelineno-49-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a><a href="#__codelineno-49-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.reference</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReferenceEvaluator</span>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a><a href="#__codelineno-49-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-49-9" name="__codelineno-49-9"></a><a href="#__codelineno-49-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-49-10" name="__codelineno-49-10"></a><a href="#__codelineno-49-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-49-11" name="__codelineno-49-11"></a><a href="#__codelineno-49-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-49-12" name="__codelineno-49-12"></a><a href="#__codelineno-49-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-49-13" name="__codelineno-49-13"></a><a href="#__codelineno-49-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">node1</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">])</span>
<a id="__codelineno-49-14" name="__codelineno-49-14"></a><a href="#__codelineno-49-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-49-15" name="__codelineno-49-15"></a><a href="#__codelineno-49-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">([</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">],</span> <span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<a id="__codelineno-49-16" name="__codelineno-49-16"></a><a href="#__codelineno-49-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a id="__codelineno-49-17" name="__codelineno-49-17"></a><a href="#__codelineno-49-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-49-18" name="__codelineno-49-18"></a><a href="#__codelineno-49-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-49-19" name="__codelineno-49-19"></a><a href="#__codelineno-49-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">sess</span> <span class="o">=</span> <span class="n">ReferenceEvaluator</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-49-20" name="__codelineno-49-20"></a><a href="#__codelineno-49-20"><span class="linenos" data-linenos="20 "></span></a>
<a id="__codelineno-49-21" name="__codelineno-49-21"></a><a href="#__codelineno-49-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-49-22" name="__codelineno-49-22"></a><a href="#__codelineno-49-22"><span class="linenos" data-linenos="22 "></span></a><span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-49-23" name="__codelineno-49-23"></a><a href="#__codelineno-49-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-49-24" name="__codelineno-49-24"></a><a href="#__codelineno-49-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">feeds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="p">}</span>
<a id="__codelineno-49-25" name="__codelineno-49-25"></a><a href="#__codelineno-49-25"><span class="linenos" data-linenos="25 "></span></a>
<a id="__codelineno-49-26" name="__codelineno-49-26"></a><a href="#__codelineno-49-26"><span class="linenos" data-linenos="26 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">feeds</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><a href="#__codelineno-50-1"><span class="linenos" data-linenos="1 "></span></a><span class="o">[</span>array<span class="o">([[</span><span class="w"> </span><span class="m">3</span>.7574928<span class="o">]</span>,
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><a href="#__codelineno-50-2"><span class="linenos" data-linenos="2 "></span></a><span class="w">       </span><span class="o">[</span><span class="w"> </span><span class="m">1</span>.4951284<span class="o">]</span>,
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><a href="#__codelineno-50-3"><span class="linenos" data-linenos="3 "></span></a><span class="w">       </span><span class="o">[</span><span class="w"> </span><span class="m">1</span>.0837387<span class="o">]</span>,
<a id="__codelineno-50-4" name="__codelineno-50-4"></a><a href="#__codelineno-50-4"><span class="linenos" data-linenos="4 "></span></a><span class="w">       </span><span class="o">[</span>-0.7525861<span class="o">]]</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>float32<span class="o">)]</span>
</code></pre></div></p>
<h3 id="_20">节点评估</h3>
<p>评估者还可以评估一个简单节点来检查操作员对特定输入的行为。
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><a href="#__codelineno-51-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a><a href="#__codelineno-51-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">numpy_helper</span><span class="p">,</span> <span class="n">TensorProto</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a><a href="#__codelineno-51-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_node</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a><a href="#__codelineno-51-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a><a href="#__codelineno-51-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.reference</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReferenceEvaluator</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a><a href="#__codelineno-51-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a><a href="#__codelineno-51-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">node</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;EyeLike&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a><a href="#__codelineno-51-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a><a href="#__codelineno-51-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">sess</span> <span class="o">=</span> <span class="n">ReferenceEvaluator</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a><a href="#__codelineno-51-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a><a href="#__codelineno-51-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-51-12" name="__codelineno-51-12"></a><a href="#__codelineno-51-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">feeds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">}</span>
<a id="__codelineno-51-13" name="__codelineno-51-13"></a><a href="#__codelineno-51-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-51-14" name="__codelineno-51-14"></a><a href="#__codelineno-51-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">feeds</span><span class="p">))</span>
</code></pre></div></p>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><a href="#__codelineno-52-1"><span class="linenos" data-linenos="1 "></span></a><span class="o">[</span>array<span class="o">([[</span><span class="m">1</span>.,<span class="w"> </span><span class="m">0</span>.<span class="o">]</span>,
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><a href="#__codelineno-52-2"><span class="linenos" data-linenos="2 "></span></a><span class="w">       </span><span class="o">[</span><span class="m">0</span>.,<span class="w"> </span><span class="m">1</span>.<span class="o">]</span>,
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><a href="#__codelineno-52-3"><span class="linenos" data-linenos="3 "></span></a><span class="w">       </span><span class="o">[</span><span class="m">0</span>.,<span class="w"> </span><span class="m">0</span>.<span class="o">]</span>,
<a id="__codelineno-52-4" name="__codelineno-52-4"></a><a href="#__codelineno-52-4"><span class="linenos" data-linenos="4 "></span></a><span class="w">       </span><span class="o">[</span><span class="m">0</span>.,<span class="w"> </span><span class="m">0</span>.<span class="o">]]</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>float32<span class="o">)]</span>
</code></pre></div>
<p>类似的代码也适用于GraphProto或FunctionProto。</p>
<h3 id="_21">逐步评估</h3>
<p>转换库采用使用机器学习框架（pytorch、scikit-learn等）训练的现有模型，并将该模型转换为 ONNX 图。复杂模型通常不会在第一次尝试时起作用，查看中间结果可能有助于找到转换错误的部分。参数verbose显示有关中间结果的信息。</p>
<p><div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><a href="#__codelineno-53-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><a href="#__codelineno-53-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">numpy_helper</span><span class="p">,</span> <span class="n">TensorProto</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><a href="#__codelineno-53-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a><a href="#__codelineno-53-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">set_model_props</span><span class="p">,</span> <span class="n">make_tensor</span><span class="p">,</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a><a href="#__codelineno-53-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">make_graph</span><span class="p">,</span> <span class="n">make_tensor_value_info</span><span class="p">)</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a><a href="#__codelineno-53-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a><a href="#__codelineno-53-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.reference</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReferenceEvaluator</span>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a><a href="#__codelineno-53-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a><a href="#__codelineno-53-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a><a href="#__codelineno-53-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a><a href="#__codelineno-53-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a><a href="#__codelineno-53-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-53-13" name="__codelineno-53-13"></a><a href="#__codelineno-53-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">node1</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">])</span>
<a id="__codelineno-53-14" name="__codelineno-53-14"></a><a href="#__codelineno-53-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-53-15" name="__codelineno-53-15"></a><a href="#__codelineno-53-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">([</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">],</span> <span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<a id="__codelineno-53-16" name="__codelineno-53-16"></a><a href="#__codelineno-53-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a id="__codelineno-53-17" name="__codelineno-53-17"></a><a href="#__codelineno-53-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-53-18" name="__codelineno-53-18"></a><a href="#__codelineno-53-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-53-19" name="__codelineno-53-19"></a><a href="#__codelineno-53-19"><span class="linenos" data-linenos="19 "></span></a><span class="k">for</span> <span class="n">verbose</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
<a id="__codelineno-53-20" name="__codelineno-53-20"></a><a href="#__codelineno-53-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="nb">print</span><span class="p">()</span>
<a id="__codelineno-53-21" name="__codelineno-53-21"></a><a href="#__codelineno-53-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;------ verbose=</span><span class="si">{</span><span class="n">verbose</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-53-22" name="__codelineno-53-22"></a><a href="#__codelineno-53-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="nb">print</span><span class="p">()</span>
<a id="__codelineno-53-23" name="__codelineno-53-23"></a><a href="#__codelineno-53-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="n">sess</span> <span class="o">=</span> <span class="n">ReferenceEvaluator</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<a id="__codelineno-53-24" name="__codelineno-53-24"></a><a href="#__codelineno-53-24"><span class="linenos" data-linenos="24 "></span></a>
<a id="__codelineno-53-25" name="__codelineno-53-25"></a><a href="#__codelineno-53-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-53-26" name="__codelineno-53-26"></a><a href="#__codelineno-53-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-53-27" name="__codelineno-53-27"></a><a href="#__codelineno-53-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-53-28" name="__codelineno-53-28"></a><a href="#__codelineno-53-28"><span class="linenos" data-linenos="28 "></span></a>    <span class="n">feeds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="p">}</span>
<a id="__codelineno-53-29" name="__codelineno-53-29"></a><a href="#__codelineno-53-29"><span class="linenos" data-linenos="29 "></span></a>
<a id="__codelineno-53-30" name="__codelineno-53-30"></a><a href="#__codelineno-53-30"><span class="linenos" data-linenos="30 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">feeds</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><a href="#__codelineno-54-1"><span class="linenos" data-linenos=" 1 "></span></a>------<span class="w"> </span><span class="nv">verbose</span><span class="o">=</span><span class="m">1</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><a href="#__codelineno-54-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a><a href="#__codelineno-54-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="o">[</span>array<span class="o">([[</span>-3.0709705<span class="o">]</span>,
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><a href="#__codelineno-54-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">       </span><span class="o">[</span>-3.9643714<span class="o">]</span>,
<a id="__codelineno-54-5" name="__codelineno-54-5"></a><a href="#__codelineno-54-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">       </span><span class="o">[</span>-3.3978167<span class="o">]</span>,
<a id="__codelineno-54-6" name="__codelineno-54-6"></a><a href="#__codelineno-54-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">       </span><span class="o">[</span>-1.5986354<span class="o">]]</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>float32<span class="o">)]</span>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a><a href="#__codelineno-54-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a><a href="#__codelineno-54-8"><span class="linenos" data-linenos=" 8 "></span></a>------<span class="w"> </span><span class="nv">verbose</span><span class="o">=</span><span class="m">2</span>
<a id="__codelineno-54-9" name="__codelineno-54-9"></a><a href="#__codelineno-54-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a><a href="#__codelineno-54-10"><span class="linenos" data-linenos="10 "></span></a>MatMul<span class="o">(</span>X,<span class="w"> </span>A<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>XA
<a id="__codelineno-54-11" name="__codelineno-54-11"></a><a href="#__codelineno-54-11"><span class="linenos" data-linenos="11 "></span></a>Add<span class="o">(</span>XA,<span class="w"> </span>B<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>Y
<a id="__codelineno-54-12" name="__codelineno-54-12"></a><a href="#__codelineno-54-12"><span class="linenos" data-linenos="12 "></span></a><span class="o">[</span>array<span class="o">([[</span>-1.0014315<span class="o">]</span>,
<a id="__codelineno-54-13" name="__codelineno-54-13"></a><a href="#__codelineno-54-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">       </span><span class="o">[</span>-1.7232705<span class="o">]</span>,
<a id="__codelineno-54-14" name="__codelineno-54-14"></a><a href="#__codelineno-54-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">       </span><span class="o">[</span>-2.908271<span class="w"> </span><span class="o">]</span>,
<a id="__codelineno-54-15" name="__codelineno-54-15"></a><a href="#__codelineno-54-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">       </span><span class="o">[</span>-3.8357327<span class="o">]]</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>float32<span class="o">)]</span>
<a id="__codelineno-54-16" name="__codelineno-54-16"></a><a href="#__codelineno-54-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-54-17" name="__codelineno-54-17"></a><a href="#__codelineno-54-17"><span class="linenos" data-linenos="17 "></span></a>------<span class="w"> </span><span class="nv">verbose</span><span class="o">=</span><span class="m">3</span>
<a id="__codelineno-54-18" name="__codelineno-54-18"></a><a href="#__codelineno-54-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-54-19" name="__codelineno-54-19"></a><a href="#__codelineno-54-19"><span class="linenos" data-linenos="19 "></span></a><span class="w"> </span>+I<span class="w"> </span>X:<span class="w"> </span>float32:<span class="o">(</span><span class="m">4</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">[</span>-1.142913579940796,<span class="w"> </span><span class="m">0</span>.7031221985816956<span class="o">]</span>
<a id="__codelineno-54-20" name="__codelineno-54-20"></a><a href="#__codelineno-54-20"><span class="linenos" data-linenos="20 "></span></a><span class="w"> </span>+I<span class="w"> </span>A:<span class="w"> </span>float32:<span class="o">(</span><span class="m">2</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">[</span>-2.0527687072753906,<span class="w"> </span>-0.8769862055778503<span class="o">]</span>
<a id="__codelineno-54-21" name="__codelineno-54-21"></a><a href="#__codelineno-54-21"><span class="linenos" data-linenos="21 "></span></a><span class="w"> </span>+I<span class="w"> </span>B:<span class="w"> </span>float32:<span class="o">(</span><span class="m">1</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">[</span>-0.35991907119750977,<span class="w"> </span>-0.35991907119750977<span class="o">]</span>
<a id="__codelineno-54-22" name="__codelineno-54-22"></a><a href="#__codelineno-54-22"><span class="linenos" data-linenos="22 "></span></a>MatMul<span class="o">(</span>X,<span class="w"> </span>A<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>XA
<a id="__codelineno-54-23" name="__codelineno-54-23"></a><a href="#__codelineno-54-23"><span class="linenos" data-linenos="23 "></span></a><span class="w"> </span>+<span class="w"> </span>XA:<span class="w"> </span>float32:<span class="o">(</span><span class="m">4</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">[</span>-0.6025412678718567,<span class="w"> </span><span class="m">2</span>.241786003112793<span class="o">]</span>
<a id="__codelineno-54-24" name="__codelineno-54-24"></a><a href="#__codelineno-54-24"><span class="linenos" data-linenos="24 "></span></a>Add<span class="o">(</span>XA,<span class="w"> </span>B<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>Y
<a id="__codelineno-54-25" name="__codelineno-54-25"></a><a href="#__codelineno-54-25"><span class="linenos" data-linenos="25 "></span></a><span class="w"> </span>+<span class="w"> </span>Y:<span class="w"> </span>float32:<span class="o">(</span><span class="m">4</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">[</span>-0.9624603390693665,<span class="w"> </span><span class="m">1</span>.8818669319152832<span class="o">]</span>
<a id="__codelineno-54-26" name="__codelineno-54-26"></a><a href="#__codelineno-54-26"><span class="linenos" data-linenos="26 "></span></a><span class="o">[</span>array<span class="o">([[</span><span class="w"> </span><span class="m">1</span>.8818669<span class="w"> </span><span class="o">]</span>,
<a id="__codelineno-54-27" name="__codelineno-54-27"></a><a href="#__codelineno-54-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">       </span><span class="o">[</span>-0.96246034<span class="o">]</span>,
<a id="__codelineno-54-28" name="__codelineno-54-28"></a><a href="#__codelineno-54-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">       </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.6445193<span class="w"> </span><span class="o">]</span>,
<a id="__codelineno-54-29" name="__codelineno-54-29"></a><a href="#__codelineno-54-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">       </span><span class="o">[</span>-0.07070675<span class="o">]]</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>float32<span class="o">)]</span>
<a id="__codelineno-54-30" name="__codelineno-54-30"></a><a href="#__codelineno-54-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-54-31" name="__codelineno-54-31"></a><a href="#__codelineno-54-31"><span class="linenos" data-linenos="31 "></span></a>------<span class="w"> </span><span class="nv">verbose</span><span class="o">=</span><span class="m">4</span>
<a id="__codelineno-54-32" name="__codelineno-54-32"></a><a href="#__codelineno-54-32"><span class="linenos" data-linenos="32 "></span></a>
<a id="__codelineno-54-33" name="__codelineno-54-33"></a><a href="#__codelineno-54-33"><span class="linenos" data-linenos="33 "></span></a><span class="w"> </span>+I<span class="w"> </span>X:<span class="w"> </span>float32:<span class="o">(</span><span class="m">4</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>:0.3453322649002075,0.5269743800163269,0.43770021200180054,-0.9788240194320679,-0.2000599205493927...
<a id="__codelineno-54-34" name="__codelineno-54-34"></a><a href="#__codelineno-54-34"><span class="linenos" data-linenos="34 "></span></a><span class="w"> </span>+I<span class="w"> </span>A:<span class="w"> </span>float32:<span class="o">(</span><span class="m">2</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>:<span class="o">[</span>-0.567805826663971,<span class="w"> </span>-0.37489286065101624<span class="o">]</span>
<a id="__codelineno-54-35" name="__codelineno-54-35"></a><a href="#__codelineno-54-35"><span class="linenos" data-linenos="35 "></span></a><span class="w"> </span>+I<span class="w"> </span>B:<span class="w"> </span>float32:<span class="o">(</span><span class="m">1</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>:<span class="o">[</span><span class="m">0</span>.04381459206342697<span class="o">]</span>
<a id="__codelineno-54-36" name="__codelineno-54-36"></a><a href="#__codelineno-54-36"><span class="linenos" data-linenos="36 "></span></a>MatMul<span class="o">(</span>X,<span class="w"> </span>A<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>XA
<a id="__codelineno-54-37" name="__codelineno-54-37"></a><a href="#__codelineno-54-37"><span class="linenos" data-linenos="37 "></span></a><span class="w"> </span>+<span class="w"> </span>XA:<span class="w"> </span>float32:<span class="o">(</span><span class="m">4</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>:<span class="o">[</span>-0.3936406075954437,<span class="w"> </span><span class="m">0</span>.1184254139661789,<span class="w"> </span><span class="m">0</span>.5723494291305542,<span class="w"> </span><span class="m">0</span>.5118365287780762<span class="o">]</span>
<a id="__codelineno-54-38" name="__codelineno-54-38"></a><a href="#__codelineno-54-38"><span class="linenos" data-linenos="38 "></span></a>Add<span class="o">(</span>XA,<span class="w"> </span>B<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>Y
<a id="__codelineno-54-39" name="__codelineno-54-39"></a><a href="#__codelineno-54-39"><span class="linenos" data-linenos="39 "></span></a><span class="w"> </span>+<span class="w"> </span>Y:<span class="w"> </span>float32:<span class="o">(</span><span class="m">4</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>:<span class="o">[</span>-0.34982600808143616,<span class="w"> </span><span class="m">0</span>.16223999857902527,<span class="w"> </span><span class="m">0</span>.6161640286445618,<span class="w"> </span><span class="m">0</span>.5556511282920837<span class="o">]</span>
<a id="__codelineno-54-40" name="__codelineno-54-40"></a><a href="#__codelineno-54-40"><span class="linenos" data-linenos="40 "></span></a><span class="o">[</span>array<span class="o">([[</span>-0.349826<span class="w"> </span><span class="o">]</span>,
<a id="__codelineno-54-41" name="__codelineno-54-41"></a><a href="#__codelineno-54-41"><span class="linenos" data-linenos="41 "></span></a><span class="w">       </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.16224<span class="w">  </span><span class="o">]</span>,
<a id="__codelineno-54-42" name="__codelineno-54-42"></a><a href="#__codelineno-54-42"><span class="linenos" data-linenos="42 "></span></a><span class="w">       </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.616164<span class="w"> </span><span class="o">]</span>,
<a id="__codelineno-54-43" name="__codelineno-54-43"></a><a href="#__codelineno-54-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">       </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.5556511<span class="o">]]</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>float32<span class="o">)]</span>
</code></pre></div></p>
<h3 id="_22">评估自定义节点</h3>
<p>下面的例子仍然实现线性回归，但是将单位矩阵添加到A：</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><a href="#__codelineno-55-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><a href="#__codelineno-55-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">numpy_helper</span><span class="p">,</span> <span class="n">TensorProto</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a><a href="#__codelineno-55-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a><a href="#__codelineno-55-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">set_model_props</span><span class="p">,</span> <span class="n">make_tensor</span><span class="p">,</span>
<a id="__codelineno-55-5" name="__codelineno-55-5"></a><a href="#__codelineno-55-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">make_graph</span><span class="p">,</span> <span class="n">make_tensor_value_info</span><span class="p">)</span>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a><a href="#__codelineno-55-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-55-7" name="__codelineno-55-7"></a><a href="#__codelineno-55-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.reference</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReferenceEvaluator</span>
<a id="__codelineno-55-8" name="__codelineno-55-8"></a><a href="#__codelineno-55-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-55-9" name="__codelineno-55-9"></a><a href="#__codelineno-55-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-55-10" name="__codelineno-55-10"></a><a href="#__codelineno-55-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-55-11" name="__codelineno-55-11"></a><a href="#__codelineno-55-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-55-12" name="__codelineno-55-12"></a><a href="#__codelineno-55-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-55-13" name="__codelineno-55-13"></a><a href="#__codelineno-55-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">node0</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;EyeLike&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Eye&#39;</span><span class="p">])</span>
<a id="__codelineno-55-14" name="__codelineno-55-14"></a><a href="#__codelineno-55-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">node1</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;Eye&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">])</span>
<a id="__codelineno-55-15" name="__codelineno-55-15"></a><a href="#__codelineno-55-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A1&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;XA1&#39;</span><span class="p">])</span>
<a id="__codelineno-55-16" name="__codelineno-55-16"></a><a href="#__codelineno-55-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">node3</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;XA1&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-55-17" name="__codelineno-55-17"></a><a href="#__codelineno-55-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">([</span><span class="n">node0</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">node3</span><span class="p">],</span> <span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<a id="__codelineno-55-18" name="__codelineno-55-18"></a><a href="#__codelineno-55-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a id="__codelineno-55-19" name="__codelineno-55-19"></a><a href="#__codelineno-55-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-55-20" name="__codelineno-55-20"></a><a href="#__codelineno-55-20"><span class="linenos" data-linenos="20 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;linear_regression.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-55-21" name="__codelineno-55-21"></a><a href="#__codelineno-55-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<a id="__codelineno-55-22" name="__codelineno-55-22"></a><a href="#__codelineno-55-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-55-23" name="__codelineno-55-23"></a><a href="#__codelineno-55-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">sess</span> <span class="o">=</span> <span class="n">ReferenceEvaluator</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-55-24" name="__codelineno-55-24"></a><a href="#__codelineno-55-24"><span class="linenos" data-linenos="24 "></span></a>
<a id="__codelineno-55-25" name="__codelineno-55-25"></a><a href="#__codelineno-55-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-55-26" name="__codelineno-55-26"></a><a href="#__codelineno-55-26"><span class="linenos" data-linenos="26 "></span></a><span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>
<a id="__codelineno-55-27" name="__codelineno-55-27"></a><a href="#__codelineno-55-27"><span class="linenos" data-linenos="27 "></span></a><span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-55-28" name="__codelineno-55-28"></a><a href="#__codelineno-55-28"><span class="linenos" data-linenos="28 "></span></a><span class="n">feeds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="p">}</span>
<a id="__codelineno-55-29" name="__codelineno-55-29"></a><a href="#__codelineno-55-29"><span class="linenos" data-linenos="29 "></span></a>
<a id="__codelineno-55-30" name="__codelineno-55-30"></a><a href="#__codelineno-55-30"><span class="linenos" data-linenos="30 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">feeds</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><a href="#__codelineno-56-1"><span class="linenos" data-linenos="1 "></span></a>EyeLike<span class="o">(</span>A<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>Eye
<a id="__codelineno-56-2" name="__codelineno-56-2"></a><a href="#__codelineno-56-2"><span class="linenos" data-linenos="2 "></span></a>Add<span class="o">(</span>A,<span class="w"> </span>Eye<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>A1
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><a href="#__codelineno-56-3"><span class="linenos" data-linenos="3 "></span></a>MatMul<span class="o">(</span>X,<span class="w"> </span>A1<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>XA1
<a id="__codelineno-56-4" name="__codelineno-56-4"></a><a href="#__codelineno-56-4"><span class="linenos" data-linenos="4 "></span></a>Add<span class="o">(</span>XA1,<span class="w"> </span>B<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>Y
<a id="__codelineno-56-5" name="__codelineno-56-5"></a><a href="#__codelineno-56-5"><span class="linenos" data-linenos="5 "></span></a><span class="o">[</span>array<span class="o">([[</span><span class="w"> </span><span class="m">2</span>.1372705<span class="w"> </span>,<span class="w">  </span><span class="m">1</span>.7686903<span class="w"> </span><span class="o">]</span>,
<a id="__codelineno-56-6" name="__codelineno-56-6"></a><a href="#__codelineno-56-6"><span class="linenos" data-linenos="6 "></span></a><span class="w">       </span><span class="o">[</span>-0.6369117<span class="w"> </span>,<span class="w"> </span>-0.00957918<span class="o">]</span>,
<a id="__codelineno-56-7" name="__codelineno-56-7"></a><a href="#__codelineno-56-7"><span class="linenos" data-linenos="7 "></span></a><span class="w">       </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.8815058<span class="w"> </span>,<span class="w">  </span><span class="m">1</span>.8614801<span class="w"> </span><span class="o">]</span>,
<a id="__codelineno-56-8" name="__codelineno-56-8"></a><a href="#__codelineno-56-8"><span class="linenos" data-linenos="8 "></span></a><span class="w">       </span><span class="o">[</span><span class="w"> </span><span class="m">2</span>.529335<span class="w">  </span>,<span class="w">  </span><span class="m">3</span>.9602785<span class="w"> </span><span class="o">]]</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>float32<span class="o">)]</span>
</code></pre></div>
<p>如果我们将EyeLike和Add运算符组合成AddEyeLike会怎样？这会使其更加高效。下一个示例将这两个运算符替换为域中的一个运算符'optimized'。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><a href="#__codelineno-57-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><a href="#__codelineno-57-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">numpy_helper</span><span class="p">,</span> <span class="n">TensorProto</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a><a href="#__codelineno-57-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a><a href="#__codelineno-57-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">set_model_props</span><span class="p">,</span> <span class="n">make_tensor</span><span class="p">,</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a><a href="#__codelineno-57-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">make_graph</span><span class="p">,</span> <span class="n">make_tensor_value_info</span><span class="p">,</span> <span class="n">make_opsetid</span><span class="p">)</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a><a href="#__codelineno-57-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a><a href="#__codelineno-57-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-57-8" name="__codelineno-57-8"></a><a href="#__codelineno-57-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-57-9" name="__codelineno-57-9"></a><a href="#__codelineno-57-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-57-10" name="__codelineno-57-10"></a><a href="#__codelineno-57-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">B</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-57-11" name="__codelineno-57-11"></a><a href="#__codelineno-57-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-57-12" name="__codelineno-57-12"></a><a href="#__codelineno-57-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-57-13" name="__codelineno-57-13"></a><a href="#__codelineno-57-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">node01</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;AddEyeLike&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;optimized&#39;</span><span class="p">)</span>
<a id="__codelineno-57-14" name="__codelineno-57-14"></a><a href="#__codelineno-57-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-57-15" name="__codelineno-57-15"></a><a href="#__codelineno-57-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A1&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;XA1&#39;</span><span class="p">])</span>
<a id="__codelineno-57-16" name="__codelineno-57-16"></a><a href="#__codelineno-57-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">node3</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;XA1&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-57-17" name="__codelineno-57-17"></a><a href="#__codelineno-57-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">([</span><span class="n">node01</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">node3</span><span class="p">],</span> <span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<a id="__codelineno-57-18" name="__codelineno-57-18"></a><a href="#__codelineno-57-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-57-19" name="__codelineno-57-19"></a><a href="#__codelineno-57-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">opset_imports</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-57-20" name="__codelineno-57-20"></a><a href="#__codelineno-57-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="n">make_opsetid</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span> <span class="n">make_opsetid</span><span class="p">(</span><span class="s1">&#39;optimized&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-57-21" name="__codelineno-57-21"></a><a href="#__codelineno-57-21"><span class="linenos" data-linenos="21 "></span></a><span class="p">])</span>
<a id="__codelineno-57-22" name="__codelineno-57-22"></a><a href="#__codelineno-57-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-57-23" name="__codelineno-57-23"></a><a href="#__codelineno-57-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-57-24" name="__codelineno-57-24"></a><a href="#__codelineno-57-24"><span class="linenos" data-linenos="24 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;linear_regression_improved.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-57-25" name="__codelineno-57-25"></a><a href="#__codelineno-57-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
</code></pre></div>
<p>我们需要评估这个模型是否等同于第一个模型。这需要针对这个特定节点进行实现。
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><a href="#__codelineno-58-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><a href="#__codelineno-58-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.reference</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReferenceEvaluator</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><a href="#__codelineno-58-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.reference.op_run</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpRun</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><a href="#__codelineno-58-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a><a href="#__codelineno-58-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">AddEyeLike</span><span class="p">(</span><span class="n">OpRun</span><span class="p">):</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a><a href="#__codelineno-58-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a><a href="#__codelineno-58-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">op_domain</span> <span class="o">=</span> <span class="s2">&quot;optimized&quot;</span>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a><a href="#__codelineno-58-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-58-9" name="__codelineno-58-9"></a><a href="#__codelineno-58-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
<a id="__codelineno-58-10" name="__codelineno-58-10"></a><a href="#__codelineno-58-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-58-11" name="__codelineno-58-11"></a><a href="#__codelineno-58-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="k">assert</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-58-12" name="__codelineno-58-12"></a><a href="#__codelineno-58-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-58-13" name="__codelineno-58-13"></a><a href="#__codelineno-58-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diag_indices</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-58-14" name="__codelineno-58-14"></a><a href="#__codelineno-58-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">X</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+=</span> <span class="n">alpha</span>
<a id="__codelineno-58-15" name="__codelineno-58-15"></a><a href="#__codelineno-58-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">X</span><span class="p">,)</span>
<a id="__codelineno-58-16" name="__codelineno-58-16"></a><a href="#__codelineno-58-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-58-17" name="__codelineno-58-17"></a><a href="#__codelineno-58-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">sess</span> <span class="o">=</span> <span class="n">ReferenceEvaluator</span><span class="p">(</span><span class="s2">&quot;linear_regression_improved.onnx&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_ops</span><span class="o">=</span><span class="p">[</span><span class="n">AddEyeLike</span><span class="p">])</span>
<a id="__codelineno-58-18" name="__codelineno-58-18"></a><a href="#__codelineno-58-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-58-19" name="__codelineno-58-19"></a><a href="#__codelineno-58-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-58-20" name="__codelineno-58-20"></a><a href="#__codelineno-58-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>
<a id="__codelineno-58-21" name="__codelineno-58-21"></a><a href="#__codelineno-58-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-58-22" name="__codelineno-58-22"></a><a href="#__codelineno-58-22"><span class="linenos" data-linenos="22 "></span></a><span class="n">feeds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="p">}</span>
<a id="__codelineno-58-23" name="__codelineno-58-23"></a><a href="#__codelineno-58-23"><span class="linenos" data-linenos="23 "></span></a>
<a id="__codelineno-58-24" name="__codelineno-58-24"></a><a href="#__codelineno-58-24"><span class="linenos" data-linenos="24 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">feeds</span><span class="p">))</span>
<a id="__codelineno-58-25" name="__codelineno-58-25"></a><a href="#__codelineno-58-25"><span class="linenos" data-linenos="25 "></span></a>
<a id="__codelineno-58-26" name="__codelineno-58-26"></a><a href="#__codelineno-58-26"><span class="linenos" data-linenos="26 "></span></a><span class="c1"># Let&#39;s check with the previous model.</span>
<a id="__codelineno-58-27" name="__codelineno-58-27"></a><a href="#__codelineno-58-27"><span class="linenos" data-linenos="27 "></span></a>
<a id="__codelineno-58-28" name="__codelineno-58-28"></a><a href="#__codelineno-58-28"><span class="linenos" data-linenos="28 "></span></a><span class="n">sess0</span> <span class="o">=</span> <span class="n">ReferenceEvaluator</span><span class="p">(</span><span class="s2">&quot;linear_regression.onnx&quot;</span><span class="p">,)</span>
<a id="__codelineno-58-29" name="__codelineno-58-29"></a><a href="#__codelineno-58-29"><span class="linenos" data-linenos="29 "></span></a><span class="n">sess1</span> <span class="o">=</span> <span class="n">ReferenceEvaluator</span><span class="p">(</span><span class="s2">&quot;linear_regression_improved.onnx&quot;</span><span class="p">,</span> <span class="n">new_ops</span><span class="o">=</span><span class="p">[</span><span class="n">AddEyeLike</span><span class="p">])</span>
<a id="__codelineno-58-30" name="__codelineno-58-30"></a><a href="#__codelineno-58-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-58-31" name="__codelineno-58-31"></a><a href="#__codelineno-58-31"><span class="linenos" data-linenos="31 "></span></a><span class="n">y0</span> <span class="o">=</span> <span class="n">sess0</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">feeds</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-58-32" name="__codelineno-58-32"></a><a href="#__codelineno-58-32"><span class="linenos" data-linenos="32 "></span></a><span class="n">y1</span> <span class="o">=</span> <span class="n">sess1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">feeds</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-58-33" name="__codelineno-58-33"></a><a href="#__codelineno-58-33"><span class="linenos" data-linenos="33 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">y0</span><span class="p">)</span>
<a id="__codelineno-58-34" name="__codelineno-58-34"></a><a href="#__codelineno-58-34"><span class="linenos" data-linenos="34 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<a id="__codelineno-58-35" name="__codelineno-58-35"></a><a href="#__codelineno-58-35"><span class="linenos" data-linenos="35 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;difference: </span><span class="si">{</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p><div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><a href="#__codelineno-59-1"><span class="linenos" data-linenos=" 1 "></span></a>AddEyeLike<span class="o">(</span>A<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>A1
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><a href="#__codelineno-59-2"><span class="linenos" data-linenos=" 2 "></span></a>MatMul<span class="o">(</span>X,<span class="w"> </span>A1<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>XA1
<a id="__codelineno-59-3" name="__codelineno-59-3"></a><a href="#__codelineno-59-3"><span class="linenos" data-linenos=" 3 "></span></a>Add<span class="o">(</span>XA1,<span class="w"> </span>B<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>Y
<a id="__codelineno-59-4" name="__codelineno-59-4"></a><a href="#__codelineno-59-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="o">[</span>array<span class="o">([[</span>-1.2722642<span class="w"> </span>,<span class="w"> </span>-0.1207931<span class="w"> </span><span class="o">]</span>,
<a id="__codelineno-59-5" name="__codelineno-59-5"></a><a href="#__codelineno-59-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">       </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.64181894,<span class="w">  </span><span class="m">0</span>.47749406<span class="o">]</span>,
<a id="__codelineno-59-6" name="__codelineno-59-6"></a><a href="#__codelineno-59-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">       </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.47565097,<span class="w">  </span><span class="m">1</span>.2095331<span class="w"> </span><span class="o">]</span>,
<a id="__codelineno-59-7" name="__codelineno-59-7"></a><a href="#__codelineno-59-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">       </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.2499994<span class="w"> </span>,<span class="w">  </span><span class="m">3</span>.6677973<span class="w"> </span><span class="o">]]</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>float32<span class="o">)]</span>
<a id="__codelineno-59-8" name="__codelineno-59-8"></a><a href="#__codelineno-59-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="o">[[</span>-1.2722642<span class="w">  </span>-0.1207931<span class="w"> </span><span class="o">]</span>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a><a href="#__codelineno-59-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.64181894<span class="w">  </span><span class="m">0</span>.47749406<span class="o">]</span>
<a id="__codelineno-59-10" name="__codelineno-59-10"></a><a href="#__codelineno-59-10"><span class="linenos" data-linenos="10 "></span></a><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.47565097<span class="w">  </span><span class="m">1</span>.2095331<span class="w"> </span><span class="o">]</span>
<a id="__codelineno-59-11" name="__codelineno-59-11"></a><a href="#__codelineno-59-11"><span class="linenos" data-linenos="11 "></span></a><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.2499994<span class="w">   </span><span class="m">3</span>.6677973<span class="w"> </span><span class="o">]]</span>
<a id="__codelineno-59-12" name="__codelineno-59-12"></a><a href="#__codelineno-59-12"><span class="linenos" data-linenos="12 "></span></a><span class="o">[[</span>-1.2722642<span class="w">  </span>-0.1207931<span class="w"> </span><span class="o">]</span>
<a id="__codelineno-59-13" name="__codelineno-59-13"></a><a href="#__codelineno-59-13"><span class="linenos" data-linenos="13 "></span></a><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.64181894<span class="w">  </span><span class="m">0</span>.47749406<span class="o">]</span>
<a id="__codelineno-59-14" name="__codelineno-59-14"></a><a href="#__codelineno-59-14"><span class="linenos" data-linenos="14 "></span></a><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.47565097<span class="w">  </span><span class="m">1</span>.2095331<span class="w"> </span><span class="o">]</span>
<a id="__codelineno-59-15" name="__codelineno-59-15"></a><a href="#__codelineno-59-15"><span class="linenos" data-linenos="15 "></span></a><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>.2499994<span class="w">   </span><span class="m">3</span>.6677973<span class="w"> </span><span class="o">]]</span>
<a id="__codelineno-59-16" name="__codelineno-59-16"></a><a href="#__codelineno-59-16"><span class="linenos" data-linenos="16 "></span></a>difference:<span class="w"> </span><span class="m">0</span>.0
</code></pre></div>
预测是相同的。让我们在一个足够大的矩阵上比较一下性能，以发现显著的差异。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><a href="#__codelineno-60-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">timeit</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><a href="#__codelineno-60-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><a href="#__codelineno-60-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.reference</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReferenceEvaluator</span>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a><a href="#__codelineno-60-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.reference.op_run</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpRun</span>
<a id="__codelineno-60-5" name="__codelineno-60-5"></a><a href="#__codelineno-60-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-60-6" name="__codelineno-60-6"></a><a href="#__codelineno-60-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">AddEyeLike</span><span class="p">(</span><span class="n">OpRun</span><span class="p">):</span>
<a id="__codelineno-60-7" name="__codelineno-60-7"></a><a href="#__codelineno-60-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-60-8" name="__codelineno-60-8"></a><a href="#__codelineno-60-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">op_domain</span> <span class="o">=</span> <span class="s2">&quot;optimized&quot;</span>
<a id="__codelineno-60-9" name="__codelineno-60-9"></a><a href="#__codelineno-60-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-60-10" name="__codelineno-60-10"></a><a href="#__codelineno-60-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
<a id="__codelineno-60-11" name="__codelineno-60-11"></a><a href="#__codelineno-60-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-60-12" name="__codelineno-60-12"></a><a href="#__codelineno-60-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="k">assert</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-60-13" name="__codelineno-60-13"></a><a href="#__codelineno-60-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-60-14" name="__codelineno-60-14"></a><a href="#__codelineno-60-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diag_indices</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-60-15" name="__codelineno-60-15"></a><a href="#__codelineno-60-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="n">X</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+=</span> <span class="n">alpha</span>
<a id="__codelineno-60-16" name="__codelineno-60-16"></a><a href="#__codelineno-60-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">X</span><span class="p">,)</span>
<a id="__codelineno-60-17" name="__codelineno-60-17"></a><a href="#__codelineno-60-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-60-18" name="__codelineno-60-18"></a><a href="#__codelineno-60-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">sess</span> <span class="o">=</span> <span class="n">ReferenceEvaluator</span><span class="p">(</span><span class="s2">&quot;linear_regression_improved.onnx&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_ops</span><span class="o">=</span><span class="p">[</span><span class="n">AddEyeLike</span><span class="p">])</span>
<a id="__codelineno-60-19" name="__codelineno-60-19"></a><a href="#__codelineno-60-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-60-20" name="__codelineno-60-20"></a><a href="#__codelineno-60-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-60-21" name="__codelineno-60-21"></a><a href="#__codelineno-60-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>
<a id="__codelineno-60-22" name="__codelineno-60-22"></a><a href="#__codelineno-60-22"><span class="linenos" data-linenos="22 "></span></a><span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-60-23" name="__codelineno-60-23"></a><a href="#__codelineno-60-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">feeds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="p">}</span>
<a id="__codelineno-60-24" name="__codelineno-60-24"></a><a href="#__codelineno-60-24"><span class="linenos" data-linenos="24 "></span></a>
<a id="__codelineno-60-25" name="__codelineno-60-25"></a><a href="#__codelineno-60-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">sess0</span> <span class="o">=</span> <span class="n">ReferenceEvaluator</span><span class="p">(</span><span class="s2">&quot;linear_regression.onnx&quot;</span><span class="p">)</span>
<a id="__codelineno-60-26" name="__codelineno-60-26"></a><a href="#__codelineno-60-26"><span class="linenos" data-linenos="26 "></span></a><span class="n">sess1</span> <span class="o">=</span> <span class="n">ReferenceEvaluator</span><span class="p">(</span><span class="s2">&quot;linear_regression_improved.onnx&quot;</span><span class="p">,</span> <span class="n">new_ops</span><span class="o">=</span><span class="p">[</span><span class="n">AddEyeLike</span><span class="p">])</span>
<a id="__codelineno-60-27" name="__codelineno-60-27"></a><a href="#__codelineno-60-27"><span class="linenos" data-linenos="27 "></span></a>
<a id="__codelineno-60-28" name="__codelineno-60-28"></a><a href="#__codelineno-60-28"><span class="linenos" data-linenos="28 "></span></a><span class="n">y0</span> <span class="o">=</span> <span class="n">sess0</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">feeds</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-60-29" name="__codelineno-60-29"></a><a href="#__codelineno-60-29"><span class="linenos" data-linenos="29 "></span></a><span class="n">y1</span> <span class="o">=</span> <span class="n">sess1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">feeds</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-60-30" name="__codelineno-60-30"></a><a href="#__codelineno-60-30"><span class="linenos" data-linenos="30 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;difference: </span><span class="si">{</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-60-31" name="__codelineno-60-31"></a><a href="#__codelineno-60-31"><span class="linenos" data-linenos="31 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;time with EyeLike+Add: </span><span class="si">{</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="w"> </span><span class="n">sess0</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="w"> </span><span class="n">feeds</span><span class="p">),</span><span class="w"> </span><span class="n">number</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-60-32" name="__codelineno-60-32"></a><a href="#__codelineno-60-32"><span class="linenos" data-linenos="32 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;time with AddEyeLike: </span><span class="si">{</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="w"> </span><span class="n">sess1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="w"> </span><span class="n">feeds</span><span class="p">),</span><span class="w"> </span><span class="n">number</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><a href="#__codelineno-61-1"><span class="linenos" data-linenos="1 "></span></a>difference:<span class="w"> </span><span class="m">0</span>.0
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><a href="#__codelineno-61-2"><span class="linenos" data-linenos="2 "></span></a><span class="nb">time</span><span class="w"> </span>with<span class="w"> </span>EyeLike+Add:<span class="w"> </span><span class="m">0</span>.08985151199999564
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><a href="#__codelineno-61-3"><span class="linenos" data-linenos="3 "></span></a><span class="nb">time</span><span class="w"> </span>with<span class="w"> </span>AddEyeLike:<span class="w"> </span><span class="m">0</span>.0732065079999984
</code></pre></div>
<p>在这种情况下，似乎值得添加一个优化节点。这种优化通常称为融合。两个连续的运算符被融合成两者的优化版本。生产通常依赖于onnxruntime，但由于优化使用基本矩阵运算，因此它应该在任何其他运行时上带来相同的性能提升。</p>
<h2 id="_23">实现细节</h2>
<h3 id="python-c">Python 和 C++</h3>
<p>onnx 依赖 protobuf 来定义其类型。您可能会认为 python 对象只是内部结构上 C 指针的包装器。因此，应该可以从接收类型 的 python 对象的函数访问内部数据ModelProto。但事实并非如此。根据 Protobuf 4 的更改，在版本 4 之后这不再可能，更安全的假设是获取内容的唯一方法是将模型序列化为字节，将其提供给 C 函数，然后对其进行反序列化。在使用 C 代码检查模型之前，check_model或之 类的函数shape_inference会调用SerializeToStringthen 。ParseFromString</p>
<h3 id="_24">属性和输入</h3>
<p>两者之间有明显的区别。输入是动态的，每次执行时都可能发生变化。属性永远不会改变，优化器可以假设它永远不会改变，从而改进执行图。因此，不可能将输入转换为属性。运算符Constant是唯一将属性转换为输入的运算符。</p>
<h3 id="_25">有形或无形</h3>
<p>onnx 通常假设已知秩（或维数），并期望每个输入或输出都有一个形状。如果我们需要为每个维度创建一个有效的图怎么办？这种情况仍然令人费解。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><a href="#__codelineno-62-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><a href="#__codelineno-62-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">numpy_helper</span><span class="p">,</span> <span class="n">TensorProto</span><span class="p">,</span> <span class="n">FunctionProto</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a><a href="#__codelineno-62-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a><a href="#__codelineno-62-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">make_model</span><span class="p">,</span> <span class="n">make_node</span><span class="p">,</span> <span class="n">set_model_props</span><span class="p">,</span> <span class="n">make_tensor</span><span class="p">,</span>
<a id="__codelineno-62-5" name="__codelineno-62-5"></a><a href="#__codelineno-62-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">make_graph</span><span class="p">,</span> <span class="n">make_tensor_value_info</span><span class="p">,</span> <span class="n">make_opsetid</span><span class="p">,</span>
<a id="__codelineno-62-6" name="__codelineno-62-6"></a><a href="#__codelineno-62-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">make_function</span><span class="p">)</span>
<a id="__codelineno-62-7" name="__codelineno-62-7"></a><a href="#__codelineno-62-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx.checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_model</span>
<a id="__codelineno-62-8" name="__codelineno-62-8"></a><a href="#__codelineno-62-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnxruntime</span><span class="w"> </span><span class="kn">import</span> <span class="n">InferenceSession</span>
<a id="__codelineno-62-9" name="__codelineno-62-9"></a><a href="#__codelineno-62-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-62-10" name="__codelineno-62-10"></a><a href="#__codelineno-62-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_model</span><span class="p">(</span><span class="n">shapes</span><span class="p">):</span>
<a id="__codelineno-62-11" name="__codelineno-62-11"></a><a href="#__codelineno-62-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">new_domain</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
<a id="__codelineno-62-12" name="__codelineno-62-12"></a><a href="#__codelineno-62-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">opset_imports</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_opsetid</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="n">make_opsetid</span><span class="p">(</span><span class="n">new_domain</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<a id="__codelineno-62-13" name="__codelineno-62-13"></a><a href="#__codelineno-62-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-62-14" name="__codelineno-62-14"></a><a href="#__codelineno-62-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">node1</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">])</span>
<a id="__codelineno-62-15" name="__codelineno-62-15"></a><a href="#__codelineno-62-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">node2</span> <span class="o">=</span> <span class="n">make_node</span><span class="p">(</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;XA&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-62-16" name="__codelineno-62-16"></a><a href="#__codelineno-62-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-62-17" name="__codelineno-62-17"></a><a href="#__codelineno-62-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">X</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">shapes</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
<a id="__codelineno-62-18" name="__codelineno-62-18"></a><a href="#__codelineno-62-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">A</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">shapes</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">])</span>
<a id="__codelineno-62-19" name="__codelineno-62-19"></a><a href="#__codelineno-62-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">Y</span> <span class="o">=</span> <span class="n">make_tensor_value_info</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">TensorProto</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">shapes</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<a id="__codelineno-62-20" name="__codelineno-62-20"></a><a href="#__codelineno-62-20"><span class="linenos" data-linenos="20 "></span></a>
<a id="__codelineno-62-21" name="__codelineno-62-21"></a><a href="#__codelineno-62-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">graph</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">([</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">],</span> <span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">A</span><span class="p">],</span> <span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<a id="__codelineno-62-22" name="__codelineno-62-22"></a><a href="#__codelineno-62-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-62-23" name="__codelineno-62-23"></a><a href="#__codelineno-62-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="n">onnx_model</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">opset_imports</span><span class="o">=</span><span class="n">opset_imports</span><span class="p">)</span>
<a id="__codelineno-62-24" name="__codelineno-62-24"></a><a href="#__codelineno-62-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="c1"># Let models runnable by onnxruntime with a released ir_version</span>
<a id="__codelineno-62-25" name="__codelineno-62-25"></a><a href="#__codelineno-62-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="n">onnx_model</span><span class="o">.</span><span class="n">ir_version</span> <span class="o">=</span> <span class="mi">8</span>
<a id="__codelineno-62-26" name="__codelineno-62-26"></a><a href="#__codelineno-62-26"><span class="linenos" data-linenos="26 "></span></a>
<a id="__codelineno-62-27" name="__codelineno-62-27"></a><a href="#__codelineno-62-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="k">return</span> <span class="n">onnx_model</span>
<a id="__codelineno-62-28" name="__codelineno-62-28"></a><a href="#__codelineno-62-28"><span class="linenos" data-linenos="28 "></span></a>
<a id="__codelineno-62-29" name="__codelineno-62-29"></a><a href="#__codelineno-62-29"><span class="linenos" data-linenos="29 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------- case 1: 2D x 2D -&gt; 2D&quot;</span><span class="p">)</span>
<a id="__codelineno-62-30" name="__codelineno-62-30"></a><a href="#__codelineno-62-30"><span class="linenos" data-linenos="30 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]})</span>
<a id="__codelineno-62-31" name="__codelineno-62-31"></a><a href="#__codelineno-62-31"><span class="linenos" data-linenos="31 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-62-32" name="__codelineno-62-32"></a><a href="#__codelineno-62-32"><span class="linenos" data-linenos="32 "></span></a><span class="n">sess</span> <span class="o">=</span> <span class="n">InferenceSession</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">(),</span>
<a id="__codelineno-62-33" name="__codelineno-62-33"></a><a href="#__codelineno-62-33"><span class="linenos" data-linenos="33 "></span></a>                        <span class="n">providers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CPUExecutionProvider&quot;</span><span class="p">])</span>
<a id="__codelineno-62-34" name="__codelineno-62-34"></a><a href="#__codelineno-62-34"><span class="linenos" data-linenos="34 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{</span>
<a id="__codelineno-62-35" name="__codelineno-62-35"></a><a href="#__codelineno-62-35"><span class="linenos" data-linenos="35 "></span></a>    <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<a id="__codelineno-62-36" name="__codelineno-62-36"></a><a href="#__codelineno-62-36"><span class="linenos" data-linenos="36 "></span></a>    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)})</span>
<a id="__codelineno-62-37" name="__codelineno-62-37"></a><a href="#__codelineno-62-37"><span class="linenos" data-linenos="37 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="__codelineno-62-38" name="__codelineno-62-38"></a><a href="#__codelineno-62-38"><span class="linenos" data-linenos="38 "></span></a>
<a id="__codelineno-62-39" name="__codelineno-62-39"></a><a href="#__codelineno-62-39"><span class="linenos" data-linenos="39 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------- case 2: 2D x 1D -&gt; 1D&quot;</span><span class="p">)</span>
<a id="__codelineno-62-40" name="__codelineno-62-40"></a><a href="#__codelineno-62-40"><span class="linenos" data-linenos="40 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]})</span>
<a id="__codelineno-62-41" name="__codelineno-62-41"></a><a href="#__codelineno-62-41"><span class="linenos" data-linenos="41 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-62-42" name="__codelineno-62-42"></a><a href="#__codelineno-62-42"><span class="linenos" data-linenos="42 "></span></a><span class="n">sess</span> <span class="o">=</span> <span class="n">InferenceSession</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">(),</span>
<a id="__codelineno-62-43" name="__codelineno-62-43"></a><a href="#__codelineno-62-43"><span class="linenos" data-linenos="43 "></span></a>                        <span class="n">providers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CPUExecutionProvider&quot;</span><span class="p">])</span>
<a id="__codelineno-62-44" name="__codelineno-62-44"></a><a href="#__codelineno-62-44"><span class="linenos" data-linenos="44 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{</span>
<a id="__codelineno-62-45" name="__codelineno-62-45"></a><a href="#__codelineno-62-45"><span class="linenos" data-linenos="45 "></span></a>    <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<a id="__codelineno-62-46" name="__codelineno-62-46"></a><a href="#__codelineno-62-46"><span class="linenos" data-linenos="46 "></span></a>    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)})</span>
<a id="__codelineno-62-47" name="__codelineno-62-47"></a><a href="#__codelineno-62-47"><span class="linenos" data-linenos="47 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="__codelineno-62-48" name="__codelineno-62-48"></a><a href="#__codelineno-62-48"><span class="linenos" data-linenos="48 "></span></a>
<a id="__codelineno-62-49" name="__codelineno-62-49"></a><a href="#__codelineno-62-49"><span class="linenos" data-linenos="49 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------- case 3: 2D x 0D -&gt; 0D&quot;</span><span class="p">)</span>
<a id="__codelineno-62-50" name="__codelineno-62-50"></a><a href="#__codelineno-62-50"><span class="linenos" data-linenos="50 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="p">[]})</span>
<a id="__codelineno-62-51" name="__codelineno-62-51"></a><a href="#__codelineno-62-51"><span class="linenos" data-linenos="51 "></span></a><span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-62-52" name="__codelineno-62-52"></a><a href="#__codelineno-62-52"><span class="linenos" data-linenos="52 "></span></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-62-53" name="__codelineno-62-53"></a><a href="#__codelineno-62-53"><span class="linenos" data-linenos="53 "></span></a>    <span class="n">InferenceSession</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">(),</span>
<a id="__codelineno-62-54" name="__codelineno-62-54"></a><a href="#__codelineno-62-54"><span class="linenos" data-linenos="54 "></span></a>                     <span class="n">providers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CPUExecutionProvider&quot;</span><span class="p">])</span>
<a id="__codelineno-62-55" name="__codelineno-62-55"></a><a href="#__codelineno-62-55"><span class="linenos" data-linenos="55 "></span></a><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-62-56" name="__codelineno-62-56"></a><a href="#__codelineno-62-56"><span class="linenos" data-linenos="56 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-62-57" name="__codelineno-62-57"></a><a href="#__codelineno-62-57"><span class="linenos" data-linenos="57 "></span></a>
<a id="__codelineno-62-58" name="__codelineno-62-58"></a><a href="#__codelineno-62-58"><span class="linenos" data-linenos="58 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------- case 4: 2D x None -&gt; None&quot;</span><span class="p">)</span>
<a id="__codelineno-62-59" name="__codelineno-62-59"></a><a href="#__codelineno-62-59"><span class="linenos" data-linenos="59 "></span></a><span class="n">onnx_model</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<a id="__codelineno-62-60" name="__codelineno-62-60"></a><a href="#__codelineno-62-60"><span class="linenos" data-linenos="60 "></span></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-62-61" name="__codelineno-62-61"></a><a href="#__codelineno-62-61"><span class="linenos" data-linenos="61 "></span></a>    <span class="n">check_model</span><span class="p">(</span><span class="n">onnx_model</span><span class="p">)</span>
<a id="__codelineno-62-62" name="__codelineno-62-62"></a><a href="#__codelineno-62-62"><span class="linenos" data-linenos="62 "></span></a><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-62-63" name="__codelineno-62-63"></a><a href="#__codelineno-62-63"><span class="linenos" data-linenos="63 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-62-64" name="__codelineno-62-64"></a><a href="#__codelineno-62-64"><span class="linenos" data-linenos="64 "></span></a><span class="n">sess</span> <span class="o">=</span> <span class="n">InferenceSession</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">(),</span>
<a id="__codelineno-62-65" name="__codelineno-62-65"></a><a href="#__codelineno-62-65"><span class="linenos" data-linenos="65 "></span></a>                        <span class="n">providers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CPUExecutionProvider&quot;</span><span class="p">])</span>
<a id="__codelineno-62-66" name="__codelineno-62-66"></a><a href="#__codelineno-62-66"><span class="linenos" data-linenos="66 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{</span>
<a id="__codelineno-62-67" name="__codelineno-62-67"></a><a href="#__codelineno-62-67"><span class="linenos" data-linenos="67 "></span></a>    <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<a id="__codelineno-62-68" name="__codelineno-62-68"></a><a href="#__codelineno-62-68"><span class="linenos" data-linenos="68 "></span></a>    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)})</span>
<a id="__codelineno-62-69" name="__codelineno-62-69"></a><a href="#__codelineno-62-69"><span class="linenos" data-linenos="69 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="__codelineno-62-70" name="__codelineno-62-70"></a><a href="#__codelineno-62-70"><span class="linenos" data-linenos="70 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------- end&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><a href="#__codelineno-63-1"><span class="linenos" data-linenos=" 1 "></span></a>-----------<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="m">1</span>:<span class="w"> </span>2D<span class="w"> </span>x<span class="w"> </span>2D<span class="w"> </span>-&gt;<span class="w"> </span>2D
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><a href="#__codelineno-63-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="o">[</span>array<span class="o">([[</span>-0.88513166,<span class="w"> </span>-1.4549615<span class="w"> </span><span class="o">]</span>,
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><a href="#__codelineno-63-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">       </span><span class="o">[</span>-0.38629988,<span class="w"> </span>-2.4992924<span class="w"> </span><span class="o">]]</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>float32<span class="o">)]</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><a href="#__codelineno-63-4"><span class="linenos" data-linenos=" 4 "></span></a>-----------<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="m">2</span>:<span class="w"> </span>2D<span class="w"> </span>x<span class="w"> </span>1D<span class="w"> </span>-&gt;<span class="w"> </span>1D
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><a href="#__codelineno-63-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="o">[</span>array<span class="o">([</span>-1.3339046,<span class="w"> </span>-4.186163<span class="w"> </span><span class="o">]</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>float32<span class="o">)]</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a><a href="#__codelineno-63-6"><span class="linenos" data-linenos=" 6 "></span></a>-----------<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="m">3</span>:<span class="w"> </span>2D<span class="w"> </span>x<span class="w"> </span>0D<span class="w"> </span>-&gt;<span class="w"> </span>0D
<a id="__codelineno-63-7" name="__codelineno-63-7"></a><a href="#__codelineno-63-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="o">[</span>ONNXRuntimeError<span class="o">]</span><span class="w"> </span>:<span class="w"> </span><span class="m">1</span><span class="w"> </span>:<span class="w"> </span>FAIL<span class="w"> </span>:<span class="w"> </span>Node<span class="w"> </span><span class="o">()</span><span class="w"> </span>Op<span class="w"> </span><span class="o">(</span>MatMul<span class="o">)</span><span class="w"> </span><span class="o">[</span>ShapeInferenceError<span class="o">]</span><span class="w"> </span>Input<span class="w"> </span>tensors<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>rank<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="o">)</span>.
<a id="__codelineno-63-8" name="__codelineno-63-8"></a><a href="#__codelineno-63-8"><span class="linenos" data-linenos=" 8 "></span></a>-----------<span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="m">4</span>:<span class="w"> </span>2D<span class="w"> </span>x<span class="w"> </span>None<span class="w"> </span>-&gt;<span class="w"> </span>None
<a id="__codelineno-63-9" name="__codelineno-63-9"></a><a href="#__codelineno-63-9"><span class="linenos" data-linenos=" 9 "></span></a>&lt;class<span class="w"> </span><span class="s1">&#39;onnx.onnx_cpp2py_export.checker.ValidationError&#39;</span>&gt;<span class="w"> </span>Field<span class="w"> </span><span class="s1">&#39;shape&#39;</span><span class="w"> </span>of<span class="w"> </span><span class="s1">&#39;type&#39;</span><span class="w"> </span>is<span class="w"> </span>required<span class="w"> </span>but<span class="w"> </span>missing.
<a id="__codelineno-63-10" name="__codelineno-63-10"></a><a href="#__codelineno-63-10"><span class="linenos" data-linenos="10 "></span></a><span class="o">[</span>array<span class="o">([</span>-1.2411526,<span class="w">  </span><span class="m">1</span>.8771248<span class="o">]</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>float32<span class="o">)]</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a><a href="#__codelineno-63-11"><span class="linenos" data-linenos="11 "></span></a>-----------<span class="w"> </span>end
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../introduction/" class="md-footer__link md-footer__link--prev" aria-label="上一页: ONNX">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                ONNX
              </div>
            </div>
          </a>
        
        
          
          <a href="../api_proto/" class="md-footer__link md-footer__link--next" aria-label="下一页: proto定义">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                proto定义
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy;; 2024 - now | xionghaha 
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.081f42fc.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
      
        <script src="../../js/open_in_new_tab.js"></script>
      
        <script src="../../js/open_in_new_tab.js"></script>
      
        <script src="../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>