## å®ä½“å…ƒæ•°æ®æå–

åœ¨æ­¤æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `newEntityExtractor` ä»æ¯ä¸ªèŠ‚ç‚¹æå–å®ä½“ï¼Œå­˜å‚¨åœ¨å…ƒæ•°æ®ä¸­ã€‚é»˜è®¤æ¨¡å‹æ˜¯ï¼Œå®ƒæ˜¯ä» `HuggingFacetomaarsen/span-marker-mbert-base-multinerd` ä¸‹è½½å¹¶åœ¨æœ¬åœ°è¿è¡Œçš„ã€‚

æœ‰å…³ LlamaIndex ä¸­å…ƒæ•°æ®æå–çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„æ–‡æ¡£ã€‚

å¦‚æœæ‚¨åœ¨ colab ä¸Šæ‰“å¼€æ­¤ç¬”è®°æœ¬ï¼Œåˆ™å¯èƒ½éœ€è¦å®‰è£… LlamaIndex ğŸ¦™ã€‚
``` shell
pip install llama-index-llms-openai
pip install llama-index-extractors-entity
pip install llama-index
``` 

``` python
# Needed to run the entity extractor
# !pip install span_marker

import os

os.environ["OPENAI_API_KEY"] = "YOUR_API_KEY"
```

## è®¾ç½®å®ä½“æå–å™¨å’Œè§£æå™¨

``` python
from llama_index.extractors.entity import EntityExtractor
from llama_index.core.node_parser import SentenceSplitter

entity_extractor = EntityExtractor(
    prediction_threshold=0.5,
    label_entities=False,  # include the entity label in the metadata (can be erroneous)
    device="cpu",  # set to "cuda" if you have a GPU
)

node_parser = SentenceSplitter()

transformations = [node_parser, entity_extractor]
```

## åŠ è½½æ•°æ®
åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä¸‹è½½ 2023 å¹´ IPPC æ°”å€™æŠ¥å‘Š - ç¬¬ 3 ç« æµ·æ´‹å’Œæ²¿æµ·ç”Ÿæ€ç³»ç»Ÿï¼ˆ172 é¡µï¼‰

``` shell
curl https://www.ipcc.ch/report/ar6/wg2/downloads/report/IPCC_AR6_WGII_Chapter03.pdf --output IPCC_AR6_WGII_Chapter03.pdf
``` 

æ¥ä¸‹æ¥ï¼ŒåŠ è½½æ–‡æ¡£ã€‚

ä» llama_index.core å¯¼å…¥ SimpleDirectoryReader

``` python
from llama_index.core import SimpleDirectoryReader

documents = SimpleDirectoryReader(
    input_files=["./IPCC_AR6_WGII_Chapter03.pdf"]
).load_data()
```

## æå–å…ƒæ•°æ®
ç°åœ¨ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“é•¿çš„æ–‡æ¡£ã€‚ç”±äºæˆ‘ä»¬ä¸åœ¨ CPU ä¸Šè¿è¡Œï¼Œå› æ­¤ç›®å‰æˆ‘ä»¬åªä¼šåœ¨éƒ¨åˆ†æ–‡æ¡£ä¸Šè¿è¡Œã€‚ä¸è¿‡ï¼Œæ‚¨å¯ä»¥è‡ªè¡Œåœ¨æ‰€æœ‰æ–‡æ¡£ä¸Šè¿è¡Œå®ƒï¼

``` python
from llama_index.core.ingestion import IngestionPipeline

import random

random.seed(42)
# comment out to run on all documents
# 100 documents takes about 5 minutes on CPU
documents = random.sample(documents, 100)

pipeline = IngestionPipeline(transformations=transformations)

nodes = pipeline.run(documents=documents)
```

## æ£€æŸ¥è¾“å‡º
``` python
samples = random.sample(nodes, 5)
for node in samples:
    print(node.metadata)
```
    
``` python
{'page_label'ï¼š'387'ï¼Œ'file_name'ï¼š'IPCâ€‹â€‹C_AR6_WGII_Chapter03.pdf'}
{'page_label'ï¼š'410'ï¼Œ'file_name'ï¼š'IPCâ€‹â€‹C_AR6_WGII_Chapter03.pdf'ï¼Œ'entities'ï¼š{'Parmesan'ï¼Œ'Boyd'ï¼Œ'Riebesell'ï¼Œ'Gattuso'}}
{'page_label'ï¼š'391'ï¼Œ'file_name'ï¼š'IPCâ€‹â€‹C_AR6_WGII_Chapter03.pdf'ï¼Œ'å®ä½“'ï¼š{'Gulev'ï¼Œ'Fox-Kemper'}}
{'page_label': '430', 'file_name': 'IPCC_AR6_WGII_Chapter03.pdf', 'entities': {'Kessouri', 'van der Sleen', 'Brodeur', 'Siedlecki', 'Fiechter', 'Ramajo', 'å¡ç½—æ‰'}}
{'page_label'ï¼š'388'ï¼Œ'file_name'ï¼š'IPCâ€‹â€‹C_AR6_WGII_Chapter03.pdf'}
```

## å°è¯•æŸ¥è¯¢

``` python
from llama_index.core import VectorStoreIndex
from llama_index.llms.openai import OpenAI
from llama_index.core import Settings

Settings.llm = OpenAI(model="gpt-3.5-turbo", temperature=0.2)

index = VectorStoreIndex(nodes=nodes)
```

``` shell
According to the provided context information, Fox-Kemper is mentioned in relation to the observed and projected trends of ocean warming and marine heatwaves. It is stated that Fox-Kemper et al. (2021) reported that ocean warming has increased on average by 0.88Â°C from 1850-1900 to 2011-2020. Additionally, it is mentioned that Fox-Kemper et al. (2021) projected that ocean warming will continue throughout the 21st century, with the rate of global ocean warming becoming scenario-dependent from the mid-21st century. Fox-Kemper is also cited as a source for the information on the increasing frequency, intensity, and duration of marine heatwaves over the 20th and early 21st centuries, as well as the projected increase in frequency of marine heatwaves in the future.
```

## æ— å…ƒæ•°æ®çš„å¯¹æ¯”

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é‡æ–°æ„å»ºç´¢å¼•ï¼Œä½†æ²¡æœ‰å…ƒæ•°æ®

``` python
for node in nodes:
    node.metadata.pop("entities", None)

print(nodes[0].metadata)
```

``` shell
{'page_label'ï¼š'542'ï¼Œ'file_name'ï¼š'IPCâ€‹â€‹C_AR6_WGII_Chapter03.pdf'}
```

``` python
index = VectorStoreIndex(nodes=nodes)
query_engine = index.as_query_engine()
response = query_engine.query("What is said by Fox-Kemper?")
print(response)
```

``` shell
According to the provided context information, Fox-Kemper is mentioned in relation to the decline of the AMOC (Atlantic Meridional Overturning Circulation) over the 21st century. The statement mentions that there is high confidence in the decline of the AMOC, but low confidence for quantitative projections.
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„å…ƒæ•°æ®ä¸°å¯Œç´¢å¼•èƒ½å¤Ÿè·å–æ›´å¤šç›¸å…³ä¿¡æ¯ã€‚